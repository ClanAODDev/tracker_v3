name: Tracker test suite

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  laravel-tests:

    runs-on: [ ubuntu-latest ]

    steps:
      - uses: actions/checkout@v2

      - name: Copy .env
        run: php7.4 -r "file_exists('.env') || copy('.env.example', '.env');"

      - name: Install Dependencies
        uses: php-actions/composer@v6
        with:
          args: --ignore-platform-reqs --no-scripts --no-progress --prefer-dist --no-interaction

      - name: Generate key
        run: php7.4 artisan key:generate

      - name: Directory Permissions
        run: chmod -R 777 storage bootstrap/cache

      - name: Configure matchers
        uses: mheap/phpunit-matcher-action@v1

      - name: Run Tests
        run: ./vendor/bin/phpunit --colors=always

      - uses: sarisia/actions-status-discord@v1
        if: always()
        with:
          webhook: ${{ secrets.DISCORD_ADMIN_WEBHOOK }}
