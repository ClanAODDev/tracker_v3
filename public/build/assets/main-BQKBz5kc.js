var v=v||{};(function(e){v={Setup:function(){v.InitNavToggle(),v.InitBackToTop(),v.InitClipboard(),v.InitDataTables(),v.InitSparklines(),v.InitPanels(),v.InitSubNavCollapse(),v.InitMemberAutocomplete(),v.InitMobileNav(),v.InitMobileSearch(),v.InitRarityFilter(),v.InitRepeater(),v.InitTabActivate(),v.InitMemberSearch(),v.InitCollectionSearch(),v.InitSmoothScroll(),v.InitSettings(),v.InitProfileModals(),v.InitNoSquadModal(),v.InitLeaderboardTabs(),v.InitInactiveTabs(),v.InitParttimerSearch(),v.InitAddParttimer(),v.InitNoteReminderDetection(),v.InitActivityReminderToggle(),v.InitInactiveBulkMode(),v.InitTrashedNotes()},InitNavToggle:function(){var t=e(".left-nav-toggle a");t.length&&t.on("click",function(i){i.preventDefault(),e("body").toggleClass("nav-toggle"),e("body").hasClass("nav-toggle")?e.get(window.Laravel.appPath+"/primary-nav/collapse"):e.get(window.Laravel.appPath+"/primary-nav/decollapse"),v.RefreshSparklines()})},InitBackToTop:function(){var t=e("#top-link-block");t.length&&e(window).on("scroll",function(){e(this).scrollTop()>100?t.addClass("visible"):t.removeClass("visible")})},InitSmoothScroll:function(){e(".smooth-scroll").on("click",function(t){var i=e(this).attr("href");if(!(!i||!i.startsWith("#"))){t.preventDefault();var a=e(i);if(a.length){var n=a.offset().top-90;e("html, body").stop().animate({scrollTop:n},750,function(){history.replaceState(null,null,i),e(window).trigger("hashchange")})}}})},InitClipboard:function(){if(!(typeof Clipboard>"u")&&e(".copy-to-clipboard").length){var t=new Clipboard(".copy-to-clipboard");t.on("success",function(i){toastr.success("Copied!"),i.clearSelection()})}},InitDataTables:function(){var t=e("table.basic-datatable"),i=e("table.adv-datatable");if(t.length){var a=t.DataTable({paging:!1,bFilter:!1,stateSave:!0,bInfo:!1,order:[],columnDefs:[{targets:"no-sort",orderable:!1}],select:{style:"os",selector:"td:first-child"}});e(".for-pm-selection").length&&a.on("select",function(){var n=a.rows(e(".selected")).data().toArray().map(function(s){return s[4]});n.length>=2&&(e("#selected-data").show(),e("#selected-data .status-text").text("With selected ("+n.length+")"),e("#pm-member-data").val(n))})}i.length&&i.DataTable({order:[],columnDefs:[{targets:"no-sort",orderable:!1}]})},InitSparklines:function(){v.RefreshSparklines();var t;e(window).on("resize",function(){clearTimeout(t),t=setTimeout(v.RefreshSparklines,100)})},RefreshSparklines:function(){e("[census-data]").each(function(){var t=e(this),i=t.closest(".census-sparkline-container").length>0,a=i?80:50;t.sparkline(t.data("counts"),{type:"line",lineColor:"#fff",lineWidth:2,fillColor:"#404652",height:a,width:"100%"}),t.data("weekly-voice")&&t.sparkline(t.data("weekly-voice"),{type:"line",lineColor:"#1bbf89",lineWidth:2,fillColor:"rgba(27, 191, 137, 0.2)",height:a,composite:!0})}),e(".census-pie").each(function(){var t=e(this);t.sparkline(t.data("counts"),{type:"pie",sliceColors:t.data("colors")})})},InitPanels:function(){e(".panel-toggle").on("click",function(t){t.preventDefault();var i=e(t.target).closest("div.panel"),a=e(t.target).closest("i.toggle-icon"),n=e(t.target).find("i.toggle-icon");i.find("div.panel-body").slideToggle(300),i.find("div.panel-footer").slideToggle(200),a.toggleClass("fa-chevron-up fa-chevron-down"),n.toggleClass("fa-chevron-up fa-chevron-down"),i.toggleClass("panel-collapse"),setTimeout(function(){i.resize(),i.find("[id^=map-]").resize()},50)}),e(".panel-close").on("click",function(t){t.preventDefault(),e(t.target).closest("div.panel").remove()})},InitSubNavCollapse:function(){e(".nav-second").on("show.bs.collapse",function(){e(".nav-second.in").collapse("hide")})},InitMemberAutocomplete:function(){var t=e(".search-member");t.length&&t.bootcomplete({url:window.Laravel.appPath+"/search-member/",minLength:3,idField:!0,method:"POST",dataParams:{_token:e("meta[name=csrf-token]").attr("content")}})},InitMobileNav:function(){var t=e(".mobile-nav-toggle"),i=e(".mobile-nav-drawer"),a=e(".mobile-nav-overlay"),n=e(".mobile-nav-close");if(!i.length)return;function s(){i.addClass("active"),a.addClass("active"),e("body").addClass("mobile-nav-open")}function r(){i.removeClass("active"),a.removeClass("active"),e("body").removeClass("mobile-nav-open")}t.on("click",function(o){o.preventDefault(),i.hasClass("active")?r():s()}),n.on("click",function(o){o.preventDefault(),r()}),a.on("click",r),i.find("a").on("click",function(){var o=e(this);o.attr("data-toggle")==="collapse"||o.attr("href")==="#"||r()})},InitMobileSearch:function(){var t=e(".mobile-search-toggle"),i=e(".mobile-search-modal"),a=e("#mobile-member-search"),n=e(".mobile-search-close"),s=e(".mobile-searchclear"),r=e(".mobile-search-results"),o=e(".mobile-search-loader");if(!i.length)return;var c=null,l=500;function m(){i.addClass("active"),e("body").addClass("mobile-search-open"),a.focus()}function d(){i.removeClass("active"),e("body").removeClass("mobile-search-open"),a.val(""),s.removeClass("visible"),r.empty(),o.removeClass("active")}function f(){var u=a.val().trim();if(!u){o.removeClass("active"),r.empty();return}e.ajax({url:window.Laravel.appPath+"/search/members/"+u,type:"GET",success:function(h){o.removeClass("active"),r.html(h)}})}t.on("click",function(u){u.preventDefault(),m()}),n.on("click",d),s.on("click",function(){a.val("").focus(),s.removeClass("visible"),r.empty()}),a.on("input",function(){var u=a.val().trim();if(s.toggleClass("visible",u.length>0),c&&clearTimeout(c),!u){r.empty(),o.removeClass("active");return}o.addClass("active"),c=setTimeout(f,l)}),a.on("keydown",function(u){u.key==="Escape"&&d()})},InitRarityFilter:function(){var t=e(".rarity-filter"),i=e("#division-filter");if(!t.length&&!i.length)return;function a(){var o=e(".rarity-filter.active").map(function(){return e(this).data("rarity")}).get();e(".award-card").each(function(){var c=e(this),l=c.closest('[class*="col-"]'),m=null;["mythic","legendary","epic","rare","common"].forEach(function(u){c.hasClass("award-card-"+u)&&(m=u)});var d=o.length===0||o.indexOf(m)!==-1,f=l.hasClass("filter-hidden");d?(l.removeClass("filter-hidden filter-hiding"),f?(l.addClass("filter-entering"),setTimeout(function(){l.removeClass("filter-entering").addClass("filter-visible")},300)):l.addClass("filter-visible")):!l.hasClass("filter-hidden")&&!l.hasClass("filter-hiding")&&(l.removeClass("filter-visible filter-entering").addClass("filter-hiding"),setTimeout(function(){l.removeClass("filter-hiding").addClass("filter-hidden")},250))})}t.on("click",function(){e(this).toggleClass("active"),a()}),i.on("change",function(){var o=e(this).val(),c=new URL(window.location.href);o?c.searchParams.set("division",o):c.searchParams.delete("division"),window.location.href=c.toString()});var n=e("#rarity-sort"),s=["mythic","legendary","epic","rare","common"];function r(o){e(".award-grid").each(function(){var c=e(this),l=c.children('[class*="col-"]').detach().toArray();o==="default"?l.sort(function(m,d){var f=parseInt(e(m).data("original-order"))||0,u=parseInt(e(d).data("original-order"))||0;return f-u}):l.sort(function(m,d){var f=e(m).find(".award-card"),u=e(d).find(".award-card"),h=4,g=4;return s.forEach(function(p,b){f.hasClass("award-card-"+p)&&(h=b),u.hasClass("award-card-"+p)&&(g=b)}),o==="rarity-desc"?h-g:g-h}),l.forEach(function(m,d){var f=e(m);f.data("original-order")||f.attr("data-original-order",d),f.removeClass("filter-visible filter-entering filter-hiding filter-hidden"),c.append(m)}),setTimeout(function(){c.children('[class*="col-"]').each(function(m){var d=e(this);setTimeout(function(){d.addClass("filter-entering"),setTimeout(function(){d.removeClass("filter-entering").addClass("filter-visible")},300)},m*30)})},10)})}e(".award-grid").each(function(){e(this).children('[class*="col-"]').each(function(o){e(this).attr("data-original-order",o)})}),n.on("change",function(){r(e(this).val()),a()})},InitMemberSearch:function(){var t=e("#member-search");if(!t.length)return;var i=e(".desktop-search-loader"),a=e("#searchclear"),n=null,s=1e3;function r(){i.addClass("active"),n&&clearTimeout(n),n=setTimeout(function(){n=null;var c=t.val().trim();if(!c){i.removeClass("active");return}v.GetSearchResults()},s)}t.on("keydown",r),t.on("paste",function(){setTimeout(r,0)}),t.on("input",function(){var c=t.val().trim();c||(i.removeClass("active"),a.removeClass("visible"))});function o(){e("section.search-results").addClass("closed").removeClass("open"),e("body").removeClass("search-active"),e(".content").css("margin-top",""),t.val(""),a.removeClass("visible")}a.on("click",o),e(".content").on("click",function(){e("body").hasClass("search-active")&&o()})},GetSearchResults:function(){var t=e("#member-search").val();t&&e.ajax({url:window.Laravel.appPath+"/search/members/"+t,type:"GET",success:function(i){window.scrollTo(0,0),e(".desktop-search-loader").removeClass("active"),e("#searchclear").addClass("visible");var a=e("section.search-results");a.html(i).addClass("open").removeClass("closed"),e("body").addClass("search-active"),setTimeout(function(){e(".content").css("margin-top","20px")},50)}})},InitCollectionSearch:function(){var t=e("#search-collection");t.length&&t.on("keyup",function(){var i=e(this).val(),a=new RegExp("^"+i,"i");e(".collection .collection-item").each(function(){e(this).toggle(a.test(e(this).text()))})})},InitRepeater:function(){var t=e(".repeater");t.length&&t.repeater({isFirstItemUndeletable:!0})},InitTabActivate:function(){var t=e(".nav-tabs");t.length&&(t.stickyTabs(),e('a[data-toggle="tab"]').on("shown.bs.tab",function(){e.sparkline_display_visible()}))},InitSettings:function(){var t=e(".settings-toggle, .mobile-settings-toggle"),i=e(".settings-overlay"),a=e(".settings-slideover"),n=e(".settings-close");if(!t.length)return;function s(){i.addClass("active"),a.addClass("active"),t.addClass("active"),e("body").addClass("settings-open")}function r(){i.removeClass("active"),a.removeClass("active"),t.removeClass("active"),e("body").removeClass("settings-open")}t.on("click",function(d){d.preventDefault(),a.hasClass("active")?r():s()}),i.on("click",r),n.on("click",r),e(document).on("keydown",function(d){d.key==="Escape"&&a.hasClass("active")&&r()});var o=null,c=e(".settings-save-status");function l(){o&&clearTimeout(o),c.text("Saving...").removeClass("saved error").addClass("saving");var d={_token:e('input[name="_token"]').val(),disable_animations:e("#setting-disable-animations").is(":checked"),mobile_nav_side:e("#setting-mobile-nav-side").val(),snow:e("#setting-snow").val(),snow_ignore_mouse:e("#setting-snow-ignore-mouse").is(":checked"),ticket_notifications:e("#setting-ticket-notifications").is(":checked"),theme:e("#setting-theme").val()};e.ajax({url:window.Laravel.appPath+"/settings",type:"POST",data:d,success:function(){c.text("Saved").removeClass("saving error").addClass("saved"),o=setTimeout(function(){c.text("").removeClass("saved")},2e3),v.ApplySettings(d)},error:function(){c.text("Error saving").removeClass("saving saved").addClass("error")}})}e("#setting-disable-animations, #setting-ticket-notifications, #setting-snow-ignore-mouse").on("change",l),e(".settings-btn[data-setting]").on("click",function(){var d=e(this),f=d.data("setting"),u=d.data("value");d.siblings(".settings-btn").removeClass("active"),d.addClass("active"),e("#setting-"+f.split("_").join("-")).val(u),f==="theme"&&m(u),l()});function m(d){var f=d==="shattrath";e('.settings-btn[data-value="motes"]').toggle(f),!f&&e("#setting-snow").val()==="motes"&&(e("#setting-snow").val("no_snow"),e('.settings-btn[data-setting="snow"]').removeClass("active"),e('.settings-btn[data-value="no_snow"]').addClass("active"));var u=document.getElementById("favicon");u&&(u.href=d==="shattrath"?"/images/logo-shattrath.svg":"/images/logo_v2.svg")}m(e("#setting-theme").val())},ApplySettings:function(t){if(t.disable_animations?e("body").addClass("no-animations"):e("body").removeClass("no-animations"),t.mobile_nav_side==="left"?e("body").addClass("mobile-nav-left"):e("body").removeClass("mobile-nav-left"),t.theme&&document.documentElement.setAttribute("data-theme",t.theme),typeof initSnowStorm=="function"){var i=0;t.snow==="some_snow"?i=32:t.snow==="all_the_snow"&&(i=160),initSnowStorm(i,t.snow_ignore_mouse)}if(typeof initMotesOfLight=="function"){var a=0;t.snow==="motes"&&(a=35),initMotesOfLight(a,t.snow_ignore_mouse)}},InitProfileModals:function(){var t=e("#part-time-divisions-modal"),i=e("#ingame-handles-modal");if(!(!t.length&&!i.length)){t.add(i).on("show.bs.modal",function(){e(".settings-overlay").removeClass("active"),e(".settings-slideover").removeClass("active"),e(".settings-toggle, .mobile-settings-toggle").removeClass("active"),e("body").removeClass("settings-open")}),e("#save-part-time-divisions").on("click",function(){var n=e(this),s=t.find(".modal-save-status"),r=[];t.find('input[name="divisions[]"]:checked').each(function(){r.push(e(this).val())}),n.prop("disabled",!0),s.text("Saving...").removeClass("saved error").addClass("saving"),e.ajax({url:window.Laravel.appPath+"/settings/part-time-divisions",type:"POST",data:{_token:e("meta[name=csrf-token]").attr("content"),divisions:r},success:function(o){s.text("Saved!").removeClass("saving error").addClass("saved"),e('.settings-link-btn[data-target="#part-time-divisions-modal"] .settings-link-count').text(o.count),setTimeout(function(){t.modal("hide"),s.text("").removeClass("saved")},1e3)},error:function(){s.text("Error saving").removeClass("saving saved").addClass("error")},complete:function(){n.prop("disabled",!1)}})});var a=e("#handles-container .handle-row").length;e("#add-handle").on("click",function(){var n=e("#handle-row-template").html(),s=n.replace(/__INDEX__/g,a);e("#handles-container").append(s),a++}),e(document).on("click",".remove-handle",function(){e(this).closest(".handle-row").remove()}),e("#save-ingame-handles").on("click",function(){var n=e(this),s=i.find(".modal-save-status"),r=[];e("#handles-container .handle-row").each(function(o){var c=e(this),l=c.find(".handle-select").val(),m=c.find('input[type="text"]').val();l&&m&&r.push({id:c.data("id")||"",handle_id:l,value:m,primary:c.find(".handle-primary input").is(":checked")?1:0})}),n.prop("disabled",!0),s.text("Saving...").removeClass("saved error").addClass("saving"),e.ajax({url:window.Laravel.appPath+"/settings/ingame-handles",type:"POST",data:{_token:e("meta[name=csrf-token]").attr("content"),handles:r},success:function(o){s.text("Saved!").removeClass("saving error").addClass("saved"),e('.settings-link-btn[data-target="#ingame-handles-modal"] .settings-link-count').text(o.count),setTimeout(function(){i.modal("hide"),s.text("").removeClass("saved")},1e3)},error:function(){s.text("Error saving").removeClass("saving saved").addClass("error")},complete:function(){n.prop("disabled",!1)}})})}},InitNoSquadModal:function(){var t=e("#no-squad-modal");if(t.length){var i=!1;t.on("show.bs.modal",function(){if(!i){var a=t.data("url");e.get(a,function(n){var s=e("#no-squad-list");if(s.empty(),n.members.length===0)s.html('<p class="text-muted">No members found.</p>');else{var r={};n.members.forEach(function(o){r[o.platoon]||(r[o.platoon]={members:[],manage_url:o.manage_url}),r[o.platoon].members.push(o)}),Object.keys(r).sort().forEach(function(o){var c=r[o],l=e('<div class="no-squad-group"></div>');l.append('<div class="no-squad-platoon-header"><span>'+o+'</span><a href="'+c.manage_url+'" class="btn btn-sm btn-accent"><i class="fa fa-arrows-alt"></i> Assign</a></div>');var m=e('<div class="no-squad-members"></div>');c.members.forEach(function(d){m.append('<span class="no-squad-member">'+d.name+"</span>")}),l.append(m),s.append(l)})}e("#no-squad-loading").hide(),s.show(),i=!0})}})}},InitLeaderboardTabs:function(){var t=e(".leaderboard-tab"),i=e(".leaderboard-panel");t.length&&t.on("click",function(){var a=e(this).data("tab");t.removeClass("active"),i.removeClass("active"),e(this).addClass("active"),e('.leaderboard-panel[data-panel="'+a+'"]').addClass("active")})},InitInactiveTabs:function(){var t=e(".inactive-tab"),i=e(".inactive-panel"),a=e("#inactive-search");t.length&&(t.on("click",function(){var n=e(this).data("tab");t.removeClass("active"),i.removeClass("active"),e(this).addClass("active"),e('.inactive-panel[data-panel="'+n+'"]').addClass("active"),a.val()&&v.FilterInactiveTable(a.val())}),a.length&&a.on("input",function(){v.FilterInactiveTable(e(this).val())}))},FilterInactiveTable:function(t){t=t.toLowerCase(),e(".inactive-panel.active tbody tr").each(function(){var i=e(this).text().toLowerCase();e(this).toggle(i.indexOf(t)!==-1)})},InitParttimerSearch:function(){var t=e("#parttimer-search");t.length&&t.on("input",function(){var i=e(this).val().toLowerCase();e(".inactive-panel.active tbody tr").each(function(){var a=e(this).text().toLowerCase();e(this).toggle(a.indexOf(i)!==-1)})})},InitAddParttimer:function(){var t=e("#add-parttimer-modal");if(t.length){var i=e("#parttimer-member-search"),a=e("#parttimer-member-id"),n=e("#parttimer-selected-member"),s=n.find(".selected-member-name"),r=e("#add-parttimer-submit");i.bootcomplete({url:window.Laravel.appPath+"/search-member/",minLength:3,idField:!0,method:"POST",dataParams:{_token:e("meta[name=csrf-token]").attr("content")}}),i.on("bootcomplete.selected",function(o,c,l){a.val(c),s.text(l),n.show(),i.hide(),r.prop("disabled",!1)}),n.on("click",".clear-selected-member",function(){a.val(""),s.text(""),n.hide(),i.val("").show().focus(),r.prop("disabled",!0)}),t.on("hidden.bs.modal",function(){a.val(""),s.text(""),n.hide(),i.val("").show(),r.prop("disabled",!0),e("#parttimer-handle-value").val("")})}},InitNoteReminderDetection:function(){var t=[/\bpm\s*sent\b/i,/\bpm'?d\b/i,/\bsent\s*(a\s+)?pm\b/i,/\binactivity\s+(notice|reminder|warning|msg|message|pm)\b/i,/\bactivity\s+(reminder|notice|pm|msg|message\s+sent)\b/i,/\b(reminder|notice)\s+sent\b/i,/\bwellness\s+check\b/i,/\bforum\s+(notice|reminder|activity\s+pm|inactivity)\b/i,/\bdiscord\s+(message|dm|pm)\s+sent\b/i,/\bfinal\s+(notice|reminder)\s+sent\b/i,/\b(14|30|45|60)\s*day\b/i,/\b[23]\s*week\b/i,/\bmessaged\s+(regarding|about)\s+(in)?activity\b/i,/\bcontacted\s+(regarding|about)\s+(in)?activity\b/i];e(document).on("input",".note-body-input",function(){var i=e(this),a=i.siblings(".reminder-note-suggestion"),n=i.val();if(!a.data("dismissed")){var s=n.length<100&&t.some(function(r){return r.test(n)});a.toggle(s)}}),e(document).on("click",".dismiss-suggestion",function(){var i=e(this).closest(".reminder-note-suggestion");i.data("dismissed",!0).hide()}),e("#create-member-note").on("hidden.bs.modal",function(){e(this).find(".reminder-note-suggestion").removeData("dismissed").hide()})},InitActivityReminderToggle:function(){var t=e("meta[name=csrf-token]").attr("content");e(document).on("click",".activity-reminder-toggle",function(i){i.preventDefault();var a=e(this),n=a.data("member-id");a.prop("disabled")||(a.prop("disabled",!0),e.ajax({url:window.Laravel.appPath+"/members/"+n+"/set-activity-reminder",method:"POST",data:{_token:t},success:function(s){a.removeClass("btn-success").addClass("btn-default"),a.html('<i class="fa fa-bell"></i> <span class="reminded-date">'+s.date+"</span>"),a.attr("title",s.title)},error:function(s){var r=s.responseJSON?.message||"Failed to set reminder";toastr.error(r),a.prop("disabled",!1)}}))}),e(document).on("click",".set-activity-reminder-btn",function(i){i.preventDefault();var a=e(this),n=a.data("url");if(!(a.prop("disabled")||a.hasClass("reminder-sent"))){a.prop("disabled",!0);var s=a.html();a.html('<i class="fa fa-spinner fa-spin"></i> Sending...'),e.ajax({url:n,method:"POST",data:{_token:t},success:function(r){a.addClass("reminder-sent"),a.html('<i class="fa fa-check"></i> Reminded '+r.date),toastr.success("Activity reminder marked")},error:function(r){var o=r.responseJSON?.message||"Failed to set reminder";toastr.error(o),a.prop("disabled",!1),a.html(s)}})}}),e(document).on("click",".clear-reminders-btn",function(i){i.preventDefault();var a=e(this),n=a.data("url");a.prop("disabled")||confirm("Clear all activity reminders for this member?")&&(a.prop("disabled",!0),a.html('<i class="fa fa-spinner fa-spin"></i> Clearing...'),e.ajax({url:n,method:"DELETE",data:{_token:t},success:function(s){toastr.success(s.count+" reminder(s) cleared"),e("#member-reminder-history-modal").modal("hide"),e(".stat-reminder-badge").fadeOut()},error:function(s){var r=s.responseJSON?.message||"Failed to clear reminders";toastr.error(r),a.prop("disabled",!1),a.html('<i class="fa fa-trash"></i> Clear Reminders')}}))})},InitTrashedNotes:function(){var t=e(".toggle-trashed-notes");if(t.length){var i=e("meta[name=csrf-token]").attr("content"),a=t.data("count");t.on("click",function(){var n=e(this),s=e(".notes-active-list"),r=e(".notes-trashed-list");r.is(":visible")?(r.hide(),s.show(),n.removeClass("btn-warning").addClass("btn-default"),n.html('<i class="fa fa-trash"></i> Deleted ('+a+")")):(s.hide(),r.show(),n.removeClass("btn-default").addClass("btn-warning"),n.html('<i class="fa fa-sticky-note"></i> Active Notes'))}),e(document).on("click",".restore-note-btn",function(){var n=e(this),s=n.data("url"),r=n.closest(".note-card");n.prop("disabled",!0).html('<i class="fa fa-spinner fa-spin"></i>'),e.ajax({url:s,method:"POST",data:{_token:i},success:function(){r.fadeOut(300,function(){e(this).remove()}),toastr.success("Note restored")},error:function(o){toastr.error(o.responseJSON?.message||"Failed to restore note"),n.prop("disabled",!1).html('<i class="fa fa-undo"></i> Restore')}})}),e(document).on("click",".force-delete-note-btn",function(){var n=e(this),s=n.data("url"),r=n.closest(".note-card");confirm("Permanently delete this note? This cannot be undone.")&&(n.prop("disabled",!0).html('<i class="fa fa-spinner fa-spin"></i>'),e.ajax({url:s,method:"DELETE",data:{_token:i},success:function(){r.fadeOut(300,function(){e(this).remove()}),toastr.success("Note permanently deleted")},error:function(o){toastr.error(o.responseJSON?.message||"Failed to delete note"),n.prop("disabled",!1).html('<i class="fa fa-trash"></i> Delete Forever')}}))})}},InitInactiveBulkMode:function(){var t=e(".inactive-bulk-toggle");if(!t.length)return;var i=e("#inactive-bulk-bar"),a=e("#inactive-pm-member-data"),n=e("meta[name=csrf-token]").attr("content"),s=!1;function r(){var l=e(".inactive-member-checkbox:checked").map(function(){return e(this).val()}).get();a.val(l.join(",")),l.length>0?(i.find(".status-text").text(l.length+" selected"),i.slideDown(200)):i.slideUp(200);var m=e(".inactive-member-checkbox").length,d=l.length;e(".inactive-select-all").prop("checked",d>0&&d===m),e(".inactive-select-all").prop("indeterminate",d>0&&d<m)}t.on("click",function(){s=!s;var l=e(this);l.toggleClass("active",s),e(".inactive-bulk-col").toggle(s),e(".inactive-table").toggleClass("bulk-mode",s),s?l.html('<i class="fa fa-times"></i> Exit Bulk Mode'):(l.html('<i class="fa fa-check-square"></i> Bulk Mode'),e(".inactive-member-checkbox, .inactive-select-all").prop("checked",!1),i.slideUp(200))}),e(document).on("change",".inactive-member-checkbox",r);var o=!1,c=!0;e(document).on("mousedown",".inactive-table tbody tr",function(l){if(s&&!e(l.target).is("a, button, input, .fa")&&l.which===1){l.preventDefault(),o=!0;var m=e(this).find(".inactive-member-checkbox");m.length&&(c=!m.prop("checked"),m.prop("checked",c),e(this).toggleClass("drag-selected",c))}}),e(document).on("mouseenter",".inactive-table tbody tr",function(){if(!(!o||!s)){var l=e(this).find(".inactive-member-checkbox");l.length&&(l.prop("checked",c),e(this).toggleClass("drag-selected",c))}}),e(document).on("mouseup",function(){o&&(o=!1,e(".inactive-table tbody tr").removeClass("drag-selected"),r())}),e(document).on("change",".inactive-select-all",function(){var l=e(this).closest(".inactive-panel");l.find(".inactive-member-checkbox").prop("checked",e(this).prop("checked")),r()}),e(document).on("click",".inactive-bulk-close",function(){e(".inactive-member-checkbox, .inactive-select-all").prop("checked",!1),r()}),e("#inactive-bulk-reminder-btn").on("click",function(){var l=a.val();if(!l){toastr.warning("No members selected");return}var m=e(this),d=l.split(","),f=m.data("url");m.prop("disabled",!0).html('<span class="themed-spinner spinner-sm"></span>'),e.ajax({url:f,method:"POST",data:{_token:n,member_ids:d},success:function(u){var h=u.count+" member"+(u.count!==1?"s":"")+" marked as reminded";u.skipped>0&&(h+=" ("+u.skipped+" skipped - already reminded today)"),toastr.success(h),u.updatedIds.forEach(function(g){var p=e('.activity-reminder-toggle[data-member-id="'+g+'"]');p.length&&(p.removeClass("btn-success").addClass("btn-default"),p.html('<i class="fa fa-bell"></i> <span class="reminded-date">'+u.date+"</span>"),p.attr("title","Reminded just now"),p.prop("disabled",!0))}),e(".inactive-member-checkbox, .inactive-select-all").prop("checked",!1),r()},error:function(u){var h=u.responseJSON?.message||"Failed to set reminders";toastr.error(h)},complete:function(){m.prop("disabled",!1).html('<i class="fa fa-bell text-accent"></i> <span class="hidden-xs hidden-sm">Reminder</span>')}})})}}})(window.jQuery);v.Setup();
