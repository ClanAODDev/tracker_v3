var c=c||{};(function(e){const p=e("meta[name=csrf-token]").attr("content");c={Setup(){c.InitNavToggle(),c.InitBackToTop(),c.InitClipboard(),c.InitDataTables(),c.InitSparklines(),c.InitPanels(),c.InitSubNavCollapse(),c.InitMemberAutocomplete(),c.InitMobileNav(),c.InitMobileSearch(),c.InitRarityFilter(),c.InitRepeater(),c.InitTabActivate(),c.InitMemberSearch(),c.InitCollectionSearch(),c.InitSmoothScroll(),c.InitSettings(),c.InitProfileModals(),c.InitNoSquadModal(),c.InitWelcomeModal(),c.InitLeaderboardTabs(),c.InitInactiveTabs(),c.InitParttimerSearch(),c.InitAddParttimer(),c.InitNoteReminderDetection(),c.InitActivityReminderToggle(),c.InitInactiveBulkMode(),c.InitTrashedNotes(),c.InitActivityFeedToggle(),c.InitPopulationMeter()},InitNavToggle(){const t=e(".left-nav-toggle a");t.length&&t.on("click",a=>{a.preventDefault(),e("body").toggleClass("nav-toggle"),e("body").hasClass("nav-toggle")?e.get(`${window.Laravel.appPath}/primary-nav/collapse`):e.get(`${window.Laravel.appPath}/primary-nav/decollapse`),c.RefreshSparklines()})},InitBackToTop(){const t=e("#top-link-block");t.length&&e(window).on("scroll",()=>{e(window).scrollTop()>100?t.addClass("visible"):t.removeClass("visible")})},InitSmoothScroll(){e(".smooth-scroll").on("click",function(t){const a=e(this).attr("href");if(!a||!a.startsWith("#"))return;t.preventDefault();const s=e(a);if(!s.length)return;const o=s.offset().top-90;e("html, body").stop().animate({scrollTop:o},750,()=>{history.replaceState(null,null,a),e(window).trigger("hashchange")})})},InitClipboard(){if(typeof Clipboard>"u"||!e(".copy-to-clipboard").length)return;new Clipboard(".copy-to-clipboard").on("success",a=>{toastr.success("Copied!"),a.clearSelection()})},InitDataTables(){const t=e("table.basic-datatable"),a=e("table.adv-datatable");if(t.length){const s=t.DataTable({paging:!1,bFilter:!1,stateSave:!0,bInfo:!1,order:[],columnDefs:[{targets:"no-sort",orderable:!1}],select:{style:"os",selector:"td:first-child"}});e(".for-pm-selection").length&&s.on("select",()=>{const o=s.rows(e(".selected")).data().toArray().map(l=>l[4]);o.length>=1?(e("#selected-data").show(),e("#selected-data .status-text").text(`${o.length} member${o.length===1?"":"s"} selected`),e("#pm-member-data").val(o)):e("#selected-data").hide()})}a.length&&a.DataTable({order:[],columnDefs:[{targets:"no-sort",orderable:!1}]})},InitSparklines(){c.RefreshSparklines();let t;e(window).on("resize",()=>{clearTimeout(t),t=setTimeout(c.RefreshSparklines,100)})},RefreshSparklines(){e("[census-data]").each(function(){const t=e(this),s=t.closest(".census-sparkline-container").length>0?80:50;t.sparkline(t.data("counts"),{type:"line",lineColor:"#fff",lineWidth:2,fillColor:"#404652",height:s,width:"100%"}),t.data("weekly-voice")&&t.sparkline(t.data("weekly-voice"),{type:"line",lineColor:"#1bbf89",lineWidth:2,fillColor:"rgba(27, 191, 137, 0.2)",height:s,composite:!0})}),e(".census-pie").each(function(){const t=e(this);t.sparkline(t.data("counts"),{type:"pie",sliceColors:t.data("colors")})})},InitPanels(){e(".panel-toggle").on("click",t=>{t.preventDefault();const a=e(t.target).closest("div.panel"),s=e(t.target).closest("i.toggle-icon"),o=e(t.target).find("i.toggle-icon");a.find("div.panel-body").slideToggle(300),a.find("div.panel-footer").slideToggle(200),s.toggleClass("fa-chevron-up fa-chevron-down"),o.toggleClass("fa-chevron-up fa-chevron-down"),a.toggleClass("panel-collapse"),setTimeout(()=>{a.resize(),a.find("[id^=map-]").resize()},50)}),e(".panel-close").on("click",t=>{t.preventDefault(),e(t.target).closest("div.panel").remove()})},InitSubNavCollapse(){e(".nav-second").on("show.bs.collapse",()=>{e(".nav-second.in").collapse("hide")})},InitMemberAutocomplete(){const t=e(".search-member");t.length&&t.bootcomplete({url:`${window.Laravel.appPath}/search-member/`,minLength:3,idField:!0,method:"POST",dataParams:{_token:p}})},InitMobileNav(){const t=e(".mobile-nav-toggle"),a=e(".mobile-nav-drawer"),s=e(".mobile-nav-overlay"),o=e(".mobile-nav-close");if(!a.length)return;const l=()=>{a.addClass("active"),s.addClass("active"),e("body").addClass("mobile-nav-open")},n=()=>{a.removeClass("active"),s.removeClass("active"),e("body").removeClass("mobile-nav-open")};t.on("click",r=>{r.preventDefault(),a.hasClass("active")?n():l()}),o.on("click",r=>{r.preventDefault(),n()}),s.on("click",n),a.find("a").on("click",function(){const r=e(this);r.attr("data-toggle")==="collapse"||r.attr("href")==="#"||n()})},InitMobileSearch(){const t=e(".mobile-search-toggle"),a=e(".mobile-search-modal"),s=e("#mobile-member-search"),o=e(".mobile-search-close"),l=e(".mobile-searchclear"),n=e(".mobile-search-results"),r=e(".mobile-search-loader");if(!a.length)return;let d=null;const g=500,h=()=>{a.addClass("active"),e("body").addClass("mobile-search-open"),s.focus()},f=()=>{a.removeClass("active"),e("body").removeClass("mobile-search-open"),s.val(""),l.removeClass("visible"),n.empty(),r.removeClass("active")},u=()=>{const i=s.val().trim();if(!i){r.removeClass("active"),n.empty();return}e.ajax({url:`${window.Laravel.appPath}/search/members`,type:"GET",data:{q:i},success:m=>{r.removeClass("active"),n.html(m)}})};t.on("click",i=>{i.preventDefault(),h()}),o.on("click",f),l.on("click",()=>{s.val("").focus(),l.removeClass("visible"),n.empty()}),s.on("input",()=>{const i=s.val().trim();if(l.toggleClass("visible",i.length>0),d&&clearTimeout(d),!i){n.empty(),r.removeClass("active");return}r.addClass("active"),d=setTimeout(u,g)}),s.on("keydown",i=>{i.key==="Escape"&&f()})},InitRarityFilter(){const t=e(".rarity-filter"),a=e("#division-filter");if(!t.length&&!a.length)return;const s=()=>{const r=e(".rarity-filter.active").map(function(){return e(this).data("rarity")}).get();e(".award-card").each(function(){const d=e(this),g=d.closest('[class*="col-"]');let h=null;["unclaimed","mythic","legendary","epic","rare","common"].forEach(i=>{d.hasClass(`award-card-${i}`)&&(h=i)});const f=r.length===0||r.indexOf(h)!==-1,u=g.hasClass("filter-hidden");f?(g.removeClass("filter-hidden filter-hiding"),u?(g.addClass("filter-entering"),setTimeout(()=>{g.removeClass("filter-entering").addClass("filter-visible")},300)):g.addClass("filter-visible")):!g.hasClass("filter-hidden")&&!g.hasClass("filter-hiding")&&(g.removeClass("filter-visible filter-entering").addClass("filter-hiding"),setTimeout(()=>{g.removeClass("filter-hiding").addClass("filter-hidden")},250))})};t.on("click",function(){e(this).toggleClass("active"),s()}),a.on("change",function(){const r=e(this).val(),d=new URL(window.location.href);r?d.searchParams.set("division",r):d.searchParams.delete("division"),window.location.href=d.toString()});const o=e("#rarity-sort"),l=["mythic","legendary","epic","rare","common","unclaimed"],n=r=>{e(".award-grid").each(function(){const d=e(this),g=d.children('[class*="col-"]').detach().toArray();r==="default"?g.sort((h,f)=>{const u=parseInt(e(h).data("original-order"))||0,i=parseInt(e(f).data("original-order"))||0;return u-i}):g.sort((h,f)=>{const u=e(h).find(".award-card"),i=e(f).find(".award-card");let m=5,v=5;return l.forEach((b,C)=>{u.hasClass(`award-card-${b}`)&&(m=C),i.hasClass(`award-card-${b}`)&&(v=C)}),r==="rarity-desc"?m-v:v-m}),g.forEach((h,f)=>{const u=e(h);u.data("original-order")||u.attr("data-original-order",f),u.removeClass("filter-visible filter-entering filter-hiding filter-hidden"),d.append(h)}),setTimeout(()=>{d.children('[class*="col-"]').each(function(h){const f=e(this);setTimeout(()=>{f.addClass("filter-entering"),setTimeout(()=>{f.removeClass("filter-entering").addClass("filter-visible")},300)},h*30)})},10)})};e(".award-grid").each(function(){e(this).children('[class*="col-"]').each(function(r){e(this).attr("data-original-order",r)})}),o.on("change",function(){n(e(this).val()),s()})},InitPopulationMeter(){const t=e(".tier-population-meter");if(!t.length)return;const a=25,s=400,o=d=>{const g=d.width();let u=Math.floor(g/(4+4));return u<5&&(u=5),u>80&&(u=80),u},l=(d,g,h)=>{const f=parseInt(d.data("pct"))||0,u=o(d),i=Math.round(f/100*u);d.empty();for(let m=0;m<u;m++){const v=e('<div class="tier-population-bar"></div>');if(m<i)if(g){v.addClass("animate-pending");const C=h*s+m*a;setTimeout(()=>{v.removeClass("animate-pending").addClass("active")},C)}else v.addClass("active");d.append(v)}},n=d=>{t.each(function(g){l(e(this),d,g)})};n(!0);let r;e(window).on("resize",()=>{clearTimeout(r),r=setTimeout(()=>{n(!1)},150)})},InitMemberSearch(){const t=e("#member-search");if(!t.length)return;const a=e(".desktop-search-loader"),s=e("#searchclear");let o=null;const l=1e3,n=()=>{a.addClass("active"),o&&clearTimeout(o),o=setTimeout(()=>{if(o=null,!t.val().trim()){a.removeClass("active");return}c.GetSearchResults()},l)};t.on("keydown",n),t.on("paste",()=>{setTimeout(n,0)}),t.on("input",()=>{t.val().trim()||(a.removeClass("active"),s.removeClass("visible"))});const r=()=>{e("section.search-results").addClass("closed").removeClass("open"),e("body").removeClass("search-active"),e(".content").css("margin-top",""),t.val(""),s.removeClass("visible")};s.on("click",r),e(".content").on("click",()=>{e("body").hasClass("search-active")&&r()})},GetSearchResults(){const t=e("#member-search").val();t&&e.ajax({url:`${window.Laravel.appPath}/search/members`,type:"GET",data:{q:t},success:a=>{window.scrollTo(0,0),e(".desktop-search-loader").removeClass("active"),e("#searchclear").addClass("visible"),e("section.search-results").html(a).addClass("open").removeClass("closed"),e("body").addClass("search-active"),setTimeout(()=>{e(".content").css("margin-top","20px")},50)}})},InitCollectionSearch(){const t=e("#search-collection");t.length&&t.on("keyup",function(){const a=e(this).val(),s=new RegExp(`^${a}`,"i");e(".collection .collection-item").each(function(){e(this).toggle(s.test(e(this).text()))})})},InitRepeater(){const t=e(".repeater");t.length&&t.repeater({isFirstItemUndeletable:!0})},InitTabActivate(){const t=e(".nav-tabs");t.length&&(t.stickyTabs(),e('a[data-toggle="tab"]').on("shown.bs.tab",()=>{e.sparkline_display_visible()}))},InitSettings(){const t=e(".settings-toggle, .mobile-settings-toggle"),a=e(".settings-overlay"),s=e(".settings-slideover"),o=e(".settings-close");if(!t.length)return;const l=()=>{a.addClass("active"),s.addClass("active"),t.addClass("active"),e("body").addClass("settings-open")},n=()=>{a.removeClass("active"),s.removeClass("active"),t.removeClass("active"),e("body").removeClass("settings-open")};t.on("click",u=>{u.preventDefault(),s.hasClass("active")?n():l()}),a.on("click",n),o.on("click",n),e(document).on("keydown",u=>{u.key==="Escape"&&s.hasClass("active")&&n()});let r=null;const d=e(".settings-save-status"),g=()=>{r&&clearTimeout(r),d.text("Saving...").removeClass("saved error").addClass("saving");const u={_token:e('input[name="_token"]').val(),disable_animations:e("#setting-disable-animations").is(":checked"),mobile_nav_side:e("#setting-mobile-nav-side").val(),snow:e("#setting-snow").val(),snow_ignore_mouse:e("#setting-snow-ignore-mouse").is(":checked"),theme:e("#setting-theme").val()};e.ajax({url:`${window.Laravel.appPath}/settings`,type:"POST",data:u,success:()=>{d.text("Saved").removeClass("saving error").addClass("saved"),r=setTimeout(()=>{d.text("").removeClass("saved")},2e3),c.ApplySettings(u)},error:()=>{d.text("Error saving").removeClass("saving saved").addClass("error")}})};e("#setting-disable-animations, #setting-snow-ignore-mouse").on("change",g),e(".settings-btn[data-setting]").on("click",function(){const u=e(this),i=u.data("setting"),m=u.data("value");u.siblings(".settings-btn").removeClass("active"),u.addClass("active"),e(`#setting-${i.split("_").join("-")}`).val(m),i==="theme"&&f(m),i==="snow"&&h(m),g()});const h=u=>{e("#snow-mouse-setting").toggle(u!=="no_snow")},f=u=>{const i=u==="shattrath";e('.settings-btn[data-value="motes"]').toggle(i),!i&&e("#setting-snow").val()==="motes"&&(e("#setting-snow").val("no_snow"),e('.settings-btn[data-setting="snow"]').removeClass("active"),e('.settings-btn[data-value="no_snow"]').addClass("active"),h("no_snow"));const m=document.getElementById("favicon");if(m){const v={shattrath:"/images/logo-shattrath.svg",aod:"/images/logo-aod.svg"};m.href=v[u]||"/images/logo_v2.svg"}};f(e("#setting-theme").val())},ApplySettings(t){if(t.disable_animations?e("body").addClass("no-animations"):e("body").removeClass("no-animations"),t.mobile_nav_side==="left"?e("body").addClass("mobile-nav-left"):e("body").removeClass("mobile-nav-left"),t.theme&&document.documentElement.setAttribute("data-theme",t.theme),typeof initSnowStorm=="function"){let a=0;t.snow==="some_snow"?a=32:t.snow==="all_the_snow"&&(a=160),initSnowStorm(a,t.snow_ignore_mouse)}if(typeof initMotesOfLight=="function"){let a=0;t.snow==="motes"&&(a=35),initMotesOfLight(a,t.snow_ignore_mouse)}},InitProfileModals(){const t=e("#part-time-divisions-modal"),a=e("#ingame-handles-modal"),s=e("#transfer-request-modal");if(!t.length&&!a.length&&!s.length)return;t.add(a).add(s).on("show.bs.modal",()=>{e(".settings-overlay").removeClass("active"),e(".settings-slideover").removeClass("active"),e(".settings-toggle, .mobile-settings-toggle").removeClass("active"),e("body").removeClass("settings-open")}),e("#save-part-time-divisions").on("click",function(){const l=e(this),n=t.find(".modal-save-status"),r=[];t.find('input[name="divisions[]"]:checked').each(function(){r.push(e(this).val())}),l.prop("disabled",!0),n.text("Saving...").removeClass("saved error").addClass("saving"),e.ajax({url:`${window.Laravel.appPath}/settings/part-time-divisions`,type:"POST",data:{_token:p,divisions:r},success:d=>{n.text("Saved!").removeClass("saving error").addClass("saved"),e('.settings-link-btn[data-target="#part-time-divisions-modal"] .settings-link-count').text(d.count),setTimeout(()=>{t.modal("hide"),n.text("").removeClass("saved")},1e3)},error:()=>{n.text("Error saving").removeClass("saving saved").addClass("error")},complete:()=>{l.prop("disabled",!1)}})});let o=e("#handles-container .handle-row").length;e("#add-handle").on("click",()=>{const n=e("#handle-row-template").html().replace(/__INDEX__/g,o);e("#handles-container").append(n),o++}),e(document).on("click",".remove-handle",function(){e(this).closest(".handle-row").remove()}),e("#save-ingame-handles").on("click",function(){const l=e(this),n=a.find(".modal-save-status"),r=[];e("#handles-container .handle-row").each(function(){const d=e(this),g=d.find(".handle-select").val(),h=d.find('input[type="text"]').val();g&&h&&r.push({id:d.data("id")||"",handle_id:g,value:h,primary:d.find(".handle-primary input").is(":checked")?1:0})}),l.prop("disabled",!0),n.text("Saving...").removeClass("saved error").addClass("saving"),e.ajax({url:`${window.Laravel.appPath}/settings/ingame-handles`,type:"POST",data:{_token:p,handles:r},success:d=>{n.text("Saved!").removeClass("saving error").addClass("saved"),e('.settings-link-btn[data-target="#ingame-handles-modal"] .settings-link-count').text(d.count),setTimeout(()=>{a.modal("hide"),n.text("").removeClass("saved")},1e3)},error:()=>{n.text("Error saving").removeClass("saving saved").addClass("error")},complete:()=>{l.prop("disabled",!1)}})}),e("#save-transfer-request").on("click",function(){const l=e(this),n=e("#transfer-division-select").val();if(!n){toastr.warning("Please select a division");return}l.prop("disabled",!0),e.ajax({url:`${window.Laravel.appPath}/settings/transfer-request`,type:"POST",data:{_token:p,division_id:n},success:r=>{s.modal("hide"),toastr.success(r.message),setTimeout(()=>{window.location.reload()},1500)},error:r=>{const d=r.responseJSON?.error||"Error submitting request";toastr.error(d),l.prop("disabled",!1)}})}),s.on("hidden.bs.modal",()=>{e("#transfer-division-select").val(""),e("#save-transfer-request").prop("disabled",!1)})},InitNoSquadModal(){const t=e("#no-squad-modal");if(!t.length)return;let a=!1;t.on("show.bs.modal",()=>{if(a)return;const s=t.data("url");e.get(s,o=>{const l=e("#no-squad-list");if(l.empty(),o.members.length===0)l.html('<p class="text-muted">No members found.</p>');else{const n={};o.members.forEach(r=>{n[r.platoon]||(n[r.platoon]={members:[],manage_url:r.manage_url}),n[r.platoon].members.push(r)}),Object.keys(n).sort().forEach(r=>{const d=n[r],g=e('<div class="no-squad-group"></div>');g.append(`<div class="no-squad-platoon-header"><span>${r}</span><a href="${d.manage_url}" class="btn btn-sm btn-accent"><i class="fa fa-arrows-alt"></i> Assign</a></div>`);const h=e('<div class="no-squad-members"></div>');d.members.forEach(f=>{h.append(`<span class="no-squad-member">${f.name}</span>`)}),g.append(h),l.append(g)})}e("#no-squad-loading").hide(),l.show(),a=!0})})},InitWelcomeModal(){const t=e("#welcome-modal");t.length&&(t.modal("show"),t.on("hidden.bs.modal",()=>{e.ajax({url:`${window.Laravel.appPath}/settings`,type:"POST",data:{_token:p,welcomed:!0}})}))},InitLeaderboardTabs(){const t=e(".leaderboard-tab"),a=e(".leaderboard-panel");t.length&&(t.on("click",function(){const s=e(this).data("tab");t.removeClass("active"),a.removeClass("active"),e(this).addClass("active"),e(`.leaderboard-panel[data-panel="${s}"]`).addClass("active")}),e(".leaderboard-card.animate-fade-in-up").on("animationend",function(){e(this).removeClass("animate-fade-in-up").css("opacity","")}))},InitInactiveTabs(){const t=e(".inactive-tab"),a=e(".inactive-panel"),s=e("#inactive-search");if(!t.length)return;c.pendingTabRefresh={inactive:!1,flagged:!1},c.inactiveTables={},e(".inactive-table").each(function(){const n=e(this),r=n.closest(".inactive-panel").data("panel")||"default";c.inactiveTables[r]=n.DataTable({paging:!1,info:!1,searching:!0,order:[[2,"asc"]],columnDefs:[{targets:0,orderable:!1,visible:!1},{targets:-1,orderable:!1}],dom:"t"})});const o=(n,r)=>{if(!r&&c.pendingTabRefresh[n]){window.location.href=`${window.location.pathname}#${n}`,window.location.reload();return}t.removeClass("active"),a.removeClass("active"),e(`.inactive-tab[data-tab="${n}"]`).addClass("active"),e(`.inactive-panel[data-panel="${n}"]`).addClass("active"),s.val()&&c.FilterInactiveTable(s.val()),c.inactiveTables[n]&&c.inactiveTables[n].columns.adjust()};t.on("click",function(){const n=e(this).data("tab");o(n),history.replaceState(null,null,`#${n}`)});const l=window.location.hash.replace("#","");l&&t.filter(`[data-tab="${l}"]`).length&&o(l,!0),s.length&&s.on("input",function(){c.FilterInactiveTable(e(this).val())})},FilterInactiveTable(t){const a=e(".inactive-panel.active").data("panel"),s=c.inactiveTables&&c.inactiveTables[a];s&&s.search(t).draw()},InitParttimerSearch(){const t=e("#parttimer-search");t.length&&t.on("input",function(){const a=e(this).val().toLowerCase();e(".inactive-panel.active tbody tr").each(function(){const s=e(this).text().toLowerCase();e(this).toggle(s.indexOf(a)!==-1)})})},InitAddParttimer(){const t=e("#add-parttimer-modal");if(!t.length)return;const a=e("#parttimer-member-search"),s=e("#parttimer-member-id"),o=e("#parttimer-selected-member"),l=o.find(".selected-member-name"),n=e("#add-parttimer-submit");a.bootcomplete({url:`${window.Laravel.appPath}/search-member/`,minLength:3,idField:!0,method:"POST",dataParams:{_token:p}}),a.on("bootcomplete.selected",(r,d,g)=>{s.val(d),l.text(g),o.show(),a.hide(),n.prop("disabled",!1)}),o.on("click",".clear-selected-member",()=>{s.val(""),l.text(""),o.hide(),a.val("").show().focus(),n.prop("disabled",!0)}),t.on("hidden.bs.modal",()=>{s.val(""),l.text(""),o.hide(),a.val("").show(),n.prop("disabled",!0),e("#parttimer-handle-value").val("")})},InitNoteReminderDetection(){const t=[/\bpm\s*sent\b/i,/\bdm\s*sent\b/i,/\bmsg\s*sent\b/i,/\bpm'?e?d\b/i,/\bsent\s*(a\s+)?(pm|dm|msg|message|notice|reminder)\b/i,/\binactiv(ity|e)?\s+(notice|reminder|warning|msg|message|pm|dm|check)\b/i,/\bactivity\s+(reminder|notice|pm|dm|msg|message)\b/i,/\b(reminder|notice)\s+sent\b/i,/\b(wellness|welfare)\s+(check|message)\b/i,/\bforum\s+(notice|reminder|pm|dm|inactiv)/i,/\bdiscord\s+(message|dm|pm|notice|reminder)/i,/\bfinal\s+(notice|reminder|warning)\b/i,/\b(1[04]|2[18]|30|35|4[05]|50|60|70|80|85|90)\s*[\-\+]*\s*day/i,/\b[1234]\s*week/i,/\b[123]\s*month/i,/\bmessaged\s+(regarding|about|for|on|via|through|re:?)/i,/\bcontacted\s+(regarding|about|for)/i,/\breached\s+out\s+(about|regarding|for|in|to)/i,/\b(days?|weeks?)\s+(inactive|inactiv|reminder|over|behind)\b/i,/\bno\s+(activity|response|reply)\b/i,/\binactive\s+(for|on|in|warning)\b/i,/\breminder\s+(to|about|for|sent|pm)\b/i,/\bpinged\s+for\s+inactiv/i],a=[/\bremoved\s+(for|due\s+to)\s+inactiv/i,/\bflagged\s+(for|member|notice)\b/i,/\bloa\b/i,/\bleave\s+(of\s+absence|request|expired)\b/i,/\bpromot(ed|ion)\b/i,/\brecruit/i,/\bwelcome\b/i,/\bremoval\b/i,/\bresign/i,/\bviolation\b/i];e(document).on("input",".note-body-input",function(){const s=e(this),o=s.siblings(".reminder-note-suggestion"),l=s.val();if(o.data("dismissed"))return;const n=l.length<100&&t.some(d=>d.test(l)),r=a.some(d=>d.test(l));o.toggle(n&&!r)}),e(document).on("click",".dismiss-suggestion",function(){e(this).closest(".reminder-note-suggestion").data("dismissed",!0).hide()}),e("#create-member-note").on("hidden.bs.modal",function(){e(this).find(".reminder-note-suggestion").removeData("dismissed").hide()})},InitActivityReminderToggle(){e(document).on("click",".activity-reminder-toggle",function(t){t.preventDefault();const a=e(this),s=a.data("member-id");a.prop("disabled")||(a.prop("disabled",!0),e.ajax({url:`${window.Laravel.appPath}/members/${s}/set-activity-reminder`,method:"POST",data:{_token:p},success:o=>{a.removeClass("btn-success").addClass("btn-default"),a.html(`<i class="fa fa-bell"></i> <span class="reminded-date">${o.date}</span>`),a.attr("title",o.title)},error:o=>{const l=o.responseJSON?.message||"Failed to set reminder";toastr.error(l),a.prop("disabled",!1)}}))}),e(document).on("click",".set-activity-reminder-btn",function(t){t.preventDefault();const a=e(this),s=a.data("url");if(a.prop("disabled")||a.hasClass("reminder-sent"))return;a.prop("disabled",!0);const o=a.html();a.html('<i class="fa fa-spinner fa-spin"></i> Sending...'),e.ajax({url:s,method:"POST",data:{_token:p},success:l=>{a.addClass("reminder-sent"),a.html(`<i class="fa fa-check"></i> Reminded ${l.date}`),toastr.success("Activity reminder marked")},error:l=>{const n=l.responseJSON?.message||"Failed to set reminder";toastr.error(n),a.prop("disabled",!1),a.html(o)}})}),e(document).on("click",".clear-reminders-btn",function(t){t.preventDefault();const a=e(this),s=a.data("url");a.prop("disabled")||confirm("Clear all activity reminders for this member?")&&(a.prop("disabled",!0),a.html('<i class="fa fa-spinner fa-spin"></i> Clearing...'),e.ajax({url:s,method:"DELETE",data:{_token:p},success:o=>{toastr.success(`${o.count} reminder(s) cleared`),e("#member-reminder-history-modal").modal("hide"),e(".stat-reminder-badge").fadeOut()},error:o=>{const l=o.responseJSON?.message||"Failed to clear reminders";toastr.error(l),a.prop("disabled",!1),a.html('<i class="fa fa-trash"></i> Clear Reminders')}}))})},InitTrashedNotes(){const t=e(".toggle-trashed-notes");if(!t.length)return;const a=t.data("count");t.on("click",function(){const s=e(this),o=e(".notes-active-list"),l=e(".notes-trashed-list");l.is(":visible")?(l.hide(),o.show(),s.removeClass("btn-warning").addClass("btn-default"),s.html(`<i class="fa fa-trash"></i> Deleted (${a})`)):(o.hide(),l.show(),s.removeClass("btn-default").addClass("btn-warning"),s.html('<i class="fa fa-sticky-note"></i> Active Notes'))}),e(document).on("click",".restore-note-btn",function(){const s=e(this),o=s.data("url"),l=s.closest(".note-card");s.prop("disabled",!0).html('<i class="fa fa-spinner fa-spin"></i>'),e.ajax({url:o,method:"POST",data:{_token:p},success:()=>{l.fadeOut(300,function(){e(this).remove()}),toastr.success("Note restored")},error:n=>{toastr.error(n.responseJSON?.message||"Failed to restore note"),s.prop("disabled",!1).html('<i class="fa fa-undo"></i> Restore')}})}),e(document).on("click",".force-delete-note-btn",function(){const s=e(this),o=s.data("url"),l=s.closest(".note-card");confirm("Permanently delete this note? This cannot be undone.")&&(s.prop("disabled",!0).html('<i class="fa fa-spinner fa-spin"></i>'),e.ajax({url:o,method:"DELETE",data:{_token:p},success:()=>{l.fadeOut(300,function(){e(this).remove()}),toastr.success("Note permanently deleted")},error:n=>{toastr.error(n.responseJSON?.message||"Failed to delete note"),s.prop("disabled",!1).html('<i class="fa fa-trash"></i> Delete Forever')}}))})},InitInactiveBulkMode(){const t=e(".inactive-bulk-toggle");if(!t.length)return;let a=!1,s=!1,o=!0,l=null;const n={inactive:{bar:e("#inactive-bulk-bar"),data:e("#inactive-pm-member-data"),checkboxClass:"inactive-member-checkbox",selectAllClass:"inactive-select-all"},flagged:{bar:e("#flagged-bulk-bar"),data:e('<input type="hidden" id="flagged-pm-member-data">'),checkboxClass:"flagged-member-checkbox",selectAllClass:"flagged-select-all"}};n.flagged.bar.append(n.flagged.data);const r=(i,m)=>{const v=e(`.inactive-tab[data-tab="${i}"] .inactive-tab-count`),b=parseInt(v.text())||0;v.text(Math.max(0,b+m))},d=i=>()=>{const m=e(`.${i.checkboxClass}:checked`).map(function(){return e(this).val()}).get();i.data.val(m.join(",")),m.length>0?(i.bar.find(".status-text").text(`${m.length} selected`),i.bar.slideDown(200)):i.bar.slideUp(200);const v=e(`.${i.checkboxClass}`).length,b=m.length;e(`.${i.selectAllClass}`).prop("checked",b>0&&b===v),e(`.${i.selectAllClass}`).prop("indeterminate",b>0&&b<v)},g=d(n.inactive),h=d(n.flagged),f=(i,m)=>{e(`.${i.checkboxClass}, .${i.selectAllClass}`).prop("checked",!1),m()},u=i=>{const m=i.data.val();if(!m){toastr.warning("No members selected");return}const v=i.btn;v.prop("disabled",!0).html('<span class="themed-spinner spinner-sm"></span>'),e.ajax({url:i.url,method:"POST",data:{_token:p,member_ids:m.split(",")},success:i.onSuccess,error:b=>{toastr.error(b.responseJSON?.message||i.errorMessage)},complete:()=>{v.prop("disabled",!1).html(i.buttonHtml)}})};t.on("click",function(){a=!a;const i=e(this);i.toggleClass("active",a),e(".inactive-table").toggleClass("bulk-mode",a),c.inactiveTables&&Object.values(c.inactiveTables).forEach(m=>{m.column(0).visible(a)}),a?i.html('<i class="fa fa-times"></i> Exit Bulk Mode'):(i.html("Bulk Mode"),f(n.inactive,g),f(n.flagged,h))}),e(document).on("change",`.${n.inactive.checkboxClass}`,g),e(document).on("change",`.${n.flagged.checkboxClass}`,h),e(document).on("mousedown",".inactive-table tbody tr",function(i){if(!a||e(i.target).is("a, button, input, .fa")||i.which!==1)return;i.preventDefault(),s=!0,l=this;const v=e(this).closest(".flagged-table").length>0?n.flagged.checkboxClass:n.inactive.checkboxClass,b=e(this).find(`.${v}`);b.length&&(o=!b.prop("checked"),b.prop("checked",o),e(this).toggleClass("drag-selected",o))}),e(document).on("mouseenter",".inactive-table tbody tr",function(){if(!s||!a)return;const m=e(this).closest(".flagged-table").length>0?n.flagged.checkboxClass:n.inactive.checkboxClass,v=e(this).find(`.${m}`);v.length&&(v.prop("checked",o),e(this).toggleClass("drag-selected",o))}),e(document).on("mouseup",()=>{if(s){const i=l&&e(l).closest(".flagged-table").length>0;s=!1,l=null,e(".inactive-table tbody tr").removeClass("drag-selected"),(i?h:g)()}}),e(document).on("change",".inactive-select-all, .flagged-select-all",function(){const i=e(this).hasClass("flagged-select-all"),m=i?n.flagged:n.inactive,v=i?h:g;e(this).closest(".inactive-panel").find(`.${m.checkboxClass}`).prop("checked",e(this).prop("checked")),v()}),e(document).on("click",".inactive-bulk-close",function(){const i=e(this).closest(".bulk-action-bar").attr("id")==="flagged-bulk-bar";f(i?n.flagged:n.inactive,i?h:g)}),e("#inactive-bulk-reminder-btn").on("click",function(){u({btn:e(this),data:n.inactive.data,url:e(this).data("url"),errorMessage:"Failed to set reminders",buttonHtml:'<i class="fa fa-bell text-accent"></i> <span class="hidden-xs hidden-sm">Reminder</span>',onSuccess:i=>{let m=`${i.count} member${i.count!==1?"s":""} marked as reminded`;i.skipped>0&&(m+=` (${i.skipped} skipped - already reminded today)`),toastr.success(m),i.updatedIds.forEach(v=>{const b=e(`.activity-reminder-toggle[data-member-id="${v}"]`);b.length&&b.removeClass("btn-success").addClass("btn-default").html(`<i class="fa fa-bell"></i> <span class="reminded-date">${i.date}</span>`).attr("title","Reminded just now").prop("disabled",!0)}),f(n.inactive,g)}})}),e("#inactive-bulk-flag-btn").on("click",function(){u({btn:e(this),data:n.inactive.data,url:e(this).data("url"),errorMessage:"Failed to flag members",buttonHtml:'<i class="fa fa-flag"></i> <span class="hidden-xs hidden-sm">Flag</span>',onSuccess:i=>{toastr.success(i.message),i.flaggedIds.forEach(m=>{e(`.inactive-member-checkbox[value="${m}"]`).closest("tr").fadeOut(300,function(){e(this).remove()})}),f(n.inactive,g),r("inactive",-i.count),r("flagged",i.count),c.pendingTabRefresh&&(c.pendingTabRefresh.flagged=!0)}})}),e("#flagged-bulk-unflag-btn").on("click",function(){u({btn:e(this),data:n.flagged.data,url:e(this).data("url"),errorMessage:"Failed to unflag members",buttonHtml:'<i class="fa fa-flag"></i> <span class="hidden-xs hidden-sm">Unflag</span>',onSuccess:i=>{toastr.success(i.message),i.unflaggedIds.forEach(m=>{e(`.flagged-member-checkbox[value="${m}"]`).closest("tr").fadeOut(300,function(){e(this).remove(),e(".flagged-member-checkbox").length===0&&e(".flagged-table").closest(".table-responsive").replaceWith('<div class="inactive-empty"><i class="fa fa-flag-o"></i><h4>No Flagged Members</h4><p>There are currently no members flagged for removal.</p></div>')})}),f(n.flagged,h),r("flagged",-i.count),r("inactive",i.count),c.pendingTabRefresh&&(c.pendingTabRefresh.inactive=!0)}})})},InitActivityFeedToggle(){e(document).on("show.bs.collapse",".activity-group-members",function(){e(".activity-group-members.in").not(this).collapse("hide")}),e(document).on("click",".activity-feed-item",function(t){if(e(t.target).closest("a").length)return;const a=e(this).find(".activity-group-toggle");a.length&&e(a.data("target")).collapse("toggle")})}}})(window.jQuery);function k(){const e=window.jQuery;if(!e||typeof e.fn.DataTable!="function"||typeof e.fn.bootcomplete!="function"){setTimeout(k,50);return}c.Setup()}k();
