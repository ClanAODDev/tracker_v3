var h=h||{};(function(t){const f=t("meta[name=csrf-token]").attr("content"),p=a=>t("<span>").text(a).html();h={initUnassigned(){t(".organize-platoons-btn").on("click",a=>{const e=t(a.currentTarget);t(".platoon-assignments-section").hasClass("organize-mode")?(e.html('<i class="fa fa-arrows-alt"></i> Organize'),e.removeClass("btn-success").addClass("btn-accent"),t(".unassigned-organizer-members").slideUp(200),t(".platoon-assignments-section").removeClass("organize-mode")):(e.html('<i class="fa fa-check"></i> Done'),e.removeClass("btn-accent").addClass("btn-success"),t(".unassigned-organizer-members").slideDown(200),t(".platoon-assignments-section").addClass("organize-mode"),this.enablePlatoonDragDrop())}),t(".platoon").on("click",a=>{t(".platoon-assignments-section").hasClass("organize-mode")&&a.preventDefault()})},initScrollToOrganize(){t(document).on("click",".scroll-to-organize",a=>{const e=t("#platoons");e.length&&(a.preventDefault(),t("html, body").animate({scrollTop:e.offset().top-20},400,function(){const n=t(".organize-platoons-btn");!t(".platoon-assignments-section").hasClass("organize-mode")&&n.length&&n.trigger("click"),e.addClass("highlight-section"),setTimeout(()=>{e.removeClass("highlight-section")},1500)}))})},enablePlatoonDragDrop(){t(".unassigned-platoon-member").data("ui-draggable")||(t(".unassigned-platoon-member").draggable({revert:!0,revertDuration:200,zIndex:1e3,cursor:"grabbing",helper:"clone",appendTo:"body"}),t(".platoon").droppable({hoverClass:"panel-c-success",drop:function(a,e){const n=t(this),o=window.Laravel.appPath,s=e.draggable.attr("data-member-id"),l=n.attr("data-platoon-id"),c=t(e.draggable);t.ajax({type:"POST",url:`${o}/members/${s}/assign-platoon`,data:{platoon_id:l,_token:f},success:()=>{toastr.success("Member assigned to platoon!"),c.fadeOut(200,function(){t(this).remove(),t(".unassigned-platoon-member").length<1&&(t(".unassigned-organizer").slideUp(),t(".platoon-assignments-section").removeClass("organize-mode"))});const r=n.find(".platoon-stat-badge .fa-users").parent(),d=parseInt(r.text().trim())||0;r.html(`<i class="fa fa-users"></i> ${d+1}`)},error:()=>{toastr.error("Failed to assign member to platoon")}})}}))},initApplicationsModal(){const a=t("#open-applications-modal");if(!a.length)return;const e=a.data("url");let n=!1;a.on("click",s=>{s.preventDefault();const l=new URLSearchParams(window.location.search);l.set("applications","1"),window.history.replaceState(null,"",`?${l.toString()}`),t("#applicationsModal").modal("show")}),t("#applicationsModal").on("shown.bs.modal",()=>{n||(this.loadApplications(e),n=!0)}),t("#applicationsModal").on("hidden.bs.modal",()=>{const s=new URLSearchParams(window.location.search);s.delete("applications"),s.delete("application");const l=s.toString();window.history.replaceState(null,"",l?`?${l}`:window.location.pathname)});const o=new URLSearchParams(window.location.search);(o.has("applications")||o.has("application"))&&t("#applicationsModal").modal("show")},loadApplications(a){const e=t("#applications-loading"),n=t("#applications-content"),o=t("#applications-empty"),s=t("#applications-list"),l=t("#applications-detail");t.ajax({url:a,type:"GET",success:c=>{if(e.addClass("hidden"),!c.applications||!c.applications.length){o.removeClass("hidden");return}const r=c.applications,d=new URLSearchParams(window.location.search).get("application");let m=0;if(d){for(let i=0;i<r.length;i++)if(String(r[i].id)===String(d)){m=i;break}}r.forEach((i,g)=>{s.append(`<a href="#" class="list-group-item application-item${g===m?" active":""}" data-index="${g}"><strong>${p(i.discord_username)}</strong><span class="text-muted pull-right" style="font-size: 12px;">${p(i.created_at)}</span></a>`);let u=`<div class="panel panel-filled application-modal-detail${g!==m?" hidden":""}" data-index="${g}" style="border-radius: 8px;"><div class="panel-body"><div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid rgba(255,255,255,0.06);"><strong style="font-size: 16px;">${p(i.discord_username)}</strong><span class="text-muted" style="font-size: 12px;">${p(i.created_at)}</span></div>`;i.responses.forEach(b=>{u+=`<div style="margin-bottom: 14px;"><div class="text-muted" style="font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">${p(b.label)}</div><div style="margin-top: 2px;">${p(b.value)}</div></div>`}),u+="</div></div>",l.append(u)}),s.on("click",".application-item",i=>{i.preventDefault();const g=t(i.currentTarget).data("index");s.find(".application-item").removeClass("active"),t(i.currentTarget).addClass("active"),l.find(".application-modal-detail").addClass("hidden"),l.find(`.application-modal-detail[data-index="${g}"]`).removeClass("hidden")}),n.removeClass("hidden")},error:()=>{e.html('<span class="text-danger"><i class="fa fa-exclamation-triangle"></i> Failed to load applications.</span>')}})},setup(){this.initAutocomplete(),this.initPromotionsChart(),this.initUnassigned(),this.initScrollToOrganize(),this.initApplicationsModal()},initPromotionsChart(){const a=document.getElementById("promotions-chart");if(!a||typeof Chart>"u")return;const e=JSON.parse(a.dataset.values||"[]"),n=JSON.parse(a.dataset.labels||"[]");if(!e||!n||e.length===0)return;const o=getComputedStyle(document.documentElement),s=[o.getPropertyValue("--color-muted").trim()||"#949ba2",o.getPropertyValue("--color-primary").trim()||"#0f83c9",o.getPropertyValue("--color-success").trim()||"#1bbf89",o.getPropertyValue("--color-accent").trim()||"#f7af3e",o.getPropertyValue("--color-info").trim()||"#56c0e0",o.getPropertyValue("--color-danger").trim()||"#db524b"],l=e.map((d,m)=>s[m%s.length]),c="rgba(255,255,255,0.04)",r=o.getPropertyValue("--color-text-light").trim()||"#949ba2";new Chart(a,{type:"bar",data:{labels:n,datasets:[{data:e,backgroundColor:l,borderWidth:0,barThickness:20}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{usePointStyle:!0,boxPadding:6,callbacks:{label:d=>`${d.parsed.x} promotions`}}},scales:{x:{beginAtZero:!0,grid:{color:c},ticks:{stepSize:1,color:r}},y:{grid:{display:!1},ticks:{color:r}}}}})},initAutocomplete(){t("#leader").bootcomplete({url:`${window.Laravel.appPath}/search-member/`,minLength:3,idField:!0,method:"POST",dataParams:{_token:f}})}}})(window.jQuery);function v(){const t=window.jQuery;if(!t||typeof t.fn.DataTable!="function"||typeof t.fn.bootcomplete!="function"){setTimeout(v,50);return}h.setup()}v();
