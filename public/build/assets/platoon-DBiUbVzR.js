var v=v||{};(function(e){v={dataTable:null,setup:function(){this.handleMembers(),this.handleSquadMembers(),this.handleForumActivityChart(),this.handleVoiceActivityChart(),this.initAutocomplete(),this.initTagFilter(),this.initBulkTags()},handleForumActivityChart:function(){var t=e(".forum-activity-chart");t.length&&new Chart(t,{type:"doughnut",data:{datasets:[{data:t.data("values"),backgroundColor:t.data("colors"),borderWidth:0}],labels:t.data("labels")},options:{rotation:1*Math.PI,circumference:1*Math.PI,legend:{position:"bottom",labels:{boxWidth:5,fontColor:"#949ba2"},label:{fullWidth:!1}}}})},handleVoiceActivityChart:function(){var t=e(".voice-activity-chart");t.length&&new Chart(t,{type:"doughnut",data:{datasets:[{data:t.data("values"),backgroundColor:t.data("colors"),borderWidth:0}],labels:t.data("labels")},options:{rotation:1*Math.PI,circumference:1*Math.PI,legend:{position:"bottom",labels:{boxWidth:5,fontColor:"#949ba2"},label:{fullWidth:!1}}}})},handleSquadMembers:function(){e(".sortable-squad").sortable({revert:"invalid"}),e(".draggable").draggable({connectToSortable:"ul",revert:"invalid",scroll:!0,scrollSensitivity:100});let t,s,c,o;e(".mod-plt .sortable").sortable({connectWith:"ul",placeholder:"ui-state-highlight",forcePlaceholderSize:!0,revert:"invalid",receive:function(d,r){t=e(r.item).attr("data-member-id"),s=e(this).attr("data-squad-id"),c=e(r.sender).find("li").length,o=e(this).find("li").length,s===void 0?(toastr.error("You cannot move members to the unassigned list"),e(".mod-plt .sortable").sortable("cancel")):(e(".genpop").find("li").length<1&&e(".genpop").fadeOut(),e(r.sender).parent().find(".count").text(c),e(this).parent().find(".count").text(o).effect("highlight"),e.ajax({type:"POST",url:window.Laravel.appPath+"/members/assign-squad",data:{member_id:t,squad_id:s,_token:e("meta[name=csrf-token]").attr("content")},dataType:"json",success:function(){toastr.success("Member reassigned!")},error:function(){toastr.error("Something bad happened...")}}))}})},initAutocomplete:function(){e("#leader").bootcomplete({url:window.Laravel.appPath+"/search-member/",minLength:3,idField:!0,method:"POST",dataParams:{_token:e("meta[name=csrf-token]").attr("content")}})},handleMembers:function(){parseInt(e(".platoon-number").text());var t=new Date;if(t.getDate(),t.getMonth()+1,t.getFullYear(),new Array,e(".members-table").length){let g=function(a,l){l.visible()?e(a).addClass("active"):e(a).removeClass("active")},k=function(){i=!i;var a=s.dataTable.column(0);a.visible(i),i?(n.addClass("active btn-accent").removeClass("btn-default"),n.html('<i class="fa fa-check-circle"></i> Exit Bulk Mode'),e(".members-table").addClass("bulk-mode")):(n.removeClass("active btn-accent").addClass("btn-default"),n.html('<i class="fa fa-check-square-o"></i> Bulk Mode'),e(".members-table").removeClass("bulk-mode"),e(".member-checkbox, #select-all-members").prop("checked",!1),u())},u=function(){var a=[];e(".member-checkbox:checked").each(function(){a.push(e(this).val())}),a.length>=2?(e("#selected-data").css("display","block"),e("#selected-data .status-text").text(a.length+" members selected"),e("#pm-member-data").val(a),e("#tag-member-data").val(a)):(e("#selected-data").hide(),e("#pm-member-data").val(""),e("#tag-member-data").val(""));var l=e(".member-checkbox").length,f=e(".member-checkbox:checked").length;e("#select-all-members").prop("checked",f>0&&f===l),e("#select-all-members").prop("indeterminate",f>0&&f<l)};var p=g,x=k,T=u,s=this;s.dataTable=e("table.members-table").DataTable({initComplete:function(a,l){setTimeout(function(){e(".ld-loading").removeClass("ld-loading"),s.dataTable.columns.adjust()},2e3)},autoWidth:!1,bInfo:!1,oLanguage:{sLengthMenu:""},columnDefs:[{targets:0,visible:!1,orderable:!1,searchable:!1},{targets:8,visible:!1},{targets:"no-search",searchable:!1},{targets:"col-hidden",visible:!1},{iDataSort:1,aTargets:[4]},{iDataSort:12,aTargets:[6]}],stateSave:!0,stateSaveParams:function(a,l){l.columns[0].visible=!1,l.columns[3].visible=!0},stateLoadParams:function(a,l){l.columns[0].visible=!1,l.columns[3].visible=!0},paging:!1}),s.dataTable.column(0).visible(!1);var c;e(window).on("resize",function(){clearTimeout(c),c=setTimeout(function(){s.dataTable.columns.adjust().draw()},100)}),e("a.toggle-vis").each(function(){var a=s.dataTable.column(e(this).data("column"));g(this,a)}),e("a.toggle-vis").on("click",function(a){a.preventDefault();var l=s.dataTable.column(e(this).data("column"));l.visible(!l.visible()),g(this,l)});var o=e(".dataTables_filter input").removeClass("input-sm");o.attr({placeholder:"Search Players",class:"form-control"}),e("#playerFilter").append(o),e(".dataTables_filter label").remove();var d=e("#tag-filter");if(d.length){var r=e('<div class="tag-filter-wrapper"></div>');r.append(d),e("#playerFilter").append(r)}var n=e('<button type="button" class="btn btn-default bulk-mode-toggle"><i class="fa fa-check-square-o"></i> Bulk Mode</button>');e("#playerFilter").append(n),e(".no-sort").removeClass("sorting");var i=!1;n.on("click",function(){k()}),e(document).on("click",".bulk-action-close",function(){e(".member-checkbox, #select-all-members").prop("checked",!1),u()}),e(document).on("change",".member-checkbox",function(){u()}),e(document).on("change","#select-all-members",function(){var a=e(this).prop("checked");e(".member-checkbox").prop("checked",a),u()});var m=!1,b=!0;e(document).on("mousedown",".members-table.bulk-mode tbody tr",function(a){if(!e(a.target).closest("a, button, input, .btn").length&&a.which===1){m=!0,e(this).index();var l=e(this).find(".member-checkbox");b=!l.prop("checked"),l.prop("checked",b),u(),a.preventDefault()}}),e(document).on("mouseenter",".members-table.bulk-mode tbody tr",function(){if(m){var a=e(this).find(".member-checkbox");a.prop("checked",b),u()}}),e(document).on("mouseup",function(){m=!1})}e("#is_tba").click(function(){h()}),h();function h(){e("#is_tba").is(":checked")?e("#leader_id, #leader").prop("disabled",!0).val(""):e("#leader_id, #leader").prop("disabled",!1)}},initTagFilter:function(){var t=this,s=e("#tag-filter");!s.length||!t.dataTable||(s.select2({placeholder:"Filter by tag",allowClear:!0}).on("change",function(){t.dataTable.draw()}),e.fn.dataTable.ext.search.push(function(c,o,d){var r=s.val();if(!r||r.length===0)return!0;for(var n=o[13]?o[13].split(","):[],i=0;i<r.length;i++)if(n.indexOf(r[i])!==-1)return!0;return!1}))},initBulkTags:function(){var t=e("#bulk-tags-modal");if(!t.length)return;var s=e("meta[name=csrf-token]").attr("content");function c(){return e("#tag-member-data").val()?e("#tag-member-data").val().split(","):[]}function o(){var n=[];return e(".bulk-tag-checkbox:checked").each(function(){n.push(e(this).val())}),n}function d(){var n=o().length>0;e("#bulk-assign-tags, #bulk-remove-tags").prop("disabled",!n)}t.on("show.bs.modal",function(){var n=c().length;e("#bulk-tags-member-count").text(n+" member"+(n!==1?"s":"")+" selected"),e(".bulk-tag-checkbox").prop("checked",!1).trigger("change")}),e(document).on("change",".bulk-tag-checkbox",function(){var n=e(this).siblings(".bulk-tag-badge");this.checked?n.addClass("selected"):n.removeClass("selected"),d()});function r(n){var i=c(),m=o(),b=t.data("store-url");if(m.length===0){toastr.warning("Please select at least one tag");return}var h=e("#bulk-assign-tags, #bulk-remove-tags");h.prop("disabled",!0),e.ajax({url:b,method:"POST",data:{member_ids:i,tags:m,action:n,_token:s},success:function(){var p=n==="assign"?"Tags assigned to ":"Tags removed from ";toastr.success(p+i.length+" members"),t.modal("hide"),location.reload()},error:function(){toastr.error("Failed to "+n+" tags")},complete:function(){d()}})}e(document).on("click","#bulk-assign-tags",function(){r("assign")}),e(document).on("click","#bulk-remove-tags",function(){r("remove")})}}})(window.jQuery);v.setup();
