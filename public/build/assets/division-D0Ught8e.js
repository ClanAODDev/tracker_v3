var m=m||{};(function(a){m={initUnassigned:function(){var i=this;a(".organize-platoons-btn").on("click",function(){var t=a(this),n=a(".platoon-assignments-section").hasClass("organize-mode");n?(t.html('<i class="fa fa-arrows-alt"></i> Organize'),t.removeClass("btn-success").addClass("btn-accent"),a(".unassigned-organizer-members").slideUp(200),a(".platoon-assignments-section").removeClass("organize-mode")):(t.html('<i class="fa fa-check"></i> Done'),t.removeClass("btn-accent").addClass("btn-success"),a(".unassigned-organizer-members").slideDown(200),a(".platoon-assignments-section").addClass("organize-mode"),i.enablePlatoonDragDrop())}),a(".platoon").on("click",function(t){a(".platoon-assignments-section").hasClass("organize-mode")&&t.preventDefault()})},initScrollToOrganize:function(){a(document).on("click",".scroll-to-organize",function(i){var t=a("#platoons");t.length&&(i.preventDefault(),a("html, body").animate({scrollTop:t.offset().top-20},400,function(){var n=a(".organize-platoons-btn"),e=a(".platoon-assignments-section").hasClass("organize-mode");!e&&n.length&&n.trigger("click"),t.addClass("highlight-section"),setTimeout(function(){t.removeClass("highlight-section")},1500)}))})},enablePlatoonDragDrop:function(){a(".unassigned-platoon-member").data("ui-draggable")||(a(".unassigned-platoon-member").draggable({revert:!0,revertDuration:200,zIndex:1e3,cursor:"grabbing",helper:"clone",appendTo:"body"}),a(".platoon").droppable({hoverClass:"panel-c-success",drop:function(i,t){var n=a(this),e=window.Laravel.appPath,l=t.draggable.attr("data-member-id"),o=n.attr("data-platoon-id");a.ajax({type:"POST",url:e+"/members/"+l+"/assign-platoon",data:{platoon_id:o,_token:a("meta[name=csrf-token]").attr("content")},success:function(s){toastr.success("Member assigned to platoon!"),a(t.draggable).fadeOut(200,function(){a(this).remove(),a(".unassigned-platoon-member").length<1&&(a(".unassigned-organizer").slideUp(),a(".platoon-assignments-section").removeClass("organize-mode"))});var d=n.find(".platoon-stat-badge .fa-users").parent(),r=parseInt(d.text().trim())||0;d.html('<i class="fa fa-users"></i> '+(r+1))},error:function(){toastr.error("Failed to assign member to platoon")}})}}))},initApplicationsModal:function(){var i=this,t=a("#open-applications-modal");if(!t.length)return;var n=t.data("url"),e=!1;function l(){var o=a("#applicationsModal");o.modal("show"),e||(i.loadApplications(n),e=!0)}t.on("click",function(o){o.preventDefault();var s=new URLSearchParams(window.location.search);s.set("applications","1"),window.history.replaceState(null,"","?"+s.toString()),l()}),a("#applicationsModal").on("hidden.bs.modal",function(){var o=new URLSearchParams(window.location.search);o.delete("applications");var s=o.toString();window.history.replaceState(null,"",s?"?"+s:window.location.pathname)}),new URLSearchParams(window.location.search).has("applications")&&l()},loadApplications:function(i){var t=a("#applications-loading"),n=a("#applications-content"),e=a("#applications-empty"),l=a("#applications-list"),o=a("#applications-detail");a.ajax({url:i,type:"GET",success:function(s){if(t.addClass("hidden"),!s.applications||!s.applications.length){e.removeClass("hidden");return}var d=s.applications;d.forEach(function(r,c){l.append('<a href="#" class="list-group-item application-item'+(c===0?" active":"")+'" data-index="'+c+'"><strong>'+a("<span>").text(r.discord_username).html()+'</strong><span class="text-muted pull-right" style="font-size: 12px;">'+a("<span>").text(r.created_at).html()+"</span></a>");var p='<div class="panel panel-filled application-modal-detail'+(c!==0?" hidden":"")+'" data-index="'+c+'" style="border-radius: 8px;"><div class="panel-body"><div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid rgba(255,255,255,0.06);"><strong style="font-size: 16px;">'+a("<span>").text(r.discord_username).html()+'</strong><span class="text-muted" style="font-size: 12px;">'+a("<span>").text(r.created_at).html()+"</span></div>";r.responses.forEach(function(u){p+='<div style="margin-bottom: 14px;"><div class="text-muted" style="font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">'+a("<span>").text(u.label).html()+'</div><div style="margin-top: 2px;">'+a("<span>").text(u.value).html()+"</div></div>"}),p+="</div></div>",o.append(p)}),l.on("click",".application-item",function(r){r.preventDefault();var c=a(this).data("index");l.find(".application-item").removeClass("active"),a(this).addClass("active"),o.find(".application-modal-detail").addClass("hidden"),o.find('.application-modal-detail[data-index="'+c+'"]').removeClass("hidden")}),n.removeClass("hidden")},error:function(){t.html('<span class="text-danger"><i class="fa fa-exclamation-triangle"></i> Failed to load applications.</span>')}})},setup:function(){this.initAutocomplete(),this.initPromotionsChart(),this.initUnassigned(),this.initScrollToOrganize(),this.initApplicationsModal()},initPromotionsChart:function(){var i=document.getElementById("promotions-chart");if(!(!i||typeof Chart>"u")){var t=JSON.parse(i.dataset.values||"[]"),n=JSON.parse(i.dataset.labels||"[]");if(!(!t||!n||t.length===0)){var e=getComputedStyle(document.documentElement),l=[e.getPropertyValue("--color-muted").trim()||"#949ba2",e.getPropertyValue("--color-primary").trim()||"#0f83c9",e.getPropertyValue("--color-success").trim()||"#1bbf89",e.getPropertyValue("--color-accent").trim()||"#f7af3e",e.getPropertyValue("--color-info").trim()||"#56c0e0",e.getPropertyValue("--color-danger").trim()||"#db524b"],o=t.map(function(r,c){return l[c%l.length]}),s="rgba(255,255,255,0.04)",d=e.getPropertyValue("--color-text-light").trim()||"#949ba2";new Chart(i,{type:"bar",data:{labels:n,datasets:[{data:t,backgroundColor:o,borderWidth:0,barThickness:20}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{usePointStyle:!0,boxPadding:6,callbacks:{label:function(r){return r.parsed.x+" promotions"}}}},scales:{x:{beginAtZero:!0,grid:{color:s},ticks:{stepSize:1,color:d}},y:{grid:{display:!1},ticks:{color:d}}}}})}}},initAutocomplete:function(){a("#leader").bootcomplete({url:window.Laravel.appPath+"/search-member/",minLength:3,idField:!0,method:"POST",dataParams:{_token:a("meta[name=csrf-token]").attr("content")}})}}})(window.jQuery);function g(){var a=window.jQuery;if(!a||typeof a.fn.DataTable!="function"||typeof a.fn.bootcomplete!="function"){setTimeout(g,50);return}m.setup()}g();
