var c=c||{};(function(e){c={Setup:function(){c.InitNavToggle(),c.InitBackToTop(),c.InitClipboard(),c.InitDataTables(),c.InitSparklines(),c.InitPanels(),c.InitSubNavCollapse(),c.InitMemberAutocomplete(),c.InitMobileNav(),c.InitMobileSearch(),c.InitRarityFilter(),c.InitRepeater(),c.InitTabActivate(),c.InitMemberSearch(),c.InitCollectionSearch(),c.InitSmoothScroll(),c.InitSettings(),c.InitProfileModals(),c.InitNoSquadModal(),c.InitLeaderboardTabs(),c.InitInactiveTabs(),c.InitParttimerSearch(),c.InitAddParttimer(),c.InitNoteReminderDetection(),c.InitActivityReminderToggle(),c.InitInactiveBulkMode(),c.InitTrashedNotes(),c.InitActivityFeedToggle()},InitNavToggle:function(){var a=e(".left-nav-toggle a");a.length&&a.on("click",function(i){i.preventDefault(),e("body").toggleClass("nav-toggle"),e("body").hasClass("nav-toggle")?e.get(window.Laravel.appPath+"/primary-nav/collapse"):e.get(window.Laravel.appPath+"/primary-nav/decollapse"),c.RefreshSparklines()})},InitBackToTop:function(){var a=e("#top-link-block");a.length&&e(window).on("scroll",function(){e(this).scrollTop()>100?a.addClass("visible"):a.removeClass("visible")})},InitSmoothScroll:function(){e(".smooth-scroll").on("click",function(a){var i=e(this).attr("href");if(!(!i||!i.startsWith("#"))){a.preventDefault();var t=e(i);if(t.length){var o=t.offset().top-90;e("html, body").stop().animate({scrollTop:o},750,function(){history.replaceState(null,null,i),e(window).trigger("hashchange")})}}})},InitClipboard:function(){if(!(typeof Clipboard>"u")&&e(".copy-to-clipboard").length){var a=new Clipboard(".copy-to-clipboard");a.on("success",function(i){toastr.success("Copied!"),i.clearSelection()})}},InitDataTables:function(){var a=e("table.basic-datatable"),i=e("table.adv-datatable");if(a.length){var t=a.DataTable({paging:!1,bFilter:!1,stateSave:!0,bInfo:!1,order:[],columnDefs:[{targets:"no-sort",orderable:!1}],select:{style:"os",selector:"td:first-child"}});e(".for-pm-selection").length&&t.on("select",function(){var o=t.rows(e(".selected")).data().toArray().map(function(r){return r[4]});o.length>=1?(e("#selected-data").show(),e("#selected-data .status-text").text(o.length+" member"+(o.length===1?"":"s")+" selected"),e("#pm-member-data").val(o)):e("#selected-data").hide()})}i.length&&i.DataTable({order:[],columnDefs:[{targets:"no-sort",orderable:!1}]})},InitSparklines:function(){c.RefreshSparklines();var a;e(window).on("resize",function(){clearTimeout(a),a=setTimeout(c.RefreshSparklines,100)})},RefreshSparklines:function(){e("[census-data]").each(function(){var a=e(this),i=a.closest(".census-sparkline-container").length>0,t=i?80:50;a.sparkline(a.data("counts"),{type:"line",lineColor:"#fff",lineWidth:2,fillColor:"#404652",height:t,width:"100%"}),a.data("weekly-voice")&&a.sparkline(a.data("weekly-voice"),{type:"line",lineColor:"#1bbf89",lineWidth:2,fillColor:"rgba(27, 191, 137, 0.2)",height:t,composite:!0})}),e(".census-pie").each(function(){var a=e(this);a.sparkline(a.data("counts"),{type:"pie",sliceColors:a.data("colors")})})},InitPanels:function(){e(".panel-toggle").on("click",function(a){a.preventDefault();var i=e(a.target).closest("div.panel"),t=e(a.target).closest("i.toggle-icon"),o=e(a.target).find("i.toggle-icon");i.find("div.panel-body").slideToggle(300),i.find("div.panel-footer").slideToggle(200),t.toggleClass("fa-chevron-up fa-chevron-down"),o.toggleClass("fa-chevron-up fa-chevron-down"),i.toggleClass("panel-collapse"),setTimeout(function(){i.resize(),i.find("[id^=map-]").resize()},50)}),e(".panel-close").on("click",function(a){a.preventDefault(),e(a.target).closest("div.panel").remove()})},InitSubNavCollapse:function(){e(".nav-second").on("show.bs.collapse",function(){e(".nav-second.in").collapse("hide")})},InitMemberAutocomplete:function(){var a=e(".search-member");a.length&&a.bootcomplete({url:window.Laravel.appPath+"/search-member/",minLength:3,idField:!0,method:"POST",dataParams:{_token:e("meta[name=csrf-token]").attr("content")}})},InitMobileNav:function(){var a=e(".mobile-nav-toggle"),i=e(".mobile-nav-drawer"),t=e(".mobile-nav-overlay"),o=e(".mobile-nav-close");if(!i.length)return;function r(){i.addClass("active"),t.addClass("active"),e("body").addClass("mobile-nav-open")}function s(){i.removeClass("active"),t.removeClass("active"),e("body").removeClass("mobile-nav-open")}a.on("click",function(n){n.preventDefault(),i.hasClass("active")?s():r()}),o.on("click",function(n){n.preventDefault(),s()}),t.on("click",s),i.find("a").on("click",function(){var n=e(this);n.attr("data-toggle")==="collapse"||n.attr("href")==="#"||s()})},InitMobileSearch:function(){var a=e(".mobile-search-toggle"),i=e(".mobile-search-modal"),t=e("#mobile-member-search"),o=e(".mobile-search-close"),r=e(".mobile-searchclear"),s=e(".mobile-search-results"),n=e(".mobile-search-loader");if(!i.length)return;var d=null,u=500;function f(){i.addClass("active"),e("body").addClass("mobile-search-open"),t.focus()}function v(){i.removeClass("active"),e("body").removeClass("mobile-search-open"),t.val(""),r.removeClass("visible"),s.empty(),n.removeClass("active")}function h(){var g=t.val().trim();if(!g){n.removeClass("active"),s.empty();return}e.ajax({url:window.Laravel.appPath+"/search/members",type:"GET",data:{q:g},success:function(l){n.removeClass("active"),s.html(l)}})}a.on("click",function(g){g.preventDefault(),f()}),o.on("click",v),r.on("click",function(){t.val("").focus(),r.removeClass("visible"),s.empty()}),t.on("input",function(){var g=t.val().trim();if(r.toggleClass("visible",g.length>0),d&&clearTimeout(d),!g){s.empty(),n.removeClass("active");return}n.addClass("active"),d=setTimeout(h,u)}),t.on("keydown",function(g){g.key==="Escape"&&v()})},InitRarityFilter:function(){var a=e(".rarity-filter"),i=e("#division-filter");if(!a.length&&!i.length)return;function t(){var n=e(".rarity-filter.active").map(function(){return e(this).data("rarity")}).get();e(".award-card").each(function(){var d=e(this),u=d.closest('[class*="col-"]'),f=null;["mythic","legendary","epic","rare","common"].forEach(function(g){d.hasClass("award-card-"+g)&&(f=g)});var v=n.length===0||n.indexOf(f)!==-1,h=u.hasClass("filter-hidden");v?(u.removeClass("filter-hidden filter-hiding"),h?(u.addClass("filter-entering"),setTimeout(function(){u.removeClass("filter-entering").addClass("filter-visible")},300)):u.addClass("filter-visible")):!u.hasClass("filter-hidden")&&!u.hasClass("filter-hiding")&&(u.removeClass("filter-visible filter-entering").addClass("filter-hiding"),setTimeout(function(){u.removeClass("filter-hiding").addClass("filter-hidden")},250))})}a.on("click",function(){e(this).toggleClass("active"),t()}),i.on("change",function(){var n=e(this).val(),d=new URL(window.location.href);n?d.searchParams.set("division",n):d.searchParams.delete("division"),window.location.href=d.toString()});var o=e("#rarity-sort"),r=["mythic","legendary","epic","rare","common"];function s(n){e(".award-grid").each(function(){var d=e(this),u=d.children('[class*="col-"]').detach().toArray();n==="default"?u.sort(function(f,v){var h=parseInt(e(f).data("original-order"))||0,g=parseInt(e(v).data("original-order"))||0;return h-g}):u.sort(function(f,v){var h=e(f).find(".award-card"),g=e(v).find(".award-card"),l=4,m=4;return r.forEach(function(b,p){h.hasClass("award-card-"+b)&&(l=p),g.hasClass("award-card-"+b)&&(m=p)}),n==="rarity-desc"?l-m:m-l}),u.forEach(function(f,v){var h=e(f);h.data("original-order")||h.attr("data-original-order",v),h.removeClass("filter-visible filter-entering filter-hiding filter-hidden"),d.append(f)}),setTimeout(function(){d.children('[class*="col-"]').each(function(f){var v=e(this);setTimeout(function(){v.addClass("filter-entering"),setTimeout(function(){v.removeClass("filter-entering").addClass("filter-visible")},300)},f*30)})},10)})}e(".award-grid").each(function(){e(this).children('[class*="col-"]').each(function(n){e(this).attr("data-original-order",n)})}),o.on("change",function(){s(e(this).val()),t()})},InitMemberSearch:function(){var a=e("#member-search");if(!a.length)return;var i=e(".desktop-search-loader"),t=e("#searchclear"),o=null,r=1e3;function s(){i.addClass("active"),o&&clearTimeout(o),o=setTimeout(function(){o=null;var d=a.val().trim();if(!d){i.removeClass("active");return}c.GetSearchResults()},r)}a.on("keydown",s),a.on("paste",function(){setTimeout(s,0)}),a.on("input",function(){var d=a.val().trim();d||(i.removeClass("active"),t.removeClass("visible"))});function n(){e("section.search-results").addClass("closed").removeClass("open"),e("body").removeClass("search-active"),e(".content").css("margin-top",""),a.val(""),t.removeClass("visible")}t.on("click",n),e(".content").on("click",function(){e("body").hasClass("search-active")&&n()})},GetSearchResults:function(){var a=e("#member-search").val();a&&e.ajax({url:window.Laravel.appPath+"/search/members",type:"GET",data:{q:a},success:function(i){window.scrollTo(0,0),e(".desktop-search-loader").removeClass("active"),e("#searchclear").addClass("visible");var t=e("section.search-results");t.html(i).addClass("open").removeClass("closed"),e("body").addClass("search-active"),setTimeout(function(){e(".content").css("margin-top","20px")},50)}})},InitCollectionSearch:function(){var a=e("#search-collection");a.length&&a.on("keyup",function(){var i=e(this).val(),t=new RegExp("^"+i,"i");e(".collection .collection-item").each(function(){e(this).toggle(t.test(e(this).text()))})})},InitRepeater:function(){var a=e(".repeater");a.length&&a.repeater({isFirstItemUndeletable:!0})},InitTabActivate:function(){var a=e(".nav-tabs");a.length&&(a.stickyTabs(),e('a[data-toggle="tab"]').on("shown.bs.tab",function(){e.sparkline_display_visible()}))},InitSettings:function(){var a=e(".settings-toggle, .mobile-settings-toggle"),i=e(".settings-overlay"),t=e(".settings-slideover"),o=e(".settings-close");if(!a.length)return;function r(){i.addClass("active"),t.addClass("active"),a.addClass("active"),e("body").addClass("settings-open")}function s(){i.removeClass("active"),t.removeClass("active"),a.removeClass("active"),e("body").removeClass("settings-open")}a.on("click",function(v){v.preventDefault(),t.hasClass("active")?s():r()}),i.on("click",s),o.on("click",s),e(document).on("keydown",function(v){v.key==="Escape"&&t.hasClass("active")&&s()});var n=null,d=e(".settings-save-status");function u(){n&&clearTimeout(n),d.text("Saving...").removeClass("saved error").addClass("saving");var v={_token:e('input[name="_token"]').val(),disable_animations:e("#setting-disable-animations").is(":checked"),mobile_nav_side:e("#setting-mobile-nav-side").val(),snow:e("#setting-snow").val(),snow_ignore_mouse:e("#setting-snow-ignore-mouse").is(":checked"),theme:e("#setting-theme").val()};e.ajax({url:window.Laravel.appPath+"/settings",type:"POST",data:v,success:function(){d.text("Saved").removeClass("saving error").addClass("saved"),n=setTimeout(function(){d.text("").removeClass("saved")},2e3),c.ApplySettings(v)},error:function(){d.text("Error saving").removeClass("saving saved").addClass("error")}})}e("#setting-disable-animations, #setting-snow-ignore-mouse").on("change",u),e(".settings-btn[data-setting]").on("click",function(){var v=e(this),h=v.data("setting"),g=v.data("value");v.siblings(".settings-btn").removeClass("active"),v.addClass("active"),e("#setting-"+h.split("_").join("-")).val(g),h==="theme"&&f(g),u()});function f(v){var h=v==="shattrath";e('.settings-btn[data-value="motes"]').toggle(h),!h&&e("#setting-snow").val()==="motes"&&(e("#setting-snow").val("no_snow"),e('.settings-btn[data-setting="snow"]').removeClass("active"),e('.settings-btn[data-value="no_snow"]').addClass("active"));var g=document.getElementById("favicon");g&&(g.href=v==="shattrath"?"/images/logo-shattrath.svg":"/images/logo_v2.svg")}f(e("#setting-theme").val())},ApplySettings:function(a){if(a.disable_animations?e("body").addClass("no-animations"):e("body").removeClass("no-animations"),a.mobile_nav_side==="left"?e("body").addClass("mobile-nav-left"):e("body").removeClass("mobile-nav-left"),a.theme&&document.documentElement.setAttribute("data-theme",a.theme),typeof initSnowStorm=="function"){var i=0;a.snow==="some_snow"?i=32:a.snow==="all_the_snow"&&(i=160),initSnowStorm(i,a.snow_ignore_mouse)}if(typeof initMotesOfLight=="function"){var t=0;a.snow==="motes"&&(t=35),initMotesOfLight(t,a.snow_ignore_mouse)}},InitProfileModals:function(){var a=e("#part-time-divisions-modal"),i=e("#ingame-handles-modal"),t=e("#transfer-request-modal");if(!(!a.length&&!i.length&&!t.length)){a.add(i).add(t).on("show.bs.modal",function(){e(".settings-overlay").removeClass("active"),e(".settings-slideover").removeClass("active"),e(".settings-toggle, .mobile-settings-toggle").removeClass("active"),e("body").removeClass("settings-open")}),e("#save-part-time-divisions").on("click",function(){var r=e(this),s=a.find(".modal-save-status"),n=[];a.find('input[name="divisions[]"]:checked').each(function(){n.push(e(this).val())}),r.prop("disabled",!0),s.text("Saving...").removeClass("saved error").addClass("saving"),e.ajax({url:window.Laravel.appPath+"/settings/part-time-divisions",type:"POST",data:{_token:e("meta[name=csrf-token]").attr("content"),divisions:n},success:function(d){s.text("Saved!").removeClass("saving error").addClass("saved"),e('.settings-link-btn[data-target="#part-time-divisions-modal"] .settings-link-count').text(d.count),setTimeout(function(){a.modal("hide"),s.text("").removeClass("saved")},1e3)},error:function(){s.text("Error saving").removeClass("saving saved").addClass("error")},complete:function(){r.prop("disabled",!1)}})});var o=e("#handles-container .handle-row").length;e("#add-handle").on("click",function(){var r=e("#handle-row-template").html(),s=r.replace(/__INDEX__/g,o);e("#handles-container").append(s),o++}),e(document).on("click",".remove-handle",function(){e(this).closest(".handle-row").remove()}),e("#save-ingame-handles").on("click",function(){var r=e(this),s=i.find(".modal-save-status"),n=[];e("#handles-container .handle-row").each(function(d){var u=e(this),f=u.find(".handle-select").val(),v=u.find('input[type="text"]').val();f&&v&&n.push({id:u.data("id")||"",handle_id:f,value:v,primary:u.find(".handle-primary input").is(":checked")?1:0})}),r.prop("disabled",!0),s.text("Saving...").removeClass("saved error").addClass("saving"),e.ajax({url:window.Laravel.appPath+"/settings/ingame-handles",type:"POST",data:{_token:e("meta[name=csrf-token]").attr("content"),handles:n},success:function(d){s.text("Saved!").removeClass("saving error").addClass("saved"),e('.settings-link-btn[data-target="#ingame-handles-modal"] .settings-link-count').text(d.count),setTimeout(function(){i.modal("hide"),s.text("").removeClass("saved")},1e3)},error:function(){s.text("Error saving").removeClass("saving saved").addClass("error")},complete:function(){r.prop("disabled",!1)}})}),e("#save-transfer-request").on("click",function(){var r=e(this),s=t.find(".modal-save-status"),n=e("#transfer-division-select").val();if(!n){s.text("Please select a division").removeClass("saving saved").addClass("error");return}r.prop("disabled",!0),s.text("Submitting...").removeClass("saved error").addClass("saving"),e.ajax({url:window.Laravel.appPath+"/settings/transfer-request",type:"POST",data:{_token:e("meta[name=csrf-token]").attr("content"),division_id:n},success:function(d){s.text(d.message).removeClass("saving error").addClass("saved"),setTimeout(function(){t.modal("hide"),window.location.reload()},1500)},error:function(d){var u=d.responseJSON?.error||"Error submitting request";s.text(u).removeClass("saving saved").addClass("error"),r.prop("disabled",!1)}})}),t.on("hidden.bs.modal",function(){e("#transfer-division-select").val(""),t.find(".modal-save-status").text("").removeClass("saving saved error"),e("#save-transfer-request").prop("disabled",!1)})}},InitNoSquadModal:function(){var a=e("#no-squad-modal");if(a.length){var i=!1;a.on("show.bs.modal",function(){if(!i){var t=a.data("url");e.get(t,function(o){var r=e("#no-squad-list");if(r.empty(),o.members.length===0)r.html('<p class="text-muted">No members found.</p>');else{var s={};o.members.forEach(function(n){s[n.platoon]||(s[n.platoon]={members:[],manage_url:n.manage_url}),s[n.platoon].members.push(n)}),Object.keys(s).sort().forEach(function(n){var d=s[n],u=e('<div class="no-squad-group"></div>');u.append('<div class="no-squad-platoon-header"><span>'+n+'</span><a href="'+d.manage_url+'" class="btn btn-sm btn-accent"><i class="fa fa-arrows-alt"></i> Assign</a></div>');var f=e('<div class="no-squad-members"></div>');d.members.forEach(function(v){f.append('<span class="no-squad-member">'+v.name+"</span>")}),u.append(f),r.append(u)})}e("#no-squad-loading").hide(),r.show(),i=!0})}})}},InitLeaderboardTabs:function(){var a=e(".leaderboard-tab"),i=e(".leaderboard-panel");a.length&&(a.on("click",function(){var t=e(this).data("tab");a.removeClass("active"),i.removeClass("active"),e(this).addClass("active"),e('.leaderboard-panel[data-panel="'+t+'"]').addClass("active")}),e(".leaderboard-card.animate-fade-in-up").on("animationend",function(){e(this).removeClass("animate-fade-in-up").css("opacity","")}))},InitInactiveTabs:function(){var a=e(".inactive-tab"),i=e(".inactive-panel"),t=e("#inactive-search");if(!a.length)return;c.pendingTabRefresh={inactive:!1,flagged:!1},c.inactiveTables={},e(".inactive-table").each(function(){var s=e(this),n=s.closest(".inactive-panel").data("panel")||"default";c.inactiveTables[n]=s.DataTable({paging:!1,info:!1,searching:!0,order:[[2,"asc"]],columnDefs:[{targets:0,orderable:!1,visible:!1},{targets:-1,orderable:!1}],dom:"t"})});function o(s,n){if(!n&&c.pendingTabRefresh[s]){window.location.href=window.location.pathname+"#"+s,window.location.reload();return}a.removeClass("active"),i.removeClass("active"),e('.inactive-tab[data-tab="'+s+'"]').addClass("active"),e('.inactive-panel[data-panel="'+s+'"]').addClass("active"),t.val()&&c.FilterInactiveTable(t.val()),c.inactiveTables[s]&&c.inactiveTables[s].columns.adjust()}a.on("click",function(){var s=e(this).data("tab");o(s),history.replaceState(null,null,"#"+s)});var r=window.location.hash.replace("#","");r&&a.filter('[data-tab="'+r+'"]').length&&o(r,!0),t.length&&t.on("input",function(){c.FilterInactiveTable(e(this).val())})},FilterInactiveTable:function(a){var i=e(".inactive-panel.active").data("panel"),t=c.inactiveTables&&c.inactiveTables[i];t&&t.search(a).draw()},InitParttimerSearch:function(){var a=e("#parttimer-search");a.length&&a.on("input",function(){var i=e(this).val().toLowerCase();e(".inactive-panel.active tbody tr").each(function(){var t=e(this).text().toLowerCase();e(this).toggle(t.indexOf(i)!==-1)})})},InitAddParttimer:function(){var a=e("#add-parttimer-modal");if(a.length){var i=e("#parttimer-member-search"),t=e("#parttimer-member-id"),o=e("#parttimer-selected-member"),r=o.find(".selected-member-name"),s=e("#add-parttimer-submit");i.bootcomplete({url:window.Laravel.appPath+"/search-member/",minLength:3,idField:!0,method:"POST",dataParams:{_token:e("meta[name=csrf-token]").attr("content")}}),i.on("bootcomplete.selected",function(n,d,u){t.val(d),r.text(u),o.show(),i.hide(),s.prop("disabled",!1)}),o.on("click",".clear-selected-member",function(){t.val(""),r.text(""),o.hide(),i.val("").show().focus(),s.prop("disabled",!0)}),a.on("hidden.bs.modal",function(){t.val(""),r.text(""),o.hide(),i.val("").show(),s.prop("disabled",!0),e("#parttimer-handle-value").val("")})}},InitNoteReminderDetection:function(){var a=[/\bpm\s*sent\b/i,/\bdm\s*sent\b/i,/\bmsg\s*sent\b/i,/\bpm'?e?d\b/i,/\bsent\s*(a\s+)?(pm|dm|msg|message|notice|reminder)\b/i,/\binactiv(ity|e)?\s+(notice|reminder|warning|msg|message|pm|dm|check)\b/i,/\bactivity\s+(reminder|notice|pm|dm|msg|message)\b/i,/\b(reminder|notice)\s+sent\b/i,/\b(wellness|welfare)\s+(check|message)\b/i,/\bforum\s+(notice|reminder|pm|dm|inactiv)/i,/\bdiscord\s+(message|dm|pm|notice|reminder)/i,/\bfinal\s+(notice|reminder|warning)\b/i,/\b(1[04]|2[18]|30|35|4[05]|50|60|70|80|85|90)\s*[\-\+]*\s*day/i,/\b[1234]\s*week/i,/\b[123]\s*month/i,/\bmessaged\s+(regarding|about|for|on|via|through|re:?)/i,/\bcontacted\s+(regarding|about|for)/i,/\breached\s+out\s+(about|regarding|for|in|to)/i,/\b(days?|weeks?)\s+(inactive|inactiv|reminder|over|behind)\b/i,/\bno\s+(activity|response|reply)\b/i,/\binactive\s+(for|on|in|warning)\b/i,/\breminder\s+(to|about|for|sent|pm)\b/i,/\bpinged\s+for\s+inactiv/i],i=[/\bremoved\s+(for|due\s+to)\s+inactiv/i,/\bflagged\s+(for|member|notice)\b/i,/\bloa\b/i,/\bleave\s+(of\s+absence|request|expired)\b/i,/\bpromot(ed|ion)\b/i,/\brecruit/i,/\bwelcome\b/i,/\bremoval\b/i,/\bresign/i,/\bviolation\b/i];e(document).on("input",".note-body-input",function(){var t=e(this),o=t.siblings(".reminder-note-suggestion"),r=t.val();if(!o.data("dismissed")){var s=r.length<100&&a.some(function(d){return d.test(r)}),n=i.some(function(d){return d.test(r)});o.toggle(s&&!n)}}),e(document).on("click",".dismiss-suggestion",function(){var t=e(this).closest(".reminder-note-suggestion");t.data("dismissed",!0).hide()}),e("#create-member-note").on("hidden.bs.modal",function(){e(this).find(".reminder-note-suggestion").removeData("dismissed").hide()})},InitActivityReminderToggle:function(){var a=e("meta[name=csrf-token]").attr("content");e(document).on("click",".activity-reminder-toggle",function(i){i.preventDefault();var t=e(this),o=t.data("member-id");t.prop("disabled")||(t.prop("disabled",!0),e.ajax({url:window.Laravel.appPath+"/members/"+o+"/set-activity-reminder",method:"POST",data:{_token:a},success:function(r){t.removeClass("btn-success").addClass("btn-default"),t.html('<i class="fa fa-bell"></i> <span class="reminded-date">'+r.date+"</span>"),t.attr("title",r.title)},error:function(r){var s=r.responseJSON?.message||"Failed to set reminder";toastr.error(s),t.prop("disabled",!1)}}))}),e(document).on("click",".set-activity-reminder-btn",function(i){i.preventDefault();var t=e(this),o=t.data("url");if(!(t.prop("disabled")||t.hasClass("reminder-sent"))){t.prop("disabled",!0);var r=t.html();t.html('<i class="fa fa-spinner fa-spin"></i> Sending...'),e.ajax({url:o,method:"POST",data:{_token:a},success:function(s){t.addClass("reminder-sent"),t.html('<i class="fa fa-check"></i> Reminded '+s.date),toastr.success("Activity reminder marked")},error:function(s){var n=s.responseJSON?.message||"Failed to set reminder";toastr.error(n),t.prop("disabled",!1),t.html(r)}})}}),e(document).on("click",".clear-reminders-btn",function(i){i.preventDefault();var t=e(this),o=t.data("url");t.prop("disabled")||confirm("Clear all activity reminders for this member?")&&(t.prop("disabled",!0),t.html('<i class="fa fa-spinner fa-spin"></i> Clearing...'),e.ajax({url:o,method:"DELETE",data:{_token:a},success:function(r){toastr.success(r.count+" reminder(s) cleared"),e("#member-reminder-history-modal").modal("hide"),e(".stat-reminder-badge").fadeOut()},error:function(r){var s=r.responseJSON?.message||"Failed to clear reminders";toastr.error(s),t.prop("disabled",!1),t.html('<i class="fa fa-trash"></i> Clear Reminders')}}))})},InitTrashedNotes:function(){var a=e(".toggle-trashed-notes");if(a.length){var i=e("meta[name=csrf-token]").attr("content"),t=a.data("count");a.on("click",function(){var o=e(this),r=e(".notes-active-list"),s=e(".notes-trashed-list");s.is(":visible")?(s.hide(),r.show(),o.removeClass("btn-warning").addClass("btn-default"),o.html('<i class="fa fa-trash"></i> Deleted ('+t+")")):(r.hide(),s.show(),o.removeClass("btn-default").addClass("btn-warning"),o.html('<i class="fa fa-sticky-note"></i> Active Notes'))}),e(document).on("click",".restore-note-btn",function(){var o=e(this),r=o.data("url"),s=o.closest(".note-card");o.prop("disabled",!0).html('<i class="fa fa-spinner fa-spin"></i>'),e.ajax({url:r,method:"POST",data:{_token:i},success:function(){s.fadeOut(300,function(){e(this).remove()}),toastr.success("Note restored")},error:function(n){toastr.error(n.responseJSON?.message||"Failed to restore note"),o.prop("disabled",!1).html('<i class="fa fa-undo"></i> Restore')}})}),e(document).on("click",".force-delete-note-btn",function(){var o=e(this),r=o.data("url"),s=o.closest(".note-card");confirm("Permanently delete this note? This cannot be undone.")&&(o.prop("disabled",!0).html('<i class="fa fa-spinner fa-spin"></i>'),e.ajax({url:r,method:"DELETE",data:{_token:i},success:function(){s.fadeOut(300,function(){e(this).remove()}),toastr.success("Note permanently deleted")},error:function(n){toastr.error(n.responseJSON?.message||"Failed to delete note"),o.prop("disabled",!1).html('<i class="fa fa-trash"></i> Delete Forever')}}))})}},InitInactiveBulkMode:function(){var a=e(".inactive-bulk-toggle");if(!a.length)return;var i=e("meta[name=csrf-token]").attr("content"),t=!1,o=!1,r=!0,s=null,n={inactive:{bar:e("#inactive-bulk-bar"),data:e("#inactive-pm-member-data"),checkboxClass:"inactive-member-checkbox",selectAllClass:"inactive-select-all"},flagged:{bar:e("#flagged-bulk-bar"),data:e('<input type="hidden" id="flagged-pm-member-data">'),checkboxClass:"flagged-member-checkbox",selectAllClass:"flagged-select-all"}};n.flagged.bar.append(n.flagged.data);function d(l,m){var b=e('.inactive-tab[data-tab="'+l+'"] .inactive-tab-count'),p=parseInt(b.text())||0;b.text(Math.max(0,p+m))}function u(l){return function(){var m=e("."+l.checkboxClass+":checked").map(function(){return e(this).val()}).get();l.data.val(m.join(",")),m.length>0?(l.bar.find(".status-text").text(m.length+" selected"),l.bar.slideDown(200)):l.bar.slideUp(200);var b=e("."+l.checkboxClass).length,p=m.length;e("."+l.selectAllClass).prop("checked",p>0&&p===b),e("."+l.selectAllClass).prop("indeterminate",p>0&&p<b)}}var f=u(n.inactive),v=u(n.flagged);function h(l,m){e("."+l.checkboxClass+", ."+l.selectAllClass).prop("checked",!1),m()}function g(l){var m=l.data.val();if(!m){toastr.warning("No members selected");return}var b=l.btn;b.prop("disabled",!0).html('<span class="themed-spinner spinner-sm"></span>'),e.ajax({url:l.url,method:"POST",data:{_token:i,member_ids:m.split(",")},success:l.onSuccess,error:function(p){toastr.error(p.responseJSON?.message||l.errorMessage)},complete:function(){b.prop("disabled",!1).html(l.buttonHtml)}})}a.on("click",function(){t=!t;var l=e(this);l.toggleClass("active",t),e(".inactive-table").toggleClass("bulk-mode",t),c.inactiveTables&&Object.values(c.inactiveTables).forEach(function(m){m.column(0).visible(t)}),t?l.html('<i class="fa fa-times"></i> Exit Bulk Mode'):(l.html("Bulk Mode"),h(n.inactive,f),h(n.flagged,v))}),e(document).on("change","."+n.inactive.checkboxClass,f),e(document).on("change","."+n.flagged.checkboxClass,v),e(document).on("mousedown",".inactive-table tbody tr",function(l){if(t&&!e(l.target).is("a, button, input, .fa")&&l.which===1){l.preventDefault(),o=!0,s=this;var m=e(this).closest(".flagged-table").length>0,b=m?n.flagged.checkboxClass:n.inactive.checkboxClass,p=e(this).find("."+b);p.length&&(r=!p.prop("checked"),p.prop("checked",r),e(this).toggleClass("drag-selected",r))}}),e(document).on("mouseenter",".inactive-table tbody tr",function(){if(!(!o||!t)){var l=e(this).closest(".flagged-table").length>0,m=l?n.flagged.checkboxClass:n.inactive.checkboxClass,b=e(this).find("."+m);b.length&&(b.prop("checked",r),e(this).toggleClass("drag-selected",r))}}),e(document).on("mouseup",function(){if(o){var l=s&&e(s).closest(".flagged-table").length>0;o=!1,s=null,e(".inactive-table tbody tr").removeClass("drag-selected"),(l?v:f)()}}),e(document).on("change",".inactive-select-all, .flagged-select-all",function(){var l=e(this).hasClass("flagged-select-all"),m=l?n.flagged:n.inactive,b=l?v:f;e(this).closest(".inactive-panel").find("."+m.checkboxClass).prop("checked",e(this).prop("checked")),b()}),e(document).on("click",".inactive-bulk-close",function(){var l=e(this).closest(".bulk-action-bar").attr("id")==="flagged-bulk-bar";h(l?n.flagged:n.inactive,l?v:f)}),e("#inactive-bulk-reminder-btn").on("click",function(){g({btn:e(this),data:n.inactive.data,url:e(this).data("url"),errorMessage:"Failed to set reminders",buttonHtml:'<i class="fa fa-bell text-accent"></i> <span class="hidden-xs hidden-sm">Reminder</span>',onSuccess:function(l){var m=l.count+" member"+(l.count!==1?"s":"")+" marked as reminded";l.skipped>0&&(m+=" ("+l.skipped+" skipped - already reminded today)"),toastr.success(m),l.updatedIds.forEach(function(b){var p=e('.activity-reminder-toggle[data-member-id="'+b+'"]');p.length&&p.removeClass("btn-success").addClass("btn-default").html('<i class="fa fa-bell"></i> <span class="reminded-date">'+l.date+"</span>").attr("title","Reminded just now").prop("disabled",!0)}),h(n.inactive,f)}})}),e("#inactive-bulk-flag-btn").on("click",function(){g({btn:e(this),data:n.inactive.data,url:e(this).data("url"),errorMessage:"Failed to flag members",buttonHtml:'<i class="fa fa-flag"></i> <span class="hidden-xs hidden-sm">Flag</span>',onSuccess:function(l){toastr.success(l.message),l.flaggedIds.forEach(function(m){e('.inactive-member-checkbox[value="'+m+'"]').closest("tr").fadeOut(300,function(){e(this).remove()})}),h(n.inactive,f),d("inactive",-l.count),d("flagged",l.count),c.pendingTabRefresh&&(c.pendingTabRefresh.flagged=!0)}})}),e("#flagged-bulk-unflag-btn").on("click",function(){g({btn:e(this),data:n.flagged.data,url:e(this).data("url"),errorMessage:"Failed to unflag members",buttonHtml:'<i class="fa fa-flag"></i> <span class="hidden-xs hidden-sm">Unflag</span>',onSuccess:function(l){toastr.success(l.message),l.unflaggedIds.forEach(function(m){e('.flagged-member-checkbox[value="'+m+'"]').closest("tr").fadeOut(300,function(){e(this).remove(),e(".flagged-member-checkbox").length===0&&e(".flagged-table").closest(".table-responsive").replaceWith('<div class="inactive-empty"><i class="fa fa-flag-o"></i><h4>No Flagged Members</h4><p>There are currently no members flagged for removal.</p></div>')})}),h(n.flagged,v),d("flagged",-l.count),d("inactive",l.count),c.pendingTabRefresh&&(c.pendingTabRefresh.inactive=!0)}})})},InitActivityFeedToggle:function(){e(document).on("show.bs.collapse",".activity-group-members",function(){e(".activity-group-members.in").not(this).collapse("hide")}),e(document).on("click",".activity-feed-item",function(a){if(!e(a.target).closest("a").length){var i=e(this).find(".activity-group-toggle");if(i.length){var t=e(i.data("target"));t.collapse("toggle")}}})}}})(window.jQuery);function C(){var e=window.jQuery;if(!e||typeof e.fn.DataTable!="function"||typeof e.fn.bootcomplete!="function"){setTimeout(C,50);return}c.Setup()}C();
