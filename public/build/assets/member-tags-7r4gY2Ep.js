var o=o||{};(function(t){o={setup:function(){var a=t("#member-tags-display");!a.length||!a.data("tags-url")||(this.tagsUrl=a.data("tags-url"),this.addUrl=a.data("add-url"),this.removeUrl=a.data("remove-url"),this.createUrl=a.data("create-url"),this.csrfToken=t("meta[name=csrf-token]").attr("content"),this.bindEvents())},bindEvents:function(){var a=this;t(document).on("click",".remove-tag",function(e){e.preventDefault(),e.stopPropagation(),a.removeTag(t(this).closest(".member-tag"))}),t("#available-tags-dropdown").parent().on("show.bs.dropdown",function(){a.loadAvailableTags()}),t(document).on("click",".tag-option",function(e){e.preventDefault(),a.addTag(t(this))}),t("#create-tag-modal").on("shown.bs.modal",function(){t("#new-tag-name").focus()}),t("#create-tag-form").on("submit",function(e){e.preventDefault(),a.createTag()})},removeTag:function(a){var e=this,s=a.data("tag-id");a.css("opacity","0.5"),t.ajax({url:e.removeUrl,method:"POST",data:{tag_id:s,_token:e.csrfToken},success:function(){a.fadeOut(200,function(){t(this).remove()})},error:function(){a.css("opacity","1"),toastr.error("Failed to remove tag")}})},loadAvailableTags:function(){var a=this,e=t("#available-tags-dropdown");e.html('<li class="dropdown-header">Loading...</li>'),t.ajax({url:a.tagsUrl,method:"GET",success:function(s){var n=s.available.filter(function(r){return s.assigned.indexOf(r.id)===-1}),i="";n.length===0?i+='<li><a href="#" class="text-muted" style="pointer-events: none;">No tags available</a></li>':n.forEach(function(r){i+='<li class="tag-option" data-tag-id="'+r.id+'" data-tag-name="'+r.name+'" data-tag-visibility="'+r.visibility+'">',i+='<a href="#"><span class="badge tag-visibility-'+r.visibility+'">'+r.name+"</span></a>",i+="</li>"}),t("#create-tag-modal").length&&(i+='<li role="separator" class="divider"></li>',i+='<li><a href="#" data-toggle="modal" data-target="#create-tag-modal"><i class="fa fa-plus"></i> Create new tag</a></li>'),e.html(i)},error:function(){e.html('<li><a href="#" class="text-danger" style="pointer-events: none;">Failed to load</a></li>')}})},addTag:function(a){var e=this,s=a.data("tag-id"),n=a.data("tag-name"),i=a.data("tag-visibility");a.css("opacity","0.5"),t.ajax({url:e.addUrl,method:"POST",data:{tag_id:s,_token:e.csrfToken},success:function(){var r=t('<span class="badge member-tag tag-visibility-'+i+'" data-tag-id="'+s+'" data-visibility="'+i+'">'+n+' <span class="remove-tag" style="margin-left: 4px; cursor: pointer; opacity: 0;">&times;</span></span> ');t("#available-tags-dropdown").parent().before(r),a.remove()},error:function(){a.css("opacity","1"),toastr.error("Failed to add tag")}})},createTag:function(){var a=this,e=t("#create-tag-form"),s=t("#new-tag-name").val().trim(),n=t("#new-tag-visibility").val();if(!s){toastr.warning("Please enter a tag name");return}e.find('button[type="submit"]').prop("disabled",!0),t.ajax({url:a.createUrl,method:"POST",data:{name:s,visibility:n,_token:a.csrfToken},success:function(i){var r=t('<span class="badge member-tag tag-visibility-'+i.tag.visibility+'" data-tag-id="'+i.tag.id+'" data-visibility="'+i.tag.visibility+'">'+i.tag.name+' <span class="remove-tag" style="margin-left: 4px; cursor: pointer; opacity: 0;">&times;</span></span> ');t("#available-tags-dropdown").parent().before(r),t("#create-tag-modal").modal("hide"),e[0].reset(),toastr.success("Tag created and assigned")},error:function(i){var r=i.responseJSON&&i.responseJSON.error?i.responseJSON.error:"Failed to create tag";toastr.error(r)},complete:function(){e.find('button[type="submit"]').prop("disabled",!1)}})}}})(window.jQuery);o.setup();
