var c=c||{};(function(e){c={Setup:function(){c.InitNavToggle(),c.InitBackToTop(),c.InitClipboard(),c.InitDataTables(),c.InitSparklines(),c.InitPanels(),c.InitSubNavCollapse(),c.InitMemberAutocomplete(),c.InitMobileNav(),c.InitMobileSearch(),c.InitRarityFilter(),c.InitRepeater(),c.InitTabActivate(),c.InitMemberSearch(),c.InitCollectionSearch(),c.InitSmoothScroll(),c.InitSettings(),c.InitProfileModals(),c.InitNoSquadModal(),c.InitLeaderboardTabs(),c.InitInactiveTabs(),c.InitParttimerSearch(),c.InitAddParttimer()},InitNavToggle:function(){var a=e(".left-nav-toggle a");a.length&&a.on("click",function(t){t.preventDefault(),e("body").toggleClass("nav-toggle"),e("body").hasClass("nav-toggle")?e.get(window.Laravel.appPath+"/primary-nav/collapse"):e.get(window.Laravel.appPath+"/primary-nav/decollapse"),c.RefreshSparklines()})},InitBackToTop:function(){e(window).height()+100>=e(document).height()||e("#top-link-block").removeClass("hidden").affix({offset:{top:100}})},InitSmoothScroll:function(){e(".smooth-scroll").on("click",function(a){a.preventDefault();var t=e(this).attr("href"),i=e(t);if(i.length){var s=i.offset().top-90;e("html, body").stop().animate({scrollTop:s},750),window.location.hash=t.substr(1)}})},InitClipboard:function(){if(!(typeof Clipboard>"u")&&e(".copy-to-clipboard").length){var a=new Clipboard(".copy-to-clipboard");a.on("success",function(t){toastr.success("Copied!"),t.clearSelection()})}},InitDataTables:function(){var a=e("table.basic-datatable"),t=e("table.adv-datatable");if(a.length){var i=a.DataTable({paging:!1,bFilter:!1,stateSave:!0,bInfo:!1,order:[],columnDefs:[{targets:"no-sort",orderable:!1}],select:{style:"os",selector:"td:first-child"}});e(".for-pm-selection").length&&i.on("select",function(){var s=i.rows(e(".selected")).data().toArray().map(function(o){return o[4]});s.length>=2&&(e("#selected-data").show(),e("#selected-data .status-text").text("With selected ("+s.length+")"),e("#pm-member-data").val(s))})}t.length&&t.DataTable({order:[],columnDefs:[{targets:"no-sort",orderable:!1}]})},InitSparklines:function(){c.RefreshSparklines();var a;e(window).on("resize",function(){clearTimeout(a),a=setTimeout(c.RefreshSparklines,100)})},RefreshSparklines:function(){e("[census-data]").each(function(){var a=e(this),t=a.closest(".census-sparkline-container").length>0,i=t?80:50;a.sparkline(a.data("counts"),{type:"line",lineColor:"#fff",lineWidth:2,fillColor:"#404652",height:i,width:"100%"}),a.data("weekly-voice")&&a.sparkline(a.data("weekly-voice"),{type:"line",lineColor:"#1bbf89",lineWidth:2,fillColor:"rgba(27, 191, 137, 0.2)",height:i,composite:!0})}),e(".census-pie").each(function(){var a=e(this);a.sparkline(a.data("counts"),{type:"pie",sliceColors:a.data("colors")})})},InitPanels:function(){e(".panel-toggle").on("click",function(a){a.preventDefault();var t=e(a.target).closest("div.panel"),i=e(a.target).closest("i.toggle-icon"),s=e(a.target).find("i.toggle-icon");t.find("div.panel-body").slideToggle(300),t.find("div.panel-footer").slideToggle(200),i.toggleClass("fa-chevron-up fa-chevron-down"),s.toggleClass("fa-chevron-up fa-chevron-down"),t.toggleClass("panel-collapse"),setTimeout(function(){t.resize(),t.find("[id^=map-]").resize()},50)}),e(".panel-close").on("click",function(a){a.preventDefault(),e(a.target).closest("div.panel").remove()})},InitSubNavCollapse:function(){e(".nav-second").on("show.bs.collapse",function(){e(".nav-second.in").collapse("hide")})},InitMemberAutocomplete:function(){var a=e(".search-member");a.length&&a.bootcomplete({url:window.Laravel.appPath+"/search-member/",minLength:3,idField:!0,method:"POST",dataParams:{_token:e("meta[name=csrf-token]").attr("content")}})},InitMobileNav:function(){var a=e(".mobile-nav-toggle"),t=e(".mobile-nav-drawer"),i=e(".mobile-nav-overlay"),s=e(".mobile-nav-close");if(!t.length)return;function o(){t.addClass("active"),i.addClass("active"),e("body").addClass("mobile-nav-open")}function r(){t.removeClass("active"),i.removeClass("active"),e("body").removeClass("mobile-nav-open")}a.on("click",function(n){n.preventDefault(),t.hasClass("active")?r():o()}),s.on("click",function(n){n.preventDefault(),r()}),i.on("click",r),t.find("a").on("click",function(){var n=e(this);n.attr("data-toggle")==="collapse"||n.attr("href")==="#"||r()})},InitMobileSearch:function(){var a=e(".mobile-search-toggle"),t=e(".mobile-search-modal"),i=e("#mobile-member-search"),s=e(".mobile-search-close"),o=e(".mobile-searchclear"),r=e(".mobile-search-results"),n=e(".mobile-search-loader");if(!t.length)return;var l=null,v=500;function d(){t.addClass("active"),e("body").addClass("mobile-search-open"),i.focus()}function f(){t.removeClass("active"),e("body").removeClass("mobile-search-open"),i.val(""),o.removeClass("visible"),r.empty(),n.removeClass("active")}function m(){var u=i.val().trim();if(!u){n.removeClass("active"),r.empty();return}e.ajax({url:window.Laravel.appPath+"/search/members/"+u,type:"GET",success:function(h){n.removeClass("active"),r.html(h)}})}a.on("click",function(u){u.preventDefault(),d()}),s.on("click",f),o.on("click",function(){i.val("").focus(),o.removeClass("visible"),r.empty()}),i.on("input",function(){var u=i.val().trim();if(o.toggleClass("visible",u.length>0),l&&clearTimeout(l),!u){r.empty(),n.removeClass("active");return}n.addClass("active"),l=setTimeout(m,v)}),i.on("keydown",function(u){u.key==="Escape"&&f()})},InitRarityFilter:function(){var a=e(".rarity-filter"),t=e("#division-filter");if(!a.length&&!t.length)return;function i(){var n=e(".rarity-filter.active").map(function(){return e(this).data("rarity")}).get();e(".award-card").each(function(){var l=e(this),v=l.closest('[class*="col-"]'),d=null;["mythic","legendary","epic","rare","common"].forEach(function(u){l.hasClass("award-card-"+u)&&(d=u)});var f=n.length===0||n.indexOf(d)!==-1,m=v.hasClass("filter-hidden");f?(v.removeClass("filter-hidden filter-hiding"),m?(v.addClass("filter-entering"),setTimeout(function(){v.removeClass("filter-entering").addClass("filter-visible")},300)):v.addClass("filter-visible")):!v.hasClass("filter-hidden")&&!v.hasClass("filter-hiding")&&(v.removeClass("filter-visible filter-entering").addClass("filter-hiding"),setTimeout(function(){v.removeClass("filter-hiding").addClass("filter-hidden")},250))})}a.on("click",function(){e(this).toggleClass("active"),i()}),t.on("change",function(){var n=e(this).val(),l=new URL(window.location.href);n?l.searchParams.set("division",n):l.searchParams.delete("division"),window.location.href=l.toString()});var s=e("#rarity-sort"),o=["mythic","legendary","epic","rare","common"];function r(n){e(".award-grid").each(function(){var l=e(this),v=l.children('[class*="col-"]').detach().toArray();n==="default"?v.sort(function(d,f){var m=parseInt(e(d).data("original-order"))||0,u=parseInt(e(f).data("original-order"))||0;return m-u}):v.sort(function(d,f){var m=e(d).find(".award-card"),u=e(f).find(".award-card"),h=4,p=4;return o.forEach(function(g,b){m.hasClass("award-card-"+g)&&(h=b),u.hasClass("award-card-"+g)&&(p=b)}),n==="rarity-desc"?h-p:p-h}),v.forEach(function(d,f){var m=e(d);m.data("original-order")||m.attr("data-original-order",f),m.removeClass("filter-visible filter-entering filter-hiding filter-hidden"),l.append(d)}),setTimeout(function(){l.children('[class*="col-"]').each(function(d){var f=e(this);setTimeout(function(){f.addClass("filter-entering"),setTimeout(function(){f.removeClass("filter-entering").addClass("filter-visible")},300)},d*30)})},10)})}e(".award-grid").each(function(){e(this).children('[class*="col-"]').each(function(n){e(this).attr("data-original-order",n)})}),s.on("change",function(){r(e(this).val()),i()})},InitMemberSearch:function(){var a=e("#member-search");if(!a.length)return;var t=e(".desktop-search-loader"),i=e("#searchclear"),s=null,o=1e3;function r(){t.addClass("active"),s&&clearTimeout(s),s=setTimeout(function(){s=null;var l=a.val().trim();if(!l){t.removeClass("active");return}c.GetSearchResults()},o)}a.on("keydown",r),a.on("paste",function(){setTimeout(r,0)}),a.on("input",function(){var l=a.val().trim();l||(t.removeClass("active"),i.removeClass("visible"))});function n(){e("section.search-results").addClass("closed").removeClass("open"),e("body").removeClass("search-active"),e(".content").css("margin-top",""),a.val(""),i.removeClass("visible")}i.on("click",n),e(".content").on("click",function(){e("body").hasClass("search-active")&&n()})},GetSearchResults:function(){var a=e("#member-search").val();a&&e.ajax({url:window.Laravel.appPath+"/search/members/"+a,type:"GET",success:function(t){window.scrollTo(0,0),e(".desktop-search-loader").removeClass("active"),e("#searchclear").addClass("visible");var i=e("section.search-results");i.html(t).addClass("open").removeClass("closed"),e("body").addClass("search-active"),setTimeout(function(){e(".content").css("margin-top","20px")},50)}})},InitCollectionSearch:function(){var a=e("#search-collection");a.length&&a.on("keyup",function(){var t=e(this).val(),i=new RegExp("^"+t,"i");e(".collection .collection-item").each(function(){e(this).toggle(i.test(e(this).text()))})})},InitRepeater:function(){var a=e(".repeater");a.length&&a.repeater({isFirstItemUndeletable:!0})},InitTabActivate:function(){var a=e(".nav-tabs");a.length&&(a.stickyTabs(),e('a[data-toggle="tab"]').on("shown.bs.tab",function(){e.sparkline_display_visible()}))},InitSettings:function(){var a=e(".settings-toggle, .mobile-settings-toggle"),t=e(".settings-overlay"),i=e(".settings-slideover"),s=e(".settings-close");if(!a.length)return;function o(){t.addClass("active"),i.addClass("active"),a.addClass("active"),e("body").addClass("settings-open")}function r(){t.removeClass("active"),i.removeClass("active"),a.removeClass("active"),e("body").removeClass("settings-open")}a.on("click",function(d){d.preventDefault(),i.hasClass("active")?r():o()}),t.on("click",r),s.on("click",r),e(document).on("keydown",function(d){d.key==="Escape"&&i.hasClass("active")&&r()});var n=null,l=e(".settings-save-status");function v(){n&&clearTimeout(n),l.text("Saving...").removeClass("saved error").addClass("saving");var d={_token:e('input[name="_token"]').val(),disable_animations:e("#setting-disable-animations").is(":checked"),mobile_nav_side:e("#setting-mobile-nav-side").val(),snow:e("#setting-snow").val(),ticket_notifications:e("#setting-ticket-notifications").is(":checked")};e.ajax({url:window.Laravel.appPath+"/settings",type:"POST",data:d,success:function(){l.text("Saved").removeClass("saving error").addClass("saved"),n=setTimeout(function(){l.text("").removeClass("saved")},2e3),c.ApplySettings(d)},error:function(){l.text("Error saving").removeClass("saving saved").addClass("error")}})}e("#setting-disable-animations, #setting-ticket-notifications").on("change",v),e(".settings-btn[data-setting]").on("click",function(){var d=e(this),f=d.data("setting"),m=d.data("value");d.siblings(".settings-btn").removeClass("active"),d.addClass("active"),e("#setting-"+f.split("_").join("-")).val(m),v()})},ApplySettings:function(a){if(a.disable_animations?e("body").addClass("no-animations"):e("body").removeClass("no-animations"),a.mobile_nav_side==="left"?e("body").addClass("mobile-nav-left"):e("body").removeClass("mobile-nav-left"),typeof initSnowStorm=="function"){var t=0;a.snow==="some_snow"?t=32:a.snow==="all_the_snow"&&(t=160),initSnowStorm(t)}},InitProfileModals:function(){var a=e("#part-time-divisions-modal"),t=e("#ingame-handles-modal");if(!(!a.length&&!t.length)){a.add(t).on("show.bs.modal",function(){e(".settings-overlay").removeClass("active"),e(".settings-slideover").removeClass("active"),e(".settings-toggle, .mobile-settings-toggle").removeClass("active"),e("body").removeClass("settings-open")}),e("#save-part-time-divisions").on("click",function(){var s=e(this),o=a.find(".modal-save-status"),r=[];a.find('input[name="divisions[]"]:checked').each(function(){r.push(e(this).val())}),s.prop("disabled",!0),o.text("Saving...").removeClass("saved error").addClass("saving"),e.ajax({url:window.Laravel.appPath+"/settings/part-time-divisions",type:"POST",data:{_token:e("meta[name=csrf-token]").attr("content"),divisions:r},success:function(n){o.text("Saved!").removeClass("saving error").addClass("saved"),e('.settings-link-btn[data-target="#part-time-divisions-modal"] .settings-link-count').text(n.count),setTimeout(function(){a.modal("hide"),o.text("").removeClass("saved")},1e3)},error:function(){o.text("Error saving").removeClass("saving saved").addClass("error")},complete:function(){s.prop("disabled",!1)}})});var i=e("#handles-container .handle-row").length;e("#add-handle").on("click",function(){var s=e("#handle-row-template").html(),o=s.replace(/__INDEX__/g,i);e("#handles-container").append(o),i++}),e(document).on("click",".remove-handle",function(){e(this).closest(".handle-row").remove()}),e("#save-ingame-handles").on("click",function(){var s=e(this),o=t.find(".modal-save-status"),r=[];e("#handles-container .handle-row").each(function(n){var l=e(this),v=l.find(".handle-select").val(),d=l.find('input[type="text"]').val();v&&d&&r.push({id:l.data("id")||"",handle_id:v,value:d,primary:l.find(".handle-primary input").is(":checked")?1:0})}),s.prop("disabled",!0),o.text("Saving...").removeClass("saved error").addClass("saving"),e.ajax({url:window.Laravel.appPath+"/settings/ingame-handles",type:"POST",data:{_token:e("meta[name=csrf-token]").attr("content"),handles:r},success:function(n){o.text("Saved!").removeClass("saving error").addClass("saved"),e('.settings-link-btn[data-target="#ingame-handles-modal"] .settings-link-count').text(n.count),setTimeout(function(){t.modal("hide"),o.text("").removeClass("saved")},1e3)},error:function(){o.text("Error saving").removeClass("saving saved").addClass("error")},complete:function(){s.prop("disabled",!1)}})})}},InitNoSquadModal:function(){var a=e("#no-squad-modal");if(a.length){var t=!1;a.on("show.bs.modal",function(){if(!t){var i=a.data("url");e.get(i,function(s){var o=e("#no-squad-list");if(o.empty(),s.members.length===0)o.html('<p class="text-muted">No members found.</p>');else{var r={};s.members.forEach(function(n){r[n.platoon]||(r[n.platoon]={members:[],manage_url:n.manage_url}),r[n.platoon].members.push(n)}),Object.keys(r).sort().forEach(function(n){var l=r[n],v=e('<div class="no-squad-group"></div>');v.append('<div class="no-squad-platoon-header"><span>'+n+'</span><a href="'+l.manage_url+'" class="btn btn-sm btn-accent"><i class="fa fa-arrows-alt"></i> Assign</a></div>');var d=e('<div class="no-squad-members"></div>');l.members.forEach(function(f){d.append('<span class="no-squad-member">'+f.name+"</span>")}),v.append(d),o.append(v)})}e("#no-squad-loading").hide(),o.show(),t=!0})}})}},InitLeaderboardTabs:function(){var a=e(".leaderboard-tab"),t=e(".leaderboard-panel");a.length&&a.on("click",function(){var i=e(this).data("tab");a.removeClass("active"),t.removeClass("active"),e(this).addClass("active"),e('.leaderboard-panel[data-panel="'+i+'"]').addClass("active")})},InitInactiveTabs:function(){var a=e(".inactive-tab"),t=e(".inactive-panel"),i=e("#inactive-search");a.length&&(a.on("click",function(){var s=e(this).data("tab");a.removeClass("active"),t.removeClass("active"),e(this).addClass("active"),e('.inactive-panel[data-panel="'+s+'"]').addClass("active"),i.val()&&c.FilterInactiveTable(i.val())}),i.length&&i.on("input",function(){c.FilterInactiveTable(e(this).val())}))},FilterInactiveTable:function(a){a=a.toLowerCase(),e(".inactive-panel.active tbody tr").each(function(){var t=e(this).text().toLowerCase();e(this).toggle(t.indexOf(a)!==-1)})},InitParttimerSearch:function(){var a=e("#parttimer-search");a.length&&a.on("input",function(){var t=e(this).val().toLowerCase();e(".inactive-panel.active tbody tr").each(function(){var i=e(this).text().toLowerCase();e(this).toggle(i.indexOf(t)!==-1)})})},InitAddParttimer:function(){var a=e("#add-parttimer-modal");if(a.length){var t=e("#parttimer-member-search"),i=e("#parttimer-member-id"),s=e("#parttimer-selected-member"),o=s.find(".selected-member-name"),r=e("#add-parttimer-submit");t.bootcomplete({url:window.Laravel.appPath+"/search-member/",minLength:3,idField:!0,method:"POST",dataParams:{_token:e("meta[name=csrf-token]").attr("content")}}),t.on("bootcomplete.selected",function(n,l,v){i.val(l),o.text(v),s.show(),t.hide(),r.prop("disabled",!1)}),s.on("click",".clear-selected-member",function(){i.val(""),o.text(""),s.hide(),t.val("").show().focus(),r.prop("disabled",!0)}),a.on("hidden.bs.modal",function(){i.val(""),o.text(""),s.hide(),t.val("").show(),r.prop("disabled",!0),e("#parttimer-handle-value").val("")})}}}})(window.jQuery);c.Setup();
