var c=c||{};(function(e){c={initUnassigned:function(){var o=this;e(".organize-platoons-btn").on("click",function(){var a=e(this),t=e(".platoon-assignments-section").hasClass("organize-mode");t?(a.html('<i class="fa fa-arrows-alt"></i> Organize'),a.removeClass("btn-success").addClass("btn-accent"),e(".unassigned-organizer-members").slideUp(200),e(".platoon-assignments-section").removeClass("organize-mode")):(a.html('<i class="fa fa-check"></i> Done'),a.removeClass("btn-accent").addClass("btn-success"),e(".unassigned-organizer-members").slideDown(200),e(".platoon-assignments-section").addClass("organize-mode"),o.enablePlatoonDragDrop())}),e(".platoon").on("click",function(a){e(".platoon-assignments-section").hasClass("organize-mode")&&a.preventDefault()})},initScrollToOrganize:function(){e(document).on("click",".scroll-to-organize",function(o){var a=e("#platoons");a.length&&(o.preventDefault(),e("html, body").animate({scrollTop:a.offset().top-20},400,function(){var t=e(".organize-platoons-btn"),n=e(".platoon-assignments-section").hasClass("organize-mode");!n&&t.length&&t.trigger("click"),a.addClass("highlight-section"),setTimeout(function(){a.removeClass("highlight-section")},1500)}))})},enablePlatoonDragDrop:function(){e(".unassigned-platoon-member").data("ui-draggable")||(e(".unassigned-platoon-member").draggable({revert:!0,revertDuration:200,zIndex:1e3,cursor:"grabbing",helper:"clone",appendTo:"body"}),e(".platoon").droppable({hoverClass:"panel-c-success",drop:function(o,a){var t=e(this),n=window.Laravel.appPath,r=a.draggable.attr("data-member-id"),i=t.attr("data-platoon-id");e.ajax({type:"POST",url:n+"/members/"+r+"/assign-platoon",data:{platoon_id:i,_token:e("meta[name=csrf-token]").attr("content")},success:function(d){toastr.success("Member assigned to platoon!"),e(a.draggable).fadeOut(200,function(){e(this).remove(),e(".unassigned-platoon-member").length<1&&(e(".unassigned-organizer").slideUp(),e(".platoon-assignments-section").removeClass("organize-mode"))});var s=t.find(".platoon-stat-badge .fa-users").parent(),l=parseInt(s.text().trim())||0;s.html('<i class="fa fa-users"></i> '+(l+1))},error:function(){toastr.error("Failed to assign member to platoon")}})}}))},setup:function(){this.initAutocomplete(),this.initSetup(),this.initUnassigned(),this.initScrollToOrganize(),this.initPopulationChart()},initPopulationChart:function(){var o=document.getElementById("population-chart");if(o){var a=o.getContext("2d"),t=JSON.parse(o.dataset.labels||"[]"),n=JSON.parse(o.dataset.population||"[]"),r=JSON.parse(o.dataset.voice||"[]");if(t.length!==0){Math.max(...n);var i=Math.min(...n),d=getComputedStyle(document.documentElement),s=d.getPropertyValue("--color-info").trim()||"#5bc0de",l=d.getPropertyValue("--color-success").trim()||"#1bbf89";new Chart(a,{type:"line",data:{labels:t,datasets:[{label:"Members",data:n,borderColor:s,backgroundColor:s+"1a",borderWidth:2,fill:!0,tension:.3,pointRadius:3,pointHoverRadius:6,pointBackgroundColor:s,pointBorderColor:"#fff",pointBorderWidth:2},{label:"Voice Active",data:r,borderColor:l,backgroundColor:l+"1a",borderWidth:2,fill:!0,tension:.3,pointRadius:2,pointHoverRadius:5,pointBackgroundColor:l,pointBorderColor:"#fff",pointBorderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"index"},plugins:{legend:{display:!0,position:"top",align:"end",labels:{boxWidth:12,padding:15,color:"rgba(255, 255, 255, 0.7)",font:{size:11}}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"#fff",bodyColor:"#fff",padding:12,displayColors:!0,callbacks:{label:function(p){return p.dataset.label+": "+p.parsed.y}}}},scales:{x:{grid:{color:"rgba(255, 255, 255, 0.05)"},ticks:{color:"rgba(255, 255, 255, 0.5)",font:{size:10},maxRotation:45,minRotation:0}},y:{beginAtZero:!1,suggestedMin:i-Math.round(i*.1),grid:{color:"rgba(255, 255, 255, 0.05)"},ticks:{color:"rgba(255, 255, 255, 0.5)",font:{size:10}}}}}})}}},initSetup:function(){var o=e(".promotions-chart");if(o.length){var a=["#949ba2","#0f83c9","#1bbf89","#f7af3e","#56c0e0","#db524b"],t=o.data("values"),n=o.data("labels");new Chart(o,{type:"bar",data:{labels:n,datasets:[{label:"Promotions",data:t,backgroundColor:n.map(function(r,i){return a[i%a.length]}),borderWidth:0,borderRadius:4,barThickness:24}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"#fff",bodyColor:"#fff",padding:10,callbacks:{label:function(r){return r.parsed.x+" promotions"}}}},scales:{x:{beginAtZero:!0,grid:{color:"rgba(255, 255, 255, 0.05)"},ticks:{color:"rgba(255, 255, 255, 0.5)",font:{size:11},stepSize:1}},y:{grid:{display:!1},ticks:{color:"rgba(255, 255, 255, 0.7)",font:{size:12}}}}}})}},initAutocomplete:function(){e("#leader").bootcomplete({url:window.Laravel.appPath+"/search-member/",minLength:3,idField:!0,method:"POST",dataParams:{_token:e("meta[name=csrf-token]").attr("content")}})}}})(window.jQuery);c.setup();
