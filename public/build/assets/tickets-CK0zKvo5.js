import{r as A,_ as g,c as a,o as l,b as s,a as m,d,t as c,F as y,g as C,f as h,n as k,w as p,v as w,h as I,j as T,p as M,e as R,q as S,l as b,T as L,m as F}from"./_plugin-vue_export-helper-BRgP652U.js";import"./_commonjsHelpers-Cpj98o6Y.js";const t=A({base_url:window.Laravel.appPath,currentView:"list",selectedTicketId:null,pollInterval:null,soundEnabled:!0,isAdmin:window.Laravel?.isAdmin||!1,canWorkTickets:window.Laravel?.canWorkTickets||!1,viewMode:"user",adminTickets:[],adminFilters:{state:null,search:""},loading:{tickets:!1,ticketTypes:!1,ticket:!1,submitting:!1,commenting:!1,adminTickets:!1,action:!1},errors:{tickets:null,ticketTypes:null,ticket:null,submission:null,comment:null,adminTickets:null,action:null},tickets:[],ticketTypes:[],selectedType:null,currentTicket:null,newTicket:{ticket_type_id:null,description:""},newComment:""});t.loadTickets=()=>(t.loading.tickets=!0,t.errors.tickets=null,axios.get(`${t.base_url}/api/tickets`).then(i=>{t.tickets=i.data.tickets||[],t.loading.tickets=!1}).catch(i=>{t.loading.tickets=!1,t.errors.tickets="Failed to load tickets. Please try again.",console.error("Tickets load error:",i)}));t.loadTicketTypes=()=>(t.loading.ticketTypes=!0,t.errors.ticketTypes=null,axios.get(`${t.base_url}/api/tickets/types`).then(i=>{t.ticketTypes=i.data.types||[],t.loading.ticketTypes=!1}).catch(i=>{t.loading.ticketTypes=!1,t.errors.ticketTypes="Failed to load ticket types. Please try again.",console.error("Ticket types load error:",i)}));t.loadTicket=i=>(t.loading.ticket=!0,t.errors.ticket=null,axios.get(`${t.base_url}/api/tickets/${i}`).then(e=>{t.currentTicket=e.data.ticket,t.loading.ticket=!1}).catch(e=>{t.loading.ticket=!1,t.errors.ticket="Failed to load ticket. Please try again.",console.error("Ticket load error:",e)}));t.submitTicket=()=>t.loading.submitting?Promise.reject("Already submitting"):!t.newTicket.ticket_type_id||!t.newTicket.description||t.newTicket.description.length<25?(t.errors.submission="Please fill in all required fields (description must be at least 25 characters).",Promise.reject("Validation failed")):(t.loading.submitting=!0,t.errors.submission=null,axios.post(`${t.base_url}/api/tickets`,{ticket_type_id:t.newTicket.ticket_type_id,description:t.newTicket.description}).then(i=>{t.loading.submitting=!1,t.tickets.unshift(i.data.ticket),t.currentTicket=i.data.ticket,t.resetForm(),t.setView("detail",i.data.ticket.id)}).catch(i=>{throw t.loading.submitting=!1,t.errors.submission=i.response?.data?.message||"Failed to create ticket. Please try again.",i}));t.submitComment=()=>t.loading.commenting||!t.currentTicket?Promise.reject("Cannot submit comment"):!t.newComment||t.newComment.length<5?(t.errors.comment="Comment must be at least 5 characters.",Promise.reject("Validation failed")):(t.loading.commenting=!0,t.errors.comment=null,axios.post(`${t.base_url}/api/tickets/${t.currentTicket.id}/comments`,{body:t.newComment}).then(i=>{t.loading.commenting=!1;const e=t.currentTicket.comments||[];e.push(i.data.comment),t.currentTicket.comments=[...e],t.newComment=""}).catch(i=>{throw t.loading.commenting=!1,t.errors.comment=i.response?.data?.message||"Failed to add comment. Please try again.",i}));t.setView=(i,e=null)=>{t.stopPolling(),t.currentView=i,i==="detail"&&e?(t.selectedTicketId=e,t.loadTicket(e),t.startPolling()):i==="create"&&e?t.selectType(e):i==="list"&&(t.currentTicket=null,t.selectedTicketId=null)};t.startPolling=()=>{t.stopPolling(),t.pollInterval=setInterval(()=>{t.selectedTicketId&&!t.loading.ticket&&t.refreshTicket()},3e4)};t.stopPolling=()=>{t.pollInterval&&(clearInterval(t.pollInterval),t.pollInterval=null)};t.refreshTicket=()=>{if(!t.selectedTicketId)return;const i=t.currentTicket?.comments?.length||0;axios.get(`${t.base_url}/api/tickets/${t.selectedTicketId}`).then(e=>{t.currentTicket&&e.data.ticket&&((e.data.ticket.comments?.length||0)>i&&t.playNotificationSound(),t.currentTicket.comments=e.data.ticket.comments,t.currentTicket.state=e.data.ticket.state,t.currentTicket.owner=e.data.ticket.owner)}).catch(()=>{})};t.playNotificationSound=()=>{if(t.soundEnabled)try{const i=new(window.AudioContext||window.webkitAudioContext),e=i.createOscillator(),u=i.createGain();e.connect(u),u.connect(i.destination),e.frequency.setValueAtTime(800,i.currentTime),e.frequency.setValueAtTime(600,i.currentTime+.1),u.gain.setValueAtTime(.3,i.currentTime),u.gain.exponentialRampToValueAtTime(.01,i.currentTime+.3),e.start(i.currentTime),e.stop(i.currentTime+.3)}catch{console.log("Could not play notification sound")}};t.toggleSound=()=>{t.soundEnabled=!t.soundEnabled};t.selectType=i=>{t.selectedType=i,t.newTicket.ticket_type_id=i.id,t.newTicket.description=""};t.resetForm=()=>{t.newTicket.ticket_type_id=null,t.newTicket.description="",t.selectedType=null,t.errors.submission=null};t.getStateColor=i=>({new:"info",assigned:"warning",resolved:"success",rejected:"danger"})[i]||"secondary";t.getStateBadgeClass=i=>`badge badge-${t.getStateColor(i)}`;t.formatDate=i=>i?new Date(i).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"";t.formatRelativeDate=i=>{if(!i)return"";const e=new Date(i),f=new Date-e,n=Math.floor(f/6e4),o=Math.floor(f/36e5),r=Math.floor(f/864e5);return n<1?"just now":n<60?`${n}m ago`:o<24?`${o}h ago`:r<7?`${r}d ago`:t.formatDate(i)};t.setViewMode=i=>{t.viewMode=i,i==="admin"?t.loadAdminTickets():t.loadTickets(),t.setView("list")};t.loadAdminTickets=()=>(t.loading.adminTickets=!0,t.errors.adminTickets=null,axios.get(`${t.base_url}/api/tickets/admin`).then(i=>{t.adminTickets=i.data.tickets||[],t.loading.adminTickets=!1}).catch(i=>{t.loading.adminTickets=!1,t.errors.adminTickets="Failed to load admin tickets. Please try again.",console.error("Admin tickets load error:",i)}));t.getFilteredAdminTickets=()=>{let i=t.adminTickets;if(t.adminFilters.state&&(i=i.filter(e=>e.state===t.adminFilters.state)),t.adminFilters.search){const e=t.adminFilters.search.toLowerCase();i=i.filter(u=>u.description?.toLowerCase().includes(e)||u.caller?.name?.toLowerCase().includes(e)||u.type?.name?.toLowerCase().includes(e))}return i};t.ownTicket=i=>t.loading.action?Promise.reject("Action in progress"):(t.loading.action=!0,t.errors.action=null,axios.post(`${t.base_url}/api/tickets/${i}/own`).then(e=>(t.loading.action=!1,t.updateTicketInLists(e.data.ticket),t.currentTicket?.id===i&&(t.currentTicket=e.data.ticket),e.data)).catch(e=>{throw t.loading.action=!1,t.errors.action=e.response?.data?.message||"Failed to assign ticket.",e}));t.resolveTicket=i=>t.loading.action?Promise.reject("Action in progress"):(t.loading.action=!0,t.errors.action=null,axios.post(`${t.base_url}/api/tickets/${i}/resolve`).then(e=>(t.loading.action=!1,t.updateTicketInLists(e.data.ticket),t.currentTicket?.id===i&&(t.currentTicket=e.data.ticket),e.data)).catch(e=>{throw t.loading.action=!1,t.errors.action=e.response?.data?.message||"Failed to resolve ticket.",e}));t.rejectTicket=(i,e)=>t.loading.action?Promise.reject("Action in progress"):(t.loading.action=!0,t.errors.action=null,axios.post(`${t.base_url}/api/tickets/${i}/reject`,{reason:e}).then(u=>(t.loading.action=!1,t.updateTicketInLists(u.data.ticket),t.currentTicket?.id===i&&(t.currentTicket=u.data.ticket),u.data)).catch(u=>{throw t.loading.action=!1,t.errors.action=u.response?.data?.message||"Failed to reject ticket.",u}));t.reopenTicket=i=>t.loading.action?Promise.reject("Action in progress"):(t.loading.action=!0,t.errors.action=null,axios.post(`${t.base_url}/api/tickets/${i}/reopen`).then(e=>(t.loading.action=!1,t.updateTicketInLists(e.data.ticket),t.currentTicket?.id===i&&(t.currentTicket=e.data.ticket),e.data)).catch(e=>{throw t.loading.action=!1,t.errors.action=e.response?.data?.message||"Failed to reopen ticket.",e}));t.updateTicketInLists=i=>{const e=t.tickets.findIndex(f=>f.id===i.id);e!==-1&&(t.tickets[e]=i);const u=t.adminTickets.findIndex(f=>f.id===i.id);u!==-1&&(t.adminTickets[u]=i)};t.getCurrentUserId=()=>window.Laravel?.userId||null;const P={data(){return{store:t}},methods:{selectType(i){t.setView("create",i)},getIconForType(i){return{"forum-change":"fa fa-edit","awards-medals":"fa fa-trophy","member-rename":"fa fa-id-card","teamspeak-change":"fa fa-headphones",misc:"fa fa-question-circle"}[i]||"fa fa-tag"}}},D={class:"ticket-type-select"},q={key:0,class:"text-center p-lg"},N={key:1,class:"alert alert-danger"},E={key:2,class:"type-list"},U=["onClick"],B={class:"panel-body"},W={class:"type-icon"},H={class:"type-content"},O={class:"type-name"},Y={class:"type-description"},z={key:3,class:"text-center p-lg"};function G(i,e,u,f,n,o){return l(),a("div",D,[e[6]||(e[6]=s("div",{class:"text-center m-b-lg"},[s("h4",{class:"text-white"},"What do you need help with?"),s("p",{class:"text-muted"},"Select the category that best describes your request")],-1)),n.store.loading.ticketTypes?(l(),a("div",q,[...e[1]||(e[1]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"sr-only"},"Loading...")],-1),s("p",{class:"m-t-md text-muted"},"Loading options...",-1)])])):n.store.errors.ticketTypes?(l(),a("div",N,[e[3]||(e[3]=s("i",{class:"fa fa-exclamation-circle m-r-sm"},null,-1)),d(" "+c(n.store.errors.ticketTypes)+" ",1),s("button",{class:"btn btn-sm btn-outline-danger pull-right",onClick:e[0]||(e[0]=r=>n.store.loadTicketTypes())},[...e[2]||(e[2]=[s("i",{class:"fa fa-refresh"},null,-1),d(" Retry ",-1)])])])):(l(),a("div",E,[(l(!0),a(y,null,C(n.store.ticketTypes,r=>(l(),a("a",{key:r.id,href:"#",class:"panel panel-filled type-card",onClick:h(_=>o.selectType(r),["prevent"])},[s("div",B,[s("div",W,[s("i",{class:k(o.getIconForType(r.slug))},null,2)]),s("div",H,[s("h5",O,c(r.name),1),s("p",Y,c(r.description),1)]),e[4]||(e[4]=s("div",{class:"type-arrow"},[s("i",{class:"fa fa-chevron-right"})],-1))])],8,U))),128))])),!n.store.loading.ticketTypes&&n.store.ticketTypes.length===0?(l(),a("div",z,[...e[5]||(e[5]=[s("i",{class:"fa fa-folder-open fa-3x text-muted m-b-md"},null,-1),s("h5",{class:"text-white"},"No Options Available",-1),s("p",{class:"text-muted"},"There are no ticket types available for your role.",-1)])])):m("",!0)])}const Q=g(P,[["render",G],["__scopeId","data-v-f9975e2a"]]),J={data(){return{store:t}},methods:{submitTicket(){t.submitTicket().catch(()=>{})},cancel(){t.resetForm(),t.setView("select-type")},getIconForType(i){return{"forum-change":"fa fa-edit","awards-medals":"fa fa-trophy","member-rename":"fa fa-id-card","teamspeak-change":"fa fa-headphones",misc:"fa fa-question-circle"}[i]||"fa fa-tag"}}},K={class:"ticket-form"},X={class:"form-header"},Z={class:"type-icon"},$={class:"type-info"},ee={class:"type-name"},te={key:0,class:"boilerplate-card"},se={class:"boilerplate-content"},ie={key:1,class:"alert alert-danger"},ne={class:"form-group"},re=["disabled"],oe={class:"counter-current"},le={class:"form-actions"},ae=["disabled"],ce=["disabled"],de={key:0},ue={key:1};function me(i,e,u,f,n,o){return l(),a("div",K,[s("div",X,[s("div",Z,[s("i",{class:k(o.getIconForType(n.store.selectedType?.slug))},null,2)]),s("div",$,[e[3]||(e[3]=s("span",{class:"type-label"},"New Request",-1)),s("h4",ee,c(n.store.selectedType?.name),1)])]),n.store.selectedType?.boilerplate?(l(),a("div",te,[e[4]||(e[4]=s("div",{class:"boilerplate-header"},[s("i",{class:"fa fa-lightbulb-o m-r-sm"}),d(" Please include the following information ")],-1)),s("div",se,[s("pre",null,c(n.store.selectedType.boilerplate),1)])])):m("",!0),n.store.errors.submission?(l(),a("div",ie,[e[5]||(e[5]=s("i",{class:"fa fa-exclamation-triangle m-r-sm"},null,-1)),d(" "+c(n.store.errors.submission),1)])):m("",!0),s("form",{onSubmit:e[2]||(e[2]=h((...r)=>o.submitTicket&&o.submitTicket(...r),["prevent"]))},[s("div",ne,[e[8]||(e[8]=s("label",{for:"description",class:"form-label"},[s("i",{class:"fa fa-pencil-square-o m-r-sm"}),d(" Description ")],-1)),p(s("textarea",{id:"description","onUpdate:modelValue":e[0]||(e[0]=r=>n.store.newTicket.description=r),class:"form-control",rows:"10",placeholder:"Describe your issue or request in detail...",disabled:n.store.loading.submitting,required:"",minlength:"25"},null,8,re),[[w,n.store.newTicket.description]]),s("div",{class:k(["char-counter",{"counter-valid":n.store.newTicket.description.length>=25}])},[s("span",oe,c(n.store.newTicket.description.length),1),e[6]||(e[6]=s("span",{class:"counter-divider"},"/",-1)),e[7]||(e[7]=s("span",{class:"counter-min"},"25 minimum",-1))],2)]),s("div",le,[s("button",{type:"button",class:"btn btn-default",onClick:e[1]||(e[1]=(...r)=>o.cancel&&o.cancel(...r)),disabled:n.store.loading.submitting},[...e[9]||(e[9]=[s("i",{class:"fa fa-times m-r-xs"},null,-1),d(" Cancel ",-1)])],8,ae),s("button",{type:"submit",class:"btn btn-primary",disabled:n.store.loading.submitting||n.store.newTicket.description.length<25},[n.store.loading.submitting?(l(),a("span",de,[...e[10]||(e[10]=[s("span",{class:"themed-spinner spinner-sm"},null,-1),d(" Creating Ticket... ",-1)])])):(l(),a("span",ue,[...e[11]||(e[11]=[s("i",{class:"fa fa-paper-plane m-r-sm"},null,-1),d(" Submit Request ",-1)])]))],8,ce)])],32)])}const ke=g(J,[["render",me],["__scopeId","data-v-c73ad36e"]]),fe={data(){return{store:t}},computed:{isAdminView(){return t.viewMode==="admin"},isLoading(){return this.isAdminView?t.loading.adminTickets:t.loading.tickets},hasError(){return this.isAdminView?t.errors.adminTickets:t.errors.tickets},errorMessage(){return this.isAdminView?t.errors.adminTickets:t.errors.tickets},loadingMessage(){return this.isAdminView?"Loading admin queue...":"Loading your tickets..."},listTitle(){return this.isAdminView?"Admin Queue":"Your Tickets"},displayTickets(){return this.isAdminView?t.getFilteredAdminTickets():t.tickets}},methods:{viewTicket(i){t.setView("detail",i.id)},retry(){this.isAdminView?t.loadAdminTickets():t.loadTickets()},truncateDescription(i){return i?i.length>100?i.substring(0,100)+"...":i:""},formatStatus(i){return{new:"Open",assigned:"In Progress",resolved:"Resolved",rejected:"Closed"}[i]||i},getStatusIcon(i){return{new:"far fa-circle",assigned:"fa fa-spinner",resolved:"fa fa-check-circle",rejected:"fa fa-times-circle"}[i]||"fa fa-circle"},getStateColor(i){return{new:"info",assigned:"warning",resolved:"success",rejected:"danger"}[i]||"white"}}},pe={class:"ticket-list"},ge={key:0,class:"text-center p-lg"},ve={class:"m-t-md text-muted"},Te={key:1,class:"alert alert-danger"},be={key:2,class:"text-center p-lg"},ye={key:3},we={key:0,class:"admin-filters m-b-md"},he={class:"filter-row"},_e={class:"text-white m-b-md"},xe={key:1,class:"text-center p-lg empty-results"},Ce={key:2,class:"ticket-cards"},je=["onClick"],Ve={class:"panel-body"},Ae={class:"ticket-main"},Ie={class:"ticket-header-row"},Me={class:"ticket-id"},Re={class:"ticket-type-badge"},Se={class:"ticket-preview"},Le={class:"ticket-meta"},Fe={key:0,class:"meta-item"},Pe={key:1,class:"meta-item"},De={class:"meta-item meta-time"};function qe(i,e,u,f,n,o){return l(),a("div",pe,[o.isLoading?(l(),a("div",ge,[e[4]||(e[4]=s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"sr-only"},"Loading...")],-1)),s("p",ve,c(o.loadingMessage),1)])):o.hasError?(l(),a("div",Te,[e[6]||(e[6]=s("i",{class:"fa fa-exclamation-circle m-r-sm"},null,-1)),d(" "+c(o.errorMessage)+" ",1),s("button",{class:"btn btn-sm btn-outline-danger pull-right",onClick:e[0]||(e[0]=(...r)=>o.retry&&o.retry(...r))},[...e[5]||(e[5]=[s("i",{class:"fa fa-refresh"},null,-1),d(" Retry ",-1)])])])):o.displayTickets.length===0&&!o.isAdminView?(l(),a("div",be,[e[8]||(e[8]=s("div",{class:"empty-icon"},[s("i",{class:"fa fa-inbox"})],-1)),e[9]||(e[9]=s("h4",{class:"text-white"},"No Tickets Yet",-1)),e[10]||(e[10]=s("p",{class:"text-muted m-b-lg"},"You haven't submitted any support requests yet.",-1)),s("button",{class:"btn btn-primary",onClick:e[1]||(e[1]=r=>i.$parent.showTypeSelector())},[...e[7]||(e[7]=[s("i",{class:"fa fa-plus m-r-xs"},null,-1),d(" Create Your First Ticket ",-1)])])])):(l(),a("div",ye,[o.isAdminView?(l(),a("div",we,[s("div",he,[p(s("select",{"onUpdate:modelValue":e[2]||(e[2]=r=>n.store.adminFilters.state=r),class:"form-control filter-select"},[...e[11]||(e[11]=[s("option",{value:null},"All States",-1),s("option",{value:"new"},"Open",-1),s("option",{value:"assigned"},"In Progress",-1),s("option",{value:"resolved"},"Resolved",-1),s("option",{value:"rejected"},"Rejected",-1)])],512),[[I,n.store.adminFilters.state]]),p(s("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>n.store.adminFilters.search=r),type:"text",class:"form-control filter-search",placeholder:"Search tickets..."},null,512),[[w,n.store.adminFilters.search]])])])):m("",!0),s("h5",_e,c(o.listTitle),1),o.displayTickets.length===0&&o.isAdminView?(l(),a("div",xe,[...e[12]||(e[12]=[s("div",{class:"empty-icon"},[s("i",{class:"fa fa-filter"})],-1),s("h4",{class:"text-white"},"No Matching Tickets",-1),s("p",{class:"text-muted m-b-none"},"Try adjusting your filters above.",-1)])])):(l(),a("div",Ce,[(l(!0),a(y,null,C(o.displayTickets,r=>(l(),a("a",{key:r.id,href:"#",class:k(["panel panel-filled ticket-card","panel-c-"+o.getStateColor(r.state)]),onClick:h(_=>o.viewTicket(r),["prevent"])},[s("div",Ve,[s("div",Ae,[s("div",Ie,[s("span",Me,"#"+c(r.id),1),s("span",Re,c(r.type?.name??"Unknown"),1)]),s("p",Se,c(o.truncateDescription(r.description)),1),s("div",Le,[s("span",{class:k(["status-badge","badge-"+r.state])},[s("i",{class:k(o.getStatusIcon(r.state))},null,2),d(" "+c(o.formatStatus(r.state)),1)],2),o.isAdminView&&r.caller?(l(),a("span",Fe,[e[13]||(e[13]=s("i",{class:"fa fa-user text-muted m-r-xs"},null,-1)),d(" "+c(r.caller.name),1)])):m("",!0),r.owner?(l(),a("span",Pe,[e[14]||(e[14]=s("i",{class:"fa fa-user-circle text-muted m-r-xs"},null,-1)),d(" "+c(r.owner.name),1)])):m("",!0),s("span",De,[e[15]||(e[15]=s("i",{class:"fa fa-clock-o text-muted m-r-xs"},null,-1)),d(" "+c(n.store.formatRelativeDate(r.created_at)),1)])])]),e[16]||(e[16]=s("div",{class:"ticket-arrow"},[s("i",{class:"fa fa-chevron-right"})],-1))])],10,je))),128))]))]))])}const Ne=g(fe,[["render",qe],["__scopeId","data-v-1bdd81c6"]]),Ee=["owned the ticket","assigned the ticket to","resolved the ticket","reopened the ticket","rejected the ticket"],Ue={data(){return{store:t,showRejectModal:!1,rejectReason:""}},computed:{isResolved(){return t.currentTicket?.state==="resolved"||t.currentTicket?.state==="rejected"},sortedComments(){return t.currentTicket?.comments?[...t.currentTicket.comments].sort((i,e)=>new Date(i.created_at)-new Date(e.created_at)):[]},userCommentCount(){return t.currentTicket?.comments?t.currentTicket.comments.filter(i=>!this.isSystemMessage(i)).length:0},showAdminActions(){return t.canWorkTickets},currentUserId(){return t.getCurrentUserId()},canAssign(){const i=t.currentTicket;return i?i.state==="new"||i.state==="assigned"&&i.owner?.id!==this.currentUserId:!1},canResolve(){const i=t.currentTicket;return i?i.state==="new"||i.state==="assigned":!1},canReject(){const i=t.currentTicket;return i?i.state==="new"||i.state==="assigned":!1},canReopen(){const i=t.currentTicket;return i?i.state==="resolved"||i.state==="rejected":!1}},methods:{reload(){t.selectedTicketId&&t.loadTicket(t.selectedTicketId)},submitComment(){t.submitComment().catch(()=>{})},assignToMe(){t.ownTicket(t.currentTicket.id).catch(()=>{})},resolveTicket(){t.resolveTicket(t.currentTicket.id).catch(()=>{})},rejectTicket(){t.rejectTicket(t.currentTicket.id,this.rejectReason).then(()=>{this.showRejectModal=!1,this.rejectReason=""}).catch(()=>{})},reopenTicket(){t.reopenTicket(t.currentTicket.id).catch(()=>{})},formatStatus(i){return{new:"Open",assigned:"In Progress",resolved:"Resolved",rejected:"Closed"}[i]||i},getStatusIcon(i){return{new:"far fa-circle",assigned:"fa fa-spinner",resolved:"fa fa-check-circle",rejected:"fa fa-times-circle"}[i]||"fa fa-circle"},isSystemMessage(i){const e=i.body.toLowerCase();return Ee.some(u=>e.includes(u))},getSystemIcon(i){const e=i.toLowerCase();return e.includes("resolved")?"fa fa-check-circle text-success":e.includes("rejected")?"fa fa-times-circle text-danger":e.includes("reopened")?"fa fa-undo text-warning":e.includes("owned")||e.includes("assigned")?"fa fa-user-plus text-info":"fa fa-info-circle text-muted"},formatSystemMessage(i){return i.toLowerCase()==="owned the ticket"?"took ownership of this ticket":i.toLowerCase()==="resolved the ticket"?"marked this ticket as resolved":i.toLowerCase()==="rejected the ticket"?"closed this ticket":i.toLowerCase()==="reopened the ticket"?"reopened this ticket":i.toLowerCase().includes("assigned the ticket to")?i.replace(/^.*?assigned the ticket to /i,"assigned this ticket to "):i},autolink(i){if(!i)return"";const e=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),u=/(https?:\/\/[^\s<]+)/g;return e.replace(u,'<a href="$1" target="_blank" rel="noopener noreferrer">$1</a>')}}},Be={class:"ticket-detail"},We={key:0,class:"text-center p-lg"},He={key:1,class:"alert alert-danger"},Oe={key:2},Ye={class:"header-main"},ze={class:"header-top"},Ge={class:"ticket-number"},Qe={class:"ticket-type"},Je={class:"header-meta"},Ke={key:0,class:"meta-block"},Xe={class:"meta-value"},Ze={key:0,class:"division-tag"},$e={key:1,class:"meta-block"},et={class:"meta-value"},tt={key:2,class:"meta-block"},st={class:"meta-block"},it={class:"meta-value"},nt={key:0,class:"admin-actions m-b-md"},rt={key:0,class:"alert alert-danger m-b-sm"},ot={class:"action-buttons"},lt=["disabled"],at=["disabled"],ct=["disabled"],dt=["disabled"],ut={class:"reject-modal"},mt={class:"reject-modal-header"},kt={class:"reject-modal-body"},ft={class:"form-group"},pt={class:"reject-modal-footer"},gt=["disabled"],vt={key:0},Tt={key:1},bt={class:"ticket-sections"},yt={class:"section-card"},wt={class:"section-content"},ht=["innerHTML"],_t={class:"section-card"},xt={class:"section-header"},Ct={class:"comment-count"},jt=["title"],Vt={class:"section-content"},At={key:0,class:"text-center p-md"},It={key:1,class:"comments-timeline"},Mt={key:0,class:"system-event"},Rt={class:"event-content"},St={class:"event-text"},Lt={class:"event-time"},Ft={class:"comment-bubble"},Pt={class:"comment-header"},Dt={class:"comment-author"},qt={key:0,class:"admin-badge"},Nt={class:"comment-time"},Et=["innerHTML"],Ut={key:2,class:"comment-form"},Bt={key:0,class:"alert alert-danger m-b-md"},Wt={class:"form-group"},Ht=["disabled"],Ot={class:"comment-actions"},Yt=["disabled"],zt={key:0},Gt={key:1},Qt={key:3,class:"closed-notice"};function Jt(i,e,u,f,n,o){return l(),a("div",Be,[n.store.loading.ticket?(l(),a("div",We,[...e[13]||(e[13]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"sr-only"},"Loading...")],-1),s("p",{class:"m-t-md text-muted"},"Loading ticket...",-1)])])):n.store.errors.ticket?(l(),a("div",He,[e[15]||(e[15]=s("i",{class:"fa fa-exclamation-circle m-r-sm"},null,-1)),d(" "+c(n.store.errors.ticket)+" ",1),s("button",{class:"btn btn-sm btn-outline-danger pull-right",onClick:e[0]||(e[0]=(...r)=>o.reload&&o.reload(...r))},[...e[14]||(e[14]=[s("i",{class:"fa fa-refresh"},null,-1),d(" Retry ",-1)])])])):n.store.currentTicket?(l(),a("div",Oe,[s("div",{class:k(["ticket-header","header-"+n.store.currentTicket.state])},[s("div",Ye,[s("div",ze,[s("span",Ge,"#"+c(n.store.currentTicket.id),1),s("span",{class:k(["status-pill","pill-"+n.store.currentTicket.state])},[s("i",{class:k(o.getStatusIcon(n.store.currentTicket.state))},null,2),d(" "+c(o.formatStatus(n.store.currentTicket.state)),1)],2)]),s("div",Qe,c(n.store.currentTicket.type?.name??"Unknown Type"),1)]),s("div",Je,[n.store.currentTicket.caller?(l(),a("div",Ke,[e[17]||(e[17]=s("div",{class:"meta-label"},"Submitted By",-1)),s("div",Xe,[e[16]||(e[16]=s("i",{class:"fa fa-user m-r-xs"},null,-1)),d(" "+c(n.store.currentTicket.caller.name)+" ",1),n.store.currentTicket.division?(l(),a("span",Ze,c(n.store.currentTicket.division.name),1)):m("",!0)])])):m("",!0),n.store.currentTicket.owner?(l(),a("div",$e,[e[19]||(e[19]=s("div",{class:"meta-label"},"Assigned To",-1)),s("div",et,[e[18]||(e[18]=s("i",{class:"fa fa-user-circle m-r-xs"},null,-1)),d(" "+c(n.store.currentTicket.owner.name),1)])])):(l(),a("div",tt,[...e[20]||(e[20]=[s("div",{class:"meta-label"},"Status",-1),s("div",{class:"meta-value text-muted"},[s("i",{class:"fa fa-hourglass-half m-r-xs"}),d(" Awaiting Assignment ")],-1)])])),s("div",st,[e[21]||(e[21]=s("div",{class:"meta-label"},"Created",-1)),s("div",it,c(n.store.formatDate(n.store.currentTicket.created_at)),1)])])],2),o.showAdminActions?(l(),a("div",nt,[n.store.errors.action?(l(),a("div",rt,[e[22]||(e[22]=s("i",{class:"fa fa-exclamation-circle m-r-xs"},null,-1)),d(" "+c(n.store.errors.action),1)])):m("",!0),s("div",ot,[o.canAssign?(l(),a("button",{key:0,class:"btn btn-info btn-sm",disabled:n.store.loading.action,onClick:e[1]||(e[1]=(...r)=>o.assignToMe&&o.assignToMe(...r))},[...e[23]||(e[23]=[s("i",{class:"fa fa-hand-paper-o m-r-xs"},null,-1),d(" Assign to Me ",-1)])],8,lt)):m("",!0),o.canResolve?(l(),a("button",{key:1,class:"btn btn-success btn-sm",disabled:n.store.loading.action,onClick:e[2]||(e[2]=(...r)=>o.resolveTicket&&o.resolveTicket(...r))},[...e[24]||(e[24]=[s("i",{class:"fa fa-check m-r-xs"},null,-1),d(" Resolve ",-1)])],8,at)):m("",!0),o.canReject?(l(),a("button",{key:2,class:"btn btn-danger btn-sm",disabled:n.store.loading.action,onClick:e[3]||(e[3]=r=>n.showRejectModal=!0)},[...e[25]||(e[25]=[s("i",{class:"fa fa-times m-r-xs"},null,-1),d(" Reject ",-1)])],8,ct)):m("",!0),o.canReopen?(l(),a("button",{key:3,class:"btn btn-warning btn-sm",disabled:n.store.loading.action,onClick:e[4]||(e[4]=(...r)=>o.reopenTicket&&o.reopenTicket(...r))},[...e[26]||(e[26]=[s("i",{class:"fa fa-undo m-r-xs"},null,-1),d(" Reopen ",-1)])],8,dt)):m("",!0)])])):m("",!0),n.showRejectModal?(l(),a("div",{key:1,class:"reject-modal-overlay",onClick:e[9]||(e[9]=h(r=>n.showRejectModal=!1,["self"]))},[s("div",ut,[s("div",mt,[e[28]||(e[28]=s("h5",null,"Reject Ticket",-1)),s("button",{type:"button",class:"close-btn",onClick:e[5]||(e[5]=r=>n.showRejectModal=!1)},[...e[27]||(e[27]=[s("i",{class:"fa fa-times"},null,-1)])])]),s("div",kt,[s("div",ft,[e[29]||(e[29]=s("label",null,"Reason for rejection",-1)),p(s("textarea",{"onUpdate:modelValue":e[6]||(e[6]=r=>n.rejectReason=r),class:"form-control",rows:"3",placeholder:"Explain why this ticket is being rejected..."},null,512),[[w,n.rejectReason]])])]),s("div",pt,[s("button",{class:"btn btn-default btn-sm",onClick:e[7]||(e[7]=r=>n.showRejectModal=!1)},"Cancel"),s("button",{class:"btn btn-danger btn-sm",disabled:n.rejectReason.length<5||n.store.loading.action,onClick:e[8]||(e[8]=(...r)=>o.rejectTicket&&o.rejectTicket(...r))},[n.store.loading.action?(l(),a("span",vt,[...e[30]||(e[30]=[s("span",{class:"themed-spinner spinner-sm"},null,-1),d(" Rejecting... ",-1)])])):(l(),a("span",Tt,"Reject Ticket"))],8,gt)])])])):m("",!0),s("div",bt,[s("div",yt,[e[31]||(e[31]=s("div",{class:"section-header"},[s("i",{class:"fa fa-file-text-o m-r-sm"}),d(" Description ")],-1)),s("div",wt,[s("p",{class:"description-text",innerHTML:o.autolink(n.store.currentTicket.description)},null,8,ht)])]),s("div",_t,[s("div",xt,[e[32]||(e[32]=s("i",{class:"fa fa-comments-o m-r-sm"},null,-1)),e[33]||(e[33]=d(" Discussion ",-1)),s("span",Ct,c(o.userCommentCount),1),s("button",{type:"button",class:k(["sound-toggle",{"sound-off":!n.store.soundEnabled}]),onClick:e[10]||(e[10]=r=>n.store.toggleSound()),title:n.store.soundEnabled?"Sound on - click to mute":"Sound off - click to unmute"},[s("i",{class:k(n.store.soundEnabled?"fa fa-volume-up":"fa fa-volume-off")},null,2)],10,jt)]),s("div",Vt,[!n.store.currentTicket.comments||n.store.currentTicket.comments.length===0?(l(),a("div",At,[...e[34]||(e[34]=[s("i",{class:"fa fa-comment-o fa-2x text-muted m-b-sm"},null,-1),s("p",{class:"text-muted m-b-none"},"No comments yet",-1)])])):(l(),a("div",It,[(l(!0),a(y,null,C(o.sortedComments,r=>(l(),a(y,{key:r.id},[o.isSystemMessage(r)?(l(),a("div",Mt,[e[35]||(e[35]=s("div",{class:"event-line"},null,-1)),s("div",Rt,[s("i",{class:k(o.getSystemIcon(r.body))},null,2),s("span",St,[s("strong",null,c(r.user?.name??"Unknown"),1),d(" "+c(o.formatSystemMessage(r.body)),1)]),s("span",Lt,c(n.store.formatRelativeDate(r.created_at)),1)])])):(l(),a("div",{key:1,class:k(["comment-item",{"comment-admin":r.user?.is_admin}])},[e[36]||(e[36]=s("div",{class:"comment-avatar"},[s("i",{class:"fa fa-user"})],-1)),s("div",Ft,[s("div",Pt,[s("span",Dt,[d(c(r.user?.name??"Unknown")+" ",1),r.user?.is_admin?(l(),a("span",qt,"Admin")):m("",!0)]),s("span",Nt,c(n.store.formatRelativeDate(r.created_at)),1)]),s("div",{class:"comment-body",innerHTML:o.autolink(r.body)},null,8,Et)])],2))],64))),128))])),o.isResolved?(l(),a("div",Qt,[e[41]||(e[41]=s("i",{class:"fa fa-lock m-r-sm"},null,-1)),d(" This ticket is "+c(n.store.currentTicket.state)+" and closed for further comments. ",1)])):(l(),a("div",Ut,[n.store.errors.comment?(l(),a("div",Bt,[e[37]||(e[37]=s("i",{class:"fa fa-exclamation-circle m-r-xs"},null,-1)),d(" "+c(n.store.errors.comment),1)])):m("",!0),s("div",Wt,[p(s("textarea",{"onUpdate:modelValue":e[11]||(e[11]=r=>n.store.newComment=r),class:"form-control",rows:"3",placeholder:"Write a reply...",disabled:n.store.loading.commenting},null,8,Ht),[[w,n.store.newComment]])]),s("div",Ot,[e[40]||(e[40]=s("small",{class:"text-muted"},"Minimum 5 characters",-1)),s("button",{type:"button",class:"btn btn-primary",disabled:n.store.loading.commenting||n.store.newComment.length<5,onClick:e[12]||(e[12]=(...r)=>o.submitComment&&o.submitComment(...r))},[n.store.loading.commenting?(l(),a("span",zt,[...e[38]||(e[38]=[s("span",{class:"themed-spinner spinner-sm"},null,-1),d(" Sending... ",-1)])])):(l(),a("span",Gt,[...e[39]||(e[39]=[s("i",{class:"fa fa-paper-plane m-r-xs"},null,-1),d(" Send Reply ",-1)])]))],8,Yt)])]))])])])])):m("",!0)])}const Kt=g(Ue,[["render",Jt],["__scopeId","data-v-5b120201"]]),Xt={components:{TicketTypeSelect:Q,TicketForm:ke,TicketList:Ne,TicketDetail:Kt},data(){return{store:t}},computed:{displayTickets(){return t.viewMode==="admin"?t.adminTickets:t.tickets},openCount(){return this.displayTickets.filter(i=>i.state==="new").length},assignedCount(){return this.displayTickets.filter(i=>i.state==="assigned").length},resolvedCount(){return this.displayTickets.filter(i=>i.state==="resolved"||i.state==="rejected").length}},methods:{showTypeSelector(){t.setView("select-type")}}},Zt={class:"ticket-widget"},$t={class:"actions-bar m-b-md"},es={class:"actions-row"},ts={key:1,class:"view-toggle"},ss={key:0,class:"row quick-stats m-b-md"},is={class:"col-md-3 col-sm-6"},ns={class:"panel panel-filled"},rs={class:"panel-body"},os={class:"stat-content"},ls={class:"stat-value"},as={class:"col-md-3 col-sm-6"},cs={class:"panel panel-filled"},ds={class:"panel-body"},us={class:"stat-content"},ms={class:"stat-value"},ks={class:"col-md-3 col-sm-6"},fs={class:"panel panel-filled"},ps={class:"panel-body"},gs={class:"stat-content"},vs={class:"stat-value"},Ts={class:"col-md-3 col-sm-6"},bs={class:"panel panel-filled"},ys={class:"panel-body"},ws={class:"stat-content"},hs={class:"stat-value"},_s={class:"panel panel-filled"},xs={class:"panel-body"};function Cs(i,e,u,f,n,o){const r=T("ticket-type-select"),_=T("ticket-form"),j=T("ticket-list"),V=T("ticket-detail");return l(),a("div",Zt,[e[17]||(e[17]=M('<div class="view-header" data-v-ab177a71><div class="header-icon" data-v-ab177a71><i class="pe pe-7s-help1" data-v-ab177a71></i></div><div class="header-title" data-v-ab177a71><h3 class="m-b-xs" data-v-ab177a71> Help Center </h3><small class="slight" data-v-ab177a71>Submit and track your support requests</small></div><hr data-v-ab177a71></div>',1)),s("div",$t,[s("div",es,[n.store.currentView!=="list"?(l(),a("button",{key:0,class:"btn btn-default btn-sm",onClick:e[0]||(e[0]=v=>n.store.setView("list"))},[...e[4]||(e[4]=[s("i",{class:"fa fa-arrow-left"},null,-1),d(" Back ",-1)])])):n.store.canWorkTickets?(l(),a("div",ts,[s("div",{class:k(["toggle-track",{"admin-active":n.store.viewMode==="admin"}])},[e[7]||(e[7]=s("div",{class:"toggle-indicator"},null,-1)),s("button",{class:k(["toggle-btn",{active:n.store.viewMode==="user"}]),onClick:e[1]||(e[1]=v=>n.store.setViewMode("user"))},[...e[5]||(e[5]=[s("i",{class:"fa fa-user m-r-xs"},null,-1),s("span",{class:"toggle-label"},"My Tickets",-1)])],2),s("button",{class:k(["toggle-btn",{active:n.store.viewMode==="admin"}]),onClick:e[2]||(e[2]=v=>n.store.setViewMode("admin"))},[...e[6]||(e[6]=[s("i",{class:"fa fa-list m-r-xs"},null,-1),s("span",{class:"toggle-label"},"All Tickets",-1)])],2)],2)])):m("",!0),n.store.currentView==="list"&&n.store.viewMode==="user"?(l(),a("button",{key:2,class:"btn btn-primary btn-sm ml-auto",onClick:e[3]||(e[3]=(...v)=>o.showTypeSelector&&o.showTypeSelector(...v))},[...e[8]||(e[8]=[s("i",{class:"fa fa-plus"},null,-1),d(" New Ticket ",-1)])])):m("",!0)])]),n.store.currentView==="list"&&o.displayTickets.length>0?(l(),a("div",ss,[s("div",is,[s("div",ns,[s("div",rs,[e[10]||(e[10]=s("div",{class:"stat-icon"},[s("i",{class:"fa fa-life-ring text-info"})],-1)),s("div",os,[s("span",ls,c(o.displayTickets.length),1),e[9]||(e[9]=s("span",{class:"stat-label"},"Total",-1))])])])]),s("div",as,[s("div",cs,[s("div",ds,[e[12]||(e[12]=s("div",{class:"stat-icon"},[s("i",{class:"fa fa-envelope-open text-primary"})],-1)),s("div",us,[s("span",ms,c(o.openCount),1),e[11]||(e[11]=s("span",{class:"stat-label"},"Open",-1))])])])]),s("div",ks,[s("div",fs,[s("div",ps,[e[14]||(e[14]=s("div",{class:"stat-icon"},[s("i",{class:"fa fa-spinner text-warning"})],-1)),s("div",gs,[s("span",vs,c(o.assignedCount),1),e[13]||(e[13]=s("span",{class:"stat-label"},"In Progress",-1))])])])]),s("div",Ts,[s("div",bs,[s("div",ys,[e[16]||(e[16]=s("div",{class:"stat-icon"},[s("i",{class:"fa fa-check-circle text-success"})],-1)),s("div",ws,[s("span",hs,c(o.resolvedCount),1),e[15]||(e[15]=s("span",{class:"stat-label"},"Resolved",-1))])])])])])):m("",!0),s("div",_s,[s("div",xs,[R(L,{name:"fade",mode:"out-in"},{default:S(()=>[n.store.currentView==="select-type"?(l(),b(r,{key:"select-type"})):n.store.currentView==="create"?(l(),b(_,{key:"create"})):n.store.currentView==="list"?(l(),b(j,{key:"list"})):n.store.currentView==="detail"?(l(),b(V,{key:"detail"})):m("",!0)]),_:1})])])])}const js=g(Xt,[["render",Cs],["__scopeId","data-v-ab177a71"]]),x=document.getElementById("ticket-widget-container");if(x){const i=x.dataset.ticketId,e=x.dataset.initialView;t.loadTickets(),t.loadTicketTypes(),i?t.setView("detail",parseInt(i,10)):e&&t.setView(e),F(js).mount("#ticket-widget-container")}
