import{r as C,_ as v,c as a,o as l,b as n,d as c,t as m,F as _,g as b,f as k,a as u,w,v as x,k as h,e as A,p as D,l as y,T as U,m as V}from"./_plugin-vue_export-helper-BHzaNdzO.js";import"./_commonjsHelpers-Cpj98o6Y.js";const t=C({baseUrl:"",canDelete:!1,currentView:"list",currentApplication:null,loading:{applications:!1,application:!1,commenting:!1,deleting:!1,deletingComment:null},errors:{applications:null,application:null,comment:null},applications:[],newComment:""});t.init=(o,e)=>{t.baseUrl=o,t.canDelete=e};t.loadApplications=()=>(t.loading.applications=!0,t.errors.applications=null,axios.get(t.baseUrl).then(o=>{t.applications=o.data.applications||[],t.loading.applications=!1}).catch(()=>{t.loading.applications=!1,t.errors.applications="Failed to load applications. Please try again."}));t.loadApplication=o=>(t.loading.application=!0,t.errors.application=null,axios.get(`${t.baseUrl}/${o}`).then(e=>{t.currentApplication=e.data.application,t.loading.application=!1}).catch(()=>{t.loading.application=!1,t.errors.application="Failed to load application. Please try again."}));t.deleteApplication=o=>t.loading.deleting?Promise.reject("Already deleting"):(t.loading.deleting=!0,axios.delete(`${t.baseUrl}/${o}`).then(()=>{t.applications=t.applications.filter(e=>e.id!==o),t.loading.deleting=!1,t.setView("list")}).catch(e=>{throw t.loading.deleting=!1,e}));t.submitComment=()=>t.loading.commenting||!t.currentApplication?Promise.reject("Cannot submit comment"):!t.newComment||t.newComment.length<5?(t.errors.comment="Comment must be at least 5 characters.",Promise.reject("Validation failed")):(t.loading.commenting=!0,t.errors.comment=null,axios.post(`${t.baseUrl}/${t.currentApplication.id}/comments`,{body:t.newComment}).then(o=>{t.loading.commenting=!1;const e=t.currentApplication.comments||[];e.push(o.data.comment),t.currentApplication.comments=[...e],t.newComment="";const d=t.applications.find(p=>p.id===t.currentApplication.id);d&&(d.comments_count=(d.comments_count||0)+1)}).catch(o=>{throw t.loading.commenting=!1,t.errors.comment=o.response?.data?.message||"Failed to add comment. Please try again.",o}));t.deleteComment=o=>t.loading.deletingComment?Promise.reject("Already deleting"):(t.loading.deletingComment=o,axios.delete(`${t.baseUrl}/${t.currentApplication.id}/comments/${o}`).then(()=>{t.currentApplication.comments=t.currentApplication.comments.filter(d=>d.id!==o),t.loading.deletingComment=null;const e=t.applications.find(d=>d.id===t.currentApplication.id);e&&(e.comments_count=Math.max(0,(e.comments_count||1)-1))}).catch(e=>{throw t.loading.deletingComment=null,e}));t.setView=(o,e=null)=>{t.currentView=o,o==="detail"&&e?t.loadApplication(e):o==="list"&&(t.currentApplication=null,t.newComment="",t.errors.comment=null)};t.formatRelativeDate=o=>{if(!o)return"";const e=new Date(o),p=new Date-e,s=Math.floor(p/6e4),r=Math.floor(p/36e5),i=Math.floor(p/864e5);return s<1?"just now":s<60?`${s}m ago`:r<24?`${r}h ago`:i<7?`${i}d ago`:e.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})};t.getCurrentUserId=()=>window.Laravel?.userId||null;const M={data(){return{store:t}}},L={class:"application-list"},T={key:0,class:"text-center p-lg"},I={key:1,class:"alert alert-danger"},P={key:2,class:"text-center p-lg"},R={key:3,class:"application-cards"},B=["onClick"],N={class:"panel-body"},j={class:"app-main"},F={class:"app-name"},H={class:"app-meta"},S={class:"meta-time"},E={key:0,class:"meta-comments"};function W(o,e,d,p,s,r){return l(),a("div",L,[s.store.loading.applications?(l(),a("div",T,[...e[1]||(e[1]=[n("div",{class:"spinner-border text-primary",role:"status"},[n("span",{class:"sr-only"},"Loading...")],-1),n("p",{class:"m-t-md text-muted"},"Loading applications...",-1)])])):s.store.errors.applications?(l(),a("div",I,[e[3]||(e[3]=n("i",{class:"fa fa-exclamation-circle m-r-sm"},null,-1)),c(" "+m(s.store.errors.applications)+" ",1),n("button",{class:"btn btn-sm btn-outline-danger pull-right",onClick:e[0]||(e[0]=i=>s.store.loadApplications())},[...e[2]||(e[2]=[n("i",{class:"fa fa-refresh"},null,-1),c(" Retry ",-1)])])])):s.store.applications.length===0?(l(),a("div",P,[...e[4]||(e[4]=[n("div",{class:"empty-icon"},[n("i",{class:"fab fa-discord"})],-1),n("h4",{class:"text-white"},"No Pending Applications",-1),n("p",{class:"text-muted m-b-none"},"There are no pending Discord applications for this division.",-1)])])):(l(),a("div",R,[(l(!0),a(_,null,b(s.store.applications,i=>(l(),a("a",{key:i.id,href:"#",class:"panel panel-filled application-card",onClick:k(f=>s.store.setView("detail",i.id),["prevent"])},[n("div",N,[n("div",j,[n("div",F,m(i.discord_username),1),n("div",H,[n("span",S,[e[5]||(e[5]=n("i",{class:"fa fa-clock-o text-muted m-r-xs"},null,-1)),c(" "+m(s.store.formatRelativeDate(i.created_at)),1)]),i.comments_count>0?(l(),a("span",E,[e[6]||(e[6]=n("i",{class:"fa fa-comment-o text-muted m-r-xs"},null,-1)),c(" "+m(i.comments_count),1)])):u("",!0)])]),e[7]||(e[7]=n("div",{class:"app-arrow"},[n("i",{class:"fa fa-chevron-right"})],-1))])],8,B))),128))]))])}const q=v(M,[["render",W],["__scopeId","data-v-7a90c87b"]]),z={data(){return{store:t}},computed:{sortedComments(){return t.currentApplication?.comments?[...t.currentApplication.comments].sort((o,e)=>new Date(o.created_at)-new Date(e.created_at)):[]},commentCount(){return t.currentApplication?.comments?.length||0},currentUserId(){return t.getCurrentUserId()}},methods:{reload(){t.currentApplication?.id&&t.loadApplication(t.currentApplication.id)},submitComment(){t.submitComment().catch(()=>{})},confirmDelete(){confirm("Are you sure you want to delete this application?")&&t.deleteApplication(t.currentApplication.id).catch(()=>{})},deleteComment(o){t.deleteComment(o).catch(()=>{})},autolink(o){if(!o)return"";const e=o.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),d=/(https?:\/\/[^\s<]+)/g;return e.replace(d,'<a href="$1" target="_blank" rel="noopener noreferrer">$1</a>')}}},G={class:"application-detail"},J={key:0,class:"text-center p-lg"},K={key:1,class:"alert alert-danger"},O={key:2},Q={class:"app-header"},X={class:"header-main"},Y={class:"app-username"},Z={class:"app-date"},ee=["disabled"],te={key:0},ne={key:1},se={class:"detail-sections"},oe={class:"section-card"},ie={class:"section-content"},le={class:"response-label"},ae=["innerHTML"],re={class:"section-card"},ce={class:"section-header"},de={class:"comment-count"},me={class:"section-content"},pe={key:0,class:"text-center p-md"},ue={key:1,class:"comments-timeline"},fe={class:"comment-bubble"},ge={class:"comment-header"},_e={class:"comment-author"},be={class:"comment-header-right"},ve={class:"comment-time"},he=["disabled","onClick"],ye=["innerHTML"],Ce={class:"comment-form"},ke={key:0,class:"alert alert-danger m-b-md"},we={class:"form-group"},xe=["disabled"],Ae={class:"comment-actions"},De=["disabled"],Ue={key:0},Ve={key:1};function Me(o,e,d,p,s,r){return l(),a("div",G,[s.store.loading.application?(l(),a("div",J,[...e[4]||(e[4]=[n("div",{class:"spinner-border text-primary",role:"status"},[n("span",{class:"sr-only"},"Loading...")],-1),n("p",{class:"m-t-md text-muted"},"Loading application...",-1)])])):s.store.errors.application?(l(),a("div",K,[e[6]||(e[6]=n("i",{class:"fa fa-exclamation-circle m-r-sm"},null,-1)),c(" "+m(s.store.errors.application)+" ",1),n("button",{class:"btn btn-sm btn-outline-danger pull-right",onClick:e[0]||(e[0]=(...i)=>r.reload&&r.reload(...i))},[...e[5]||(e[5]=[n("i",{class:"fa fa-refresh"},null,-1),c(" Retry ",-1)])])])):s.store.currentApplication?(l(),a("div",O,[n("div",Q,[n("div",X,[n("div",Y,m(s.store.currentApplication.discord_username),1),n("div",Z,[e[7]||(e[7]=n("i",{class:"fa fa-clock-o m-r-xs"},null,-1)),c(" "+m(s.store.formatRelativeDate(s.store.currentApplication.created_at)),1)])]),s.store.canDelete?(l(),a("button",{key:0,class:"btn btn-danger btn-sm",disabled:s.store.loading.deleting,onClick:e[1]||(e[1]=(...i)=>r.confirmDelete&&r.confirmDelete(...i))},[s.store.loading.deleting?(l(),a("span",te,[...e[8]||(e[8]=[n("span",{class:"themed-spinner spinner-sm"},null,-1),c(" Deleting... ",-1)])])):(l(),a("span",ne,[...e[9]||(e[9]=[n("i",{class:"fa fa-trash m-r-xs"},null,-1),c(" Delete ",-1)])]))],8,ee)):u("",!0)]),n("div",se,[n("div",oe,[e[10]||(e[10]=n("div",{class:"section-header"},[n("i",{class:"fa fa-file-text-o m-r-sm"}),c(" Responses ")],-1)),n("div",ie,[(l(!0),a(_,null,b(s.store.currentApplication.responses,(i,f)=>(l(),a("div",{key:f,class:"response-item"},[n("div",le,m(i.label),1),n("div",{class:"response-value",innerHTML:r.autolink(i.value)},null,8,ae)]))),128))])]),n("div",re,[n("div",ce,[e[11]||(e[11]=n("i",{class:"fa fa-comments-o m-r-sm"},null,-1)),e[12]||(e[12]=c(" Comments ",-1)),n("span",de,m(r.commentCount),1)]),n("div",me,[!s.store.currentApplication.comments||s.store.currentApplication.comments.length===0?(l(),a("div",pe,[...e[13]||(e[13]=[n("i",{class:"fa fa-comment-o fa-2x text-muted m-b-sm"},null,-1),n("p",{class:"text-muted m-b-none"},"No comments yet",-1)])])):(l(),a("div",ue,[(l(!0),a(_,null,b(r.sortedComments,i=>(l(),a("div",{key:i.id,class:"comment-item"},[n("div",fe,[n("div",ge,[n("span",_e,m(i.user?.name??"Unknown"),1),n("div",be,[n("span",ve,m(s.store.formatRelativeDate(i.created_at)),1),i.user?.id===r.currentUserId?(l(),a("button",{key:0,class:"delete-comment-btn",disabled:s.store.loading.deletingComment===i.id,onClick:f=>r.deleteComment(i.id),title:"Delete comment"},[...e[14]||(e[14]=[n("i",{class:"fa fa-times"},null,-1)])],8,he)):u("",!0)])]),n("div",{class:"comment-body",innerHTML:r.autolink(i.body)},null,8,ye)])]))),128))])),n("div",Ce,[s.store.errors.comment?(l(),a("div",ke,[e[15]||(e[15]=n("i",{class:"fa fa-exclamation-circle m-r-xs"},null,-1)),c(" "+m(s.store.errors.comment),1)])):u("",!0),n("div",we,[w(n("textarea",{"onUpdate:modelValue":e[2]||(e[2]=i=>s.store.newComment=i),class:"form-control",rows:"3",placeholder:"Write a comment...",disabled:s.store.loading.commenting},null,8,xe),[[x,s.store.newComment]])]),n("div",Ae,[e[18]||(e[18]=n("small",{class:"text-muted"},"Minimum 5 characters",-1)),n("button",{type:"button",class:"btn btn-primary",disabled:s.store.loading.commenting||s.store.newComment.length<5,onClick:e[3]||(e[3]=(...i)=>r.submitComment&&r.submitComment(...i))},[s.store.loading.commenting?(l(),a("span",Ue,[...e[16]||(e[16]=[n("span",{class:"themed-spinner spinner-sm"},null,-1),c(" Sending... ",-1)])])):(l(),a("span",Ve,[...e[17]||(e[17]=[n("i",{class:"fa fa-paper-plane m-r-xs"},null,-1),c(" Send ",-1)])]))],8,De)])])])])])])):u("",!0)])}const Le=v(z,[["render",Me],["__scopeId","data-v-e3905332"]]),Te={components:{ApplicationList:q,ApplicationDetail:Le},data(){return{store:t}}},Ie={class:"application-widget"},Pe={key:0,class:"actions-bar"};function Re(o,e,d,p,s,r){const i=h("application-list"),f=h("application-detail");return l(),a("div",Ie,[s.store.currentView!=="list"?(l(),a("div",Pe,[n("button",{class:"btn btn-default btn-sm",onClick:e[0]||(e[0]=Ne=>s.store.setView("list"))},[...e[1]||(e[1]=[n("i",{class:"fa fa-arrow-left"},null,-1),c(" Back ",-1)])])])):u("",!0),A(U,{name:"fade",mode:"out-in"},{default:D(()=>[s.store.currentView==="list"?(l(),y(i,{key:"list"})):s.store.currentView==="detail"?(l(),y(f,{key:"detail"})):u("",!0)]),_:1})])}const Be=v(Te,[["render",Re],["__scopeId","data-v-97fda670"]]),g=document.getElementById("applications-widget-container");if(g){const o=g.dataset.url,e=g.dataset.canDelete==="true";t.init(o,e),V(Be).mount("#applications-widget-container");const p=document.getElementById("applicationsModal");p&&$(p).on("shown.bs.modal",()=>{t.applications.length===0&&!t.loading.applications&&t.loadApplications()})}
