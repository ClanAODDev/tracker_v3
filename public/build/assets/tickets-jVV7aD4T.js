import{r as L,_ as v,c as a,o as l,b as s,a as m,d as c,t as u,F as h,g as C,f as b,n as f,w as y,v as _,h as V,j as T,e as S,p as R,l as w,T as P,m as I}from"./_plugin-vue_export-helper-BlWgqVok.js";import"./_commonjsHelpers-Cpj98o6Y.js";const x="ticket_last_seen",t=L({base_url:window.Laravel.appPath,currentView:"list",selectedTicketId:null,pollInterval:null,unreadPollInterval:null,soundEnabled:!0,unreadCount:0,isAdmin:window.Laravel?.isAdmin||!1,canWorkTickets:window.Laravel?.canWorkTickets||!1,viewMode:"user",adminTickets:[],adminFilters:{state:null,search:""},loading:{tickets:!1,ticketTypes:!1,ticket:!1,submitting:!1,commenting:!1,adminTickets:!1,action:!1},errors:{tickets:null,ticketTypes:null,ticket:null,submission:null,comment:null,adminTickets:null,action:null},tickets:[],ticketTypes:[],selectedType:null,currentTicket:null,newTicket:{ticket_type_id:null,description:""},newComment:""});t.loadTickets=()=>(t.loading.tickets=!0,t.errors.tickets=null,axios.get(`${t.base_url}/api/tickets`).then(i=>{t.tickets=i.data.tickets||[],t.loading.tickets=!1}).catch(i=>{t.loading.tickets=!1,t.errors.tickets="Failed to load tickets. Please try again.",console.error("Tickets load error:",i)}));t.loadTicketTypes=()=>(t.loading.ticketTypes=!0,t.errors.ticketTypes=null,axios.get(`${t.base_url}/api/tickets/types`).then(i=>{t.ticketTypes=i.data.types||[],t.loading.ticketTypes=!1}).catch(i=>{t.loading.ticketTypes=!1,t.errors.ticketTypes="Failed to load ticket types. Please try again.",console.error("Ticket types load error:",i)}));t.loadTicket=i=>(t.loading.ticket=!0,t.errors.ticket=null,axios.get(`${t.base_url}/api/tickets/${i}`).then(e=>{t.currentTicket=e.data.ticket,t.loading.ticket=!1}).catch(e=>{t.loading.ticket=!1,t.errors.ticket="Failed to load ticket. Please try again.",console.error("Ticket load error:",e)}));t.submitTicket=()=>t.loading.submitting?Promise.reject("Already submitting"):!t.newTicket.ticket_type_id||!t.newTicket.description||t.newTicket.description.length<25?(t.errors.submission="Please fill in all required fields (description must be at least 25 characters).",Promise.reject("Validation failed")):(t.loading.submitting=!0,t.errors.submission=null,axios.post(`${t.base_url}/api/tickets`,{ticket_type_id:t.newTicket.ticket_type_id,description:t.newTicket.description}).then(i=>{t.loading.submitting=!1,t.tickets.unshift(i.data.ticket),t.currentTicket=i.data.ticket,t.resetForm(),t.setView("detail",i.data.ticket.id)}).catch(i=>{throw t.loading.submitting=!1,t.errors.submission=i.response?.data?.message||"Failed to create ticket. Please try again.",i}));t.submitComment=()=>t.loading.commenting||!t.currentTicket?Promise.reject("Cannot submit comment"):!t.newComment||t.newComment.length<5?(t.errors.comment="Comment must be at least 5 characters.",Promise.reject("Validation failed")):(t.loading.commenting=!0,t.errors.comment=null,axios.post(`${t.base_url}/api/tickets/${t.currentTicket.id}/comments`,{body:t.newComment}).then(i=>{t.loading.commenting=!1;const e=t.currentTicket.comments||[];e.push(i.data.comment),t.currentTicket.comments=[...e],t.newComment=""}).catch(i=>{throw t.loading.commenting=!1,t.errors.comment=i.response?.data?.message||"Failed to add comment. Please try again.",i}));t.setView=(i,e=null)=>{t.stopPolling(),t.currentView=i,i==="detail"&&e?(t.selectedTicketId=e,t.loadTicket(e),t.startPolling()):i==="create"&&e?t.selectType(e):i==="list"&&(t.currentTicket=null,t.selectedTicketId=null)};t.startPolling=()=>{t.stopPolling(),t.pollInterval=setInterval(()=>{t.selectedTicketId&&!t.loading.ticket&&t.refreshTicket()},3e4)};t.stopPolling=()=>{t.pollInterval&&(clearInterval(t.pollInterval),t.pollInterval=null)};t.refreshTicket=()=>{if(!t.selectedTicketId)return;const i=t.currentTicket?.comments?.length||0;axios.get(`${t.base_url}/api/tickets/${t.selectedTicketId}`).then(e=>{t.currentTicket&&e.data.ticket&&((e.data.ticket.comments?.length||0)>i&&t.playNotificationSound(),t.currentTicket.comments=e.data.ticket.comments,t.currentTicket.state=e.data.ticket.state,t.currentTicket.owner=e.data.ticket.owner)}).catch(()=>{})};t.playNotificationSound=()=>{if(t.soundEnabled)try{const i=new(window.AudioContext||window.webkitAudioContext),e=i.createOscillator(),d=i.createGain();e.connect(d),d.connect(i.destination),e.frequency.setValueAtTime(800,i.currentTime),e.frequency.setValueAtTime(600,i.currentTime+.1),d.gain.setValueAtTime(.3,i.currentTime),d.gain.exponentialRampToValueAtTime(.01,i.currentTime+.3),e.start(i.currentTime),e.stop(i.currentTime+.3)}catch{console.log("Could not play notification sound")}};t.toggleSound=()=>{t.soundEnabled=!t.soundEnabled};t.selectType=i=>{t.selectedType=i,t.newTicket.ticket_type_id=i.id,t.newTicket.description=""};t.resetForm=()=>{t.newTicket.ticket_type_id=null,t.newTicket.description="",t.selectedType=null,t.errors.submission=null};t.getStateColor=i=>({new:"info",assigned:"warning",resolved:"success",rejected:"danger"})[i]||"secondary";t.getStateBadgeClass=i=>`badge badge-${t.getStateColor(i)}`;t.formatDate=i=>i?new Date(i).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"";t.formatRelativeDate=i=>{if(!i)return"";const e=new Date(i),k=new Date-e,n=Math.floor(k/6e4),o=Math.floor(k/36e5),r=Math.floor(k/864e5);return n<1?"just now":n<60?`${n}m ago`:o<24?`${o}h ago`:r<7?`${r}d ago`:t.formatDate(i)};t.getLastSeen=()=>{try{const i=localStorage.getItem(x);return i?JSON.parse(i):{}}catch{return{}}};t.setLastSeen=i=>{const e=t.getLastSeen();e[i]=new Date().toISOString();try{localStorage.setItem(x,JSON.stringify(e))}catch{}};t.markAllSeen=()=>{const i=t.getLastSeen();t.tickets.forEach(e=>{i[e.id]=new Date().toISOString()});try{localStorage.setItem(x,JSON.stringify(i))}catch{}t.unreadCount=0,t.updateBadge()};t.calculateUnreadCount=()=>{const i=t.getLastSeen();let e=0;t.tickets.forEach(d=>{if(d.state==="resolved"||d.state==="rejected")return;const k=i[d.id];if(!k)e++;else{const n=new Date(k);new Date(d.updated_at)>n&&e++}}),t.unreadCount=e,t.updateBadge()};t.updateBadge=()=>{document.querySelectorAll(".help-badge").forEach(e=>{t.unreadCount>0?(e.textContent=t.unreadCount>9?"9+":t.unreadCount,e.style.display="flex"):e.style.display="none"})};t.startUnreadPolling=()=>{t.checkUnread(),t.unreadPollInterval=setInterval(()=>{t.checkUnread()},6e4)};t.stopUnreadPolling=()=>{t.unreadPollInterval&&(clearInterval(t.unreadPollInterval),t.unreadPollInterval=null)};t.checkUnread=()=>{axios.get(`${t.base_url}/api/tickets`).then(i=>{t.tickets=i.data.tickets||[],t.calculateUnreadCount()}).catch(()=>{})};t.setViewMode=i=>{t.viewMode=i,i==="admin"?t.loadAdminTickets():t.loadTickets(),t.setView("list")};t.loadAdminTickets=()=>(t.loading.adminTickets=!0,t.errors.adminTickets=null,axios.get(`${t.base_url}/api/tickets/admin`).then(i=>{t.adminTickets=i.data.tickets||[],t.loading.adminTickets=!1}).catch(i=>{t.loading.adminTickets=!1,t.errors.adminTickets="Failed to load admin tickets. Please try again.",console.error("Admin tickets load error:",i)}));t.getFilteredAdminTickets=()=>{let i=t.adminTickets;if(t.adminFilters.state&&(i=i.filter(e=>e.state===t.adminFilters.state)),t.adminFilters.search){const e=t.adminFilters.search.toLowerCase();i=i.filter(d=>d.description?.toLowerCase().includes(e)||d.caller?.name?.toLowerCase().includes(e)||d.type?.name?.toLowerCase().includes(e))}return i};t.ownTicket=i=>t.loading.action?Promise.reject("Action in progress"):(t.loading.action=!0,t.errors.action=null,axios.post(`${t.base_url}/api/tickets/${i}/own`).then(e=>(t.loading.action=!1,t.updateTicketInLists(e.data.ticket),t.currentTicket?.id===i&&(t.currentTicket=e.data.ticket),e.data)).catch(e=>{throw t.loading.action=!1,t.errors.action=e.response?.data?.message||"Failed to assign ticket.",e}));t.resolveTicket=i=>t.loading.action?Promise.reject("Action in progress"):(t.loading.action=!0,t.errors.action=null,axios.post(`${t.base_url}/api/tickets/${i}/resolve`).then(e=>(t.loading.action=!1,t.updateTicketInLists(e.data.ticket),t.currentTicket?.id===i&&(t.currentTicket=e.data.ticket),e.data)).catch(e=>{throw t.loading.action=!1,t.errors.action=e.response?.data?.message||"Failed to resolve ticket.",e}));t.rejectTicket=(i,e)=>t.loading.action?Promise.reject("Action in progress"):(t.loading.action=!0,t.errors.action=null,axios.post(`${t.base_url}/api/tickets/${i}/reject`,{reason:e}).then(d=>(t.loading.action=!1,t.updateTicketInLists(d.data.ticket),t.currentTicket?.id===i&&(t.currentTicket=d.data.ticket),d.data)).catch(d=>{throw t.loading.action=!1,t.errors.action=d.response?.data?.message||"Failed to reject ticket.",d}));t.reopenTicket=i=>t.loading.action?Promise.reject("Action in progress"):(t.loading.action=!0,t.errors.action=null,axios.post(`${t.base_url}/api/tickets/${i}/reopen`).then(e=>(t.loading.action=!1,t.updateTicketInLists(e.data.ticket),t.currentTicket?.id===i&&(t.currentTicket=e.data.ticket),e.data)).catch(e=>{throw t.loading.action=!1,t.errors.action=e.response?.data?.message||"Failed to reopen ticket.",e}));t.updateTicketInLists=i=>{const e=t.tickets.findIndex(k=>k.id===i.id);e!==-1&&(t.tickets[e]=i);const d=t.adminTickets.findIndex(k=>k.id===i.id);d!==-1&&(t.adminTickets[d]=i)};t.getCurrentUserId=()=>window.Laravel?.userId||null;const F={data(){return{store:t}},methods:{selectType(i){t.setView("create",i)},getIconForType(i){return{"forum-change":"fa fa-edit","awards-medals":"fa fa-trophy","member-rename":"fa fa-id-card","teamspeak-change":"fa fa-headphones",misc:"fa fa-question-circle"}[i]||"fa fa-tag"}}},D={class:"ticket-type-select"},U={key:0,class:"text-center p-lg"},E={key:1,class:"alert alert-danger"},N={key:2,class:"type-list"},O=["onClick"],q={class:"panel-body"},B={class:"type-icon"},W={class:"type-content"},H={class:"type-name"},Y={class:"type-description"},J={key:3,class:"text-center p-lg"};function Q(i,e,d,k,n,o){return l(),a("div",D,[e[6]||(e[6]=s("div",{class:"text-center m-b-lg"},[s("h4",{class:"text-white"},"What do you need help with?"),s("p",{class:"text-muted"},"Select the category that best describes your request")],-1)),n.store.loading.ticketTypes?(l(),a("div",U,[...e[1]||(e[1]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"sr-only"},"Loading...")],-1),s("p",{class:"m-t-md text-muted"},"Loading options...",-1)])])):n.store.errors.ticketTypes?(l(),a("div",E,[e[3]||(e[3]=s("i",{class:"fa fa-exclamation-circle m-r-sm"},null,-1)),c(" "+u(n.store.errors.ticketTypes)+" ",1),s("button",{class:"btn btn-sm btn-outline-danger pull-right",onClick:e[0]||(e[0]=r=>n.store.loadTicketTypes())},[...e[2]||(e[2]=[s("i",{class:"fa fa-refresh"},null,-1),c(" Retry ",-1)])])])):(l(),a("div",N,[(l(!0),a(h,null,C(n.store.ticketTypes,r=>(l(),a("a",{key:r.id,href:"#",class:"panel panel-filled type-card",onClick:b(p=>o.selectType(r),["prevent"])},[s("div",q,[s("div",B,[s("i",{class:f(o.getIconForType(r.slug))},null,2)]),s("div",W,[s("h5",H,u(r.name),1),s("p",Y,u(r.description),1)]),e[4]||(e[4]=s("div",{class:"type-arrow"},[s("i",{class:"fa fa-chevron-right"})],-1))])],8,O))),128))])),!n.store.loading.ticketTypes&&n.store.ticketTypes.length===0?(l(),a("div",J,[...e[5]||(e[5]=[s("i",{class:"fa fa-folder-open fa-3x text-muted m-b-md"},null,-1),s("h5",{class:"text-white"},"No Options Available",-1),s("p",{class:"text-muted"},"There are no ticket types available for your role.",-1)])])):m("",!0)])}const z=v(F,[["render",Q],["__scopeId","data-v-f9975e2a"]]),G={data(){return{store:t}},methods:{submitTicket(){t.submitTicket().catch(()=>{})},cancel(){t.resetForm(),t.setView("select-type")},getIconForType(i){return{"forum-change":"fa fa-edit","awards-medals":"fa fa-trophy","member-rename":"fa fa-id-card","teamspeak-change":"fa fa-headphones",misc:"fa fa-question-circle"}[i]||"fa fa-tag"}}},K={class:"ticket-form"},X={class:"form-header"},Z={class:"type-icon"},$={class:"type-info"},ee={class:"type-name"},te={key:0,class:"boilerplate-card"},se={class:"boilerplate-content"},ie={key:1,class:"alert alert-danger"},ne={class:"form-group"},oe=["disabled"],re={class:"counter-current"},le={class:"form-actions"},ae=["disabled"],ce=["disabled"],de={key:0},ue={key:1};function me(i,e,d,k,n,o){return l(),a("div",K,[s("div",X,[s("div",Z,[s("i",{class:f(o.getIconForType(n.store.selectedType?.slug))},null,2)]),s("div",$,[e[3]||(e[3]=s("span",{class:"type-label"},"New Request",-1)),s("h4",ee,u(n.store.selectedType?.name),1)])]),n.store.selectedType?.boilerplate?(l(),a("div",te,[e[4]||(e[4]=s("div",{class:"boilerplate-header"},[s("i",{class:"fa fa-lightbulb-o m-r-sm"}),c(" Please include the following information ")],-1)),s("div",se,[s("pre",null,u(n.store.selectedType.boilerplate),1)])])):m("",!0),n.store.errors.submission?(l(),a("div",ie,[e[5]||(e[5]=s("i",{class:"fa fa-exclamation-triangle m-r-sm"},null,-1)),c(" "+u(n.store.errors.submission),1)])):m("",!0),s("form",{onSubmit:e[2]||(e[2]=b((...r)=>o.submitTicket&&o.submitTicket(...r),["prevent"]))},[s("div",ne,[e[8]||(e[8]=s("label",{for:"description",class:"form-label"},[s("i",{class:"fa fa-pencil-square-o m-r-sm"}),c(" Description ")],-1)),y(s("textarea",{id:"description","onUpdate:modelValue":e[0]||(e[0]=r=>n.store.newTicket.description=r),class:"form-control",rows:"10",placeholder:"Describe your issue or request in detail...",disabled:n.store.loading.submitting,required:"",minlength:"25"},null,8,oe),[[_,n.store.newTicket.description]]),s("div",{class:f(["char-counter",{"counter-valid":n.store.newTicket.description.length>=25}])},[s("span",re,u(n.store.newTicket.description.length),1),e[6]||(e[6]=s("span",{class:"counter-divider"},"/",-1)),e[7]||(e[7]=s("span",{class:"counter-min"},"25 minimum",-1))],2)]),s("div",le,[s("button",{type:"button",class:"btn btn-default",onClick:e[1]||(e[1]=(...r)=>o.cancel&&o.cancel(...r)),disabled:n.store.loading.submitting},[...e[9]||(e[9]=[s("i",{class:"fa fa-times m-r-xs"},null,-1),c(" Cancel ",-1)])],8,ae),s("button",{type:"submit",class:"btn btn-primary",disabled:n.store.loading.submitting||n.store.newTicket.description.length<25},[n.store.loading.submitting?(l(),a("span",de,[...e[10]||(e[10]=[s("span",{class:"themed-spinner spinner-sm"},null,-1),c(" Creating Ticket... ",-1)])])):(l(),a("span",ue,[...e[11]||(e[11]=[s("i",{class:"fa fa-paper-plane m-r-sm"},null,-1),c(" Submit Request ",-1)])]))],8,ce)])],32)])}const ke=v(G,[["render",me],["__scopeId","data-v-c73ad36e"]]),fe={data(){return{store:t}},computed:{isAdminView(){return t.viewMode==="admin"},isLoading(){return this.isAdminView?t.loading.adminTickets:t.loading.tickets},hasError(){return this.isAdminView?t.errors.adminTickets:t.errors.tickets},errorMessage(){return this.isAdminView?t.errors.adminTickets:t.errors.tickets},loadingMessage(){return this.isAdminView?"Loading admin queue...":"Loading your tickets..."},listTitle(){return this.isAdminView?"Admin Queue":"Your Tickets"},displayTickets(){return this.isAdminView?t.getFilteredAdminTickets():t.tickets}},methods:{viewTicket(i){t.setView("detail",i.id)},retry(){this.isAdminView?t.loadAdminTickets():t.loadTickets()},truncateDescription(i){return i?i.length>100?i.substring(0,100)+"...":i:""},formatStatus(i){return{new:"Open",assigned:"In Progress",resolved:"Resolved",rejected:"Closed"}[i]||i},getStatusIcon(i){return{new:"far fa-circle",assigned:"fa fa-spinner",resolved:"fa fa-check-circle",rejected:"fa fa-times-circle"}[i]||"fa fa-circle"},getStateColor(i){return{new:"info",assigned:"warning",resolved:"success",rejected:"danger"}[i]||"white"}}},pe={class:"ticket-list"},ge={key:0,class:"text-center p-lg"},ve={class:"m-t-md text-muted"},Te={key:1,class:"alert alert-danger"},ye={key:2,class:"text-center p-lg"},be={key:3},we={key:0,class:"admin-filters m-b-md"},he={class:"filter-row"},_e={class:"text-white m-b-md"},Ce={key:1,class:"text-center p-lg empty-results"},xe={key:2,class:"ticket-cards"},Se=["onClick"],Ie={class:"panel-body"},je={class:"ticket-main"},Me={class:"ticket-header-row"},Ae={class:"ticket-id"},Le={class:"ticket-type-badge"},Ve={class:"ticket-preview"},Re={class:"ticket-meta"},Pe={key:0,class:"meta-item"},Fe={key:1,class:"meta-item"},De={class:"meta-item meta-time"};function Ue(i,e,d,k,n,o){return l(),a("div",pe,[o.isLoading?(l(),a("div",ge,[e[4]||(e[4]=s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"sr-only"},"Loading...")],-1)),s("p",ve,u(o.loadingMessage),1)])):o.hasError?(l(),a("div",Te,[e[6]||(e[6]=s("i",{class:"fa fa-exclamation-circle m-r-sm"},null,-1)),c(" "+u(o.errorMessage)+" ",1),s("button",{class:"btn btn-sm btn-outline-danger pull-right",onClick:e[0]||(e[0]=(...r)=>o.retry&&o.retry(...r))},[...e[5]||(e[5]=[s("i",{class:"fa fa-refresh"},null,-1),c(" Retry ",-1)])])])):o.displayTickets.length===0&&!o.isAdminView?(l(),a("div",ye,[e[8]||(e[8]=s("div",{class:"empty-icon"},[s("i",{class:"fa fa-inbox"})],-1)),e[9]||(e[9]=s("h4",{class:"text-white"},"No Tickets Yet",-1)),e[10]||(e[10]=s("p",{class:"text-muted m-b-lg"},"You haven't submitted any support requests yet.",-1)),s("button",{class:"btn btn-primary",onClick:e[1]||(e[1]=r=>i.$parent.showTypeSelector())},[...e[7]||(e[7]=[s("i",{class:"fa fa-plus m-r-xs"},null,-1),c(" Create Your First Ticket ",-1)])])])):(l(),a("div",be,[o.isAdminView?(l(),a("div",we,[s("div",he,[y(s("select",{"onUpdate:modelValue":e[2]||(e[2]=r=>n.store.adminFilters.state=r),class:"form-control filter-select"},[...e[11]||(e[11]=[s("option",{value:null},"All States",-1),s("option",{value:"new"},"Open",-1),s("option",{value:"assigned"},"In Progress",-1),s("option",{value:"resolved"},"Resolved",-1),s("option",{value:"rejected"},"Rejected",-1)])],512),[[V,n.store.adminFilters.state]]),y(s("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>n.store.adminFilters.search=r),type:"text",class:"form-control filter-search",placeholder:"Search tickets..."},null,512),[[_,n.store.adminFilters.search]])])])):m("",!0),s("h5",_e,u(o.listTitle),1),o.displayTickets.length===0&&o.isAdminView?(l(),a("div",Ce,[...e[12]||(e[12]=[s("div",{class:"empty-icon"},[s("i",{class:"fa fa-filter"})],-1),s("h4",{class:"text-white"},"No Matching Tickets",-1),s("p",{class:"text-muted m-b-none"},"Try adjusting your filters above.",-1)])])):(l(),a("div",xe,[(l(!0),a(h,null,C(o.displayTickets,r=>(l(),a("a",{key:r.id,href:"#",class:f(["panel panel-filled ticket-card","panel-c-"+o.getStateColor(r.state)]),onClick:b(p=>o.viewTicket(r),["prevent"])},[s("div",Ie,[s("div",je,[s("div",Me,[s("span",Ae,"#"+u(r.id),1),s("span",Le,u(r.type?.name??"Unknown"),1)]),s("p",Ve,u(o.truncateDescription(r.description)),1),s("div",Re,[s("span",{class:f(["status-badge","badge-"+r.state])},[s("i",{class:f(o.getStatusIcon(r.state))},null,2),c(" "+u(o.formatStatus(r.state)),1)],2),o.isAdminView&&r.caller?(l(),a("span",Pe,[e[13]||(e[13]=s("i",{class:"fa fa-user text-muted m-r-xs"},null,-1)),c(" "+u(r.caller.name),1)])):m("",!0),r.owner?(l(),a("span",Fe,[e[14]||(e[14]=s("i",{class:"fa fa-user-circle text-muted m-r-xs"},null,-1)),c(" "+u(r.owner.name),1)])):m("",!0),s("span",De,[e[15]||(e[15]=s("i",{class:"fa fa-clock-o text-muted m-r-xs"},null,-1)),c(" "+u(n.store.formatRelativeDate(r.created_at)),1)])])]),e[16]||(e[16]=s("div",{class:"ticket-arrow"},[s("i",{class:"fa fa-chevron-right"})],-1))])],10,Se))),128))]))]))])}const Ee=v(fe,[["render",Ue],["__scopeId","data-v-1bdd81c6"]]),Ne=["owned the ticket","assigned the ticket to","resolved the ticket","reopened the ticket","rejected the ticket"],Oe={data(){return{store:t,showRejectModal:!1,rejectReason:""}},computed:{isResolved(){return t.currentTicket?.state==="resolved"||t.currentTicket?.state==="rejected"},sortedComments(){return t.currentTicket?.comments?[...t.currentTicket.comments].sort((i,e)=>new Date(i.created_at)-new Date(e.created_at)):[]},userCommentCount(){return t.currentTicket?.comments?t.currentTicket.comments.filter(i=>!this.isSystemMessage(i)).length:0},showAdminActions(){return t.canWorkTickets&&t.viewMode==="admin"},currentUserId(){return t.getCurrentUserId()},canAssign(){const i=t.currentTicket;return i?i.state==="new"||i.state==="assigned"&&i.owner?.id!==this.currentUserId:!1},canResolve(){const i=t.currentTicket;return i?i.state==="new"||i.state==="assigned":!1},canReject(){const i=t.currentTicket;return i?i.state==="new"||i.state==="assigned":!1},canReopen(){const i=t.currentTicket;return i?i.state==="resolved"||i.state==="rejected":!1}},methods:{reload(){t.selectedTicketId&&t.loadTicket(t.selectedTicketId)},submitComment(){t.submitComment().catch(()=>{})},assignToMe(){t.ownTicket(t.currentTicket.id).catch(()=>{})},resolveTicket(){t.resolveTicket(t.currentTicket.id).catch(()=>{})},rejectTicket(){t.rejectTicket(t.currentTicket.id,this.rejectReason).then(()=>{this.showRejectModal=!1,this.rejectReason=""}).catch(()=>{})},reopenTicket(){t.reopenTicket(t.currentTicket.id).catch(()=>{})},formatStatus(i){return{new:"Open",assigned:"In Progress",resolved:"Resolved",rejected:"Closed"}[i]||i},getStatusIcon(i){return{new:"far fa-circle",assigned:"fa fa-spinner",resolved:"fa fa-check-circle",rejected:"fa fa-times-circle"}[i]||"fa fa-circle"},isSystemMessage(i){const e=i.body.toLowerCase();return Ne.some(d=>e.includes(d))},getSystemIcon(i){const e=i.toLowerCase();return e.includes("resolved")?"fa fa-check-circle text-success":e.includes("rejected")?"fa fa-times-circle text-danger":e.includes("reopened")?"fa fa-undo text-warning":e.includes("owned")||e.includes("assigned")?"fa fa-user-plus text-info":"fa fa-info-circle text-muted"},formatSystemMessage(i){return i.toLowerCase()==="owned the ticket"?"took ownership of this ticket":i.toLowerCase()==="resolved the ticket"?"marked this ticket as resolved":i.toLowerCase()==="rejected the ticket"?"closed this ticket":i.toLowerCase()==="reopened the ticket"?"reopened this ticket":i.toLowerCase().includes("assigned the ticket to")?i.replace(/^.*?assigned the ticket to /i,"assigned this ticket to "):i},autolink(i){if(!i)return"";const e=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),d=/(https?:\/\/[^\s<]+)/g;return e.replace(d,'<a href="$1" target="_blank" rel="noopener noreferrer">$1</a>')}}},qe={class:"ticket-detail"},Be={key:0,class:"text-center p-lg"},We={key:1,class:"alert alert-danger"},He={key:2},Ye={class:"header-main"},Je={class:"header-top"},Qe={class:"ticket-number"},ze={class:"ticket-type"},Ge={class:"header-meta"},Ke={key:0,class:"meta-block"},Xe={class:"meta-value"},Ze={key:1,class:"meta-block"},$e={class:"meta-block"},et={class:"meta-value"},tt={key:0,class:"admin-actions m-b-md"},st={key:0,class:"alert alert-danger m-b-sm"},it={class:"action-buttons"},nt=["disabled"],ot=["disabled"],rt=["disabled"],lt=["disabled"],at={class:"reject-modal"},ct={class:"reject-modal-header"},dt={class:"reject-modal-body"},ut={class:"form-group"},mt={class:"reject-modal-footer"},kt=["disabled"],ft={key:0},pt={key:1},gt={class:"ticket-sections"},vt={class:"section-card"},Tt={class:"section-content"},yt=["innerHTML"],bt={class:"section-card"},wt={class:"section-header"},ht={class:"comment-count"},_t=["title"],Ct={class:"section-content"},xt={key:0,class:"text-center p-md"},St={key:1,class:"comments-timeline"},It={key:0,class:"system-event"},jt={class:"event-content"},Mt={class:"event-text"},At={class:"event-time"},Lt={class:"comment-bubble"},Vt={class:"comment-header"},Rt={class:"comment-author"},Pt={key:0,class:"admin-badge"},Ft={class:"comment-time"},Dt=["innerHTML"],Ut={key:2,class:"comment-form"},Et={key:0,class:"alert alert-danger m-b-md"},Nt={class:"form-group"},Ot=["disabled"],qt={class:"comment-actions"},Bt=["disabled"],Wt={key:0},Ht={key:1},Yt={key:3,class:"closed-notice"};function Jt(i,e,d,k,n,o){return l(),a("div",qe,[n.store.loading.ticket?(l(),a("div",Be,[...e[13]||(e[13]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"sr-only"},"Loading...")],-1),s("p",{class:"m-t-md text-muted"},"Loading ticket...",-1)])])):n.store.errors.ticket?(l(),a("div",We,[e[15]||(e[15]=s("i",{class:"fa fa-exclamation-circle m-r-sm"},null,-1)),c(" "+u(n.store.errors.ticket)+" ",1),s("button",{class:"btn btn-sm btn-outline-danger pull-right",onClick:e[0]||(e[0]=(...r)=>o.reload&&o.reload(...r))},[...e[14]||(e[14]=[s("i",{class:"fa fa-refresh"},null,-1),c(" Retry ",-1)])])])):n.store.currentTicket?(l(),a("div",He,[s("div",{class:f(["ticket-header","header-"+n.store.currentTicket.state])},[s("div",Ye,[s("div",Je,[s("span",Qe,"#"+u(n.store.currentTicket.id),1),s("span",{class:f(["status-pill","pill-"+n.store.currentTicket.state])},[s("i",{class:f(o.getStatusIcon(n.store.currentTicket.state))},null,2),c(" "+u(o.formatStatus(n.store.currentTicket.state)),1)],2)]),s("div",ze,u(n.store.currentTicket.type?.name??"Unknown Type"),1)]),s("div",Ge,[n.store.currentTicket.owner?(l(),a("div",Ke,[e[17]||(e[17]=s("div",{class:"meta-label"},"Assigned To",-1)),s("div",Xe,[e[16]||(e[16]=s("i",{class:"fa fa-user-circle m-r-xs"},null,-1)),c(" "+u(n.store.currentTicket.owner.name),1)])])):(l(),a("div",Ze,[...e[18]||(e[18]=[s("div",{class:"meta-label"},"Status",-1),s("div",{class:"meta-value text-muted"},[s("i",{class:"fa fa-hourglass-half m-r-xs"}),c(" Awaiting Assignment ")],-1)])])),s("div",$e,[e[19]||(e[19]=s("div",{class:"meta-label"},"Created",-1)),s("div",et,u(n.store.formatDate(n.store.currentTicket.created_at)),1)])])],2),o.showAdminActions?(l(),a("div",tt,[n.store.errors.action?(l(),a("div",st,[e[20]||(e[20]=s("i",{class:"fa fa-exclamation-circle m-r-xs"},null,-1)),c(" "+u(n.store.errors.action),1)])):m("",!0),s("div",it,[o.canAssign?(l(),a("button",{key:0,class:"btn btn-info btn-sm",disabled:n.store.loading.action,onClick:e[1]||(e[1]=(...r)=>o.assignToMe&&o.assignToMe(...r))},[...e[21]||(e[21]=[s("i",{class:"fa fa-hand-paper-o m-r-xs"},null,-1),c(" Assign to Me ",-1)])],8,nt)):m("",!0),o.canResolve?(l(),a("button",{key:1,class:"btn btn-success btn-sm",disabled:n.store.loading.action,onClick:e[2]||(e[2]=(...r)=>o.resolveTicket&&o.resolveTicket(...r))},[...e[22]||(e[22]=[s("i",{class:"fa fa-check m-r-xs"},null,-1),c(" Resolve ",-1)])],8,ot)):m("",!0),o.canReject?(l(),a("button",{key:2,class:"btn btn-danger btn-sm",disabled:n.store.loading.action,onClick:e[3]||(e[3]=r=>n.showRejectModal=!0)},[...e[23]||(e[23]=[s("i",{class:"fa fa-times m-r-xs"},null,-1),c(" Reject ",-1)])],8,rt)):m("",!0),o.canReopen?(l(),a("button",{key:3,class:"btn btn-warning btn-sm",disabled:n.store.loading.action,onClick:e[4]||(e[4]=(...r)=>o.reopenTicket&&o.reopenTicket(...r))},[...e[24]||(e[24]=[s("i",{class:"fa fa-undo m-r-xs"},null,-1),c(" Reopen ",-1)])],8,lt)):m("",!0)])])):m("",!0),n.showRejectModal?(l(),a("div",{key:1,class:"reject-modal-overlay",onClick:e[9]||(e[9]=b(r=>n.showRejectModal=!1,["self"]))},[s("div",at,[s("div",ct,[e[26]||(e[26]=s("h5",null,"Reject Ticket",-1)),s("button",{type:"button",class:"close-btn",onClick:e[5]||(e[5]=r=>n.showRejectModal=!1)},[...e[25]||(e[25]=[s("i",{class:"fa fa-times"},null,-1)])])]),s("div",dt,[s("div",ut,[e[27]||(e[27]=s("label",null,"Reason for rejection",-1)),y(s("textarea",{"onUpdate:modelValue":e[6]||(e[6]=r=>n.rejectReason=r),class:"form-control",rows:"3",placeholder:"Explain why this ticket is being rejected..."},null,512),[[_,n.rejectReason]])])]),s("div",mt,[s("button",{class:"btn btn-default btn-sm",onClick:e[7]||(e[7]=r=>n.showRejectModal=!1)},"Cancel"),s("button",{class:"btn btn-danger btn-sm",disabled:n.rejectReason.length<5||n.store.loading.action,onClick:e[8]||(e[8]=(...r)=>o.rejectTicket&&o.rejectTicket(...r))},[n.store.loading.action?(l(),a("span",ft,[...e[28]||(e[28]=[s("span",{class:"themed-spinner spinner-sm"},null,-1),c(" Rejecting... ",-1)])])):(l(),a("span",pt,"Reject Ticket"))],8,kt)])])])):m("",!0),s("div",gt,[s("div",vt,[e[29]||(e[29]=s("div",{class:"section-header"},[s("i",{class:"fa fa-file-text-o m-r-sm"}),c(" Description ")],-1)),s("div",Tt,[s("p",{class:"description-text",innerHTML:o.autolink(n.store.currentTicket.description)},null,8,yt)])]),s("div",bt,[s("div",wt,[e[30]||(e[30]=s("i",{class:"fa fa-comments-o m-r-sm"},null,-1)),e[31]||(e[31]=c(" Discussion ",-1)),s("span",ht,u(o.userCommentCount),1),s("button",{type:"button",class:f(["sound-toggle",{"sound-off":!n.store.soundEnabled}]),onClick:e[10]||(e[10]=r=>n.store.toggleSound()),title:n.store.soundEnabled?"Sound on - click to mute":"Sound off - click to unmute"},[s("i",{class:f(n.store.soundEnabled?"fa fa-volume-up":"fa fa-volume-off")},null,2)],10,_t)]),s("div",Ct,[!n.store.currentTicket.comments||n.store.currentTicket.comments.length===0?(l(),a("div",xt,[...e[32]||(e[32]=[s("i",{class:"fa fa-comment-o fa-2x text-muted m-b-sm"},null,-1),s("p",{class:"text-muted m-b-none"},"No comments yet",-1)])])):(l(),a("div",St,[(l(!0),a(h,null,C(o.sortedComments,r=>(l(),a(h,{key:r.id},[o.isSystemMessage(r)?(l(),a("div",It,[e[33]||(e[33]=s("div",{class:"event-line"},null,-1)),s("div",jt,[s("i",{class:f(o.getSystemIcon(r.body))},null,2),s("span",Mt,[s("strong",null,u(r.user?.name??"Unknown"),1),c(" "+u(o.formatSystemMessage(r.body)),1)]),s("span",At,u(n.store.formatRelativeDate(r.created_at)),1)])])):(l(),a("div",{key:1,class:f(["comment-item",{"comment-admin":r.user?.is_admin}])},[e[34]||(e[34]=s("div",{class:"comment-avatar"},[s("i",{class:"fa fa-user"})],-1)),s("div",Lt,[s("div",Vt,[s("span",Rt,[c(u(r.user?.name??"Unknown")+" ",1),r.user?.is_admin?(l(),a("span",Pt,"Admin")):m("",!0)]),s("span",Ft,u(n.store.formatRelativeDate(r.created_at)),1)]),s("div",{class:"comment-body",innerHTML:o.autolink(r.body)},null,8,Dt)])],2))],64))),128))])),o.isResolved?(l(),a("div",Yt,[e[39]||(e[39]=s("i",{class:"fa fa-lock m-r-sm"},null,-1)),c(" This ticket is "+u(n.store.currentTicket.state)+" and closed for further comments. ",1)])):(l(),a("div",Ut,[n.store.errors.comment?(l(),a("div",Et,[e[35]||(e[35]=s("i",{class:"fa fa-exclamation-circle m-r-xs"},null,-1)),c(" "+u(n.store.errors.comment),1)])):m("",!0),s("div",Nt,[y(s("textarea",{"onUpdate:modelValue":e[11]||(e[11]=r=>n.store.newComment=r),class:"form-control",rows:"3",placeholder:"Write a reply...",disabled:n.store.loading.commenting},null,8,Ot),[[_,n.store.newComment]])]),s("div",qt,[e[38]||(e[38]=s("small",{class:"text-muted"},"Minimum 5 characters",-1)),s("button",{type:"button",class:"btn btn-primary",disabled:n.store.loading.commenting||n.store.newComment.length<5,onClick:e[12]||(e[12]=(...r)=>o.submitComment&&o.submitComment(...r))},[n.store.loading.commenting?(l(),a("span",Wt,[...e[36]||(e[36]=[s("span",{class:"themed-spinner spinner-sm"},null,-1),c(" Sending... ",-1)])])):(l(),a("span",Ht,[...e[37]||(e[37]=[s("i",{class:"fa fa-paper-plane m-r-xs"},null,-1),c(" Send Reply ",-1)])]))],8,Bt)])]))])])])])):m("",!0)])}const Qt=v(Oe,[["render",Jt],["__scopeId","data-v-f6786c24"]]),zt={components:{TicketTypeSelect:z,TicketForm:ke,TicketList:Ee,TicketDetail:Qt},props:{inModal:{type:Boolean,default:!1}},data(){return{store:t}},computed:{displayTickets(){return t.viewMode==="admin"?t.adminTickets:t.tickets},openCount(){return this.displayTickets.filter(i=>i.state==="new").length},assignedCount(){return this.displayTickets.filter(i=>i.state==="assigned").length},resolvedCount(){return this.displayTickets.filter(i=>i.state==="resolved"||i.state==="rejected").length}},mounted(){this.inModal||(t.loadTickets(),t.loadTicketTypes())},methods:{showTypeSelector(){t.setView("select-type")}}},Gt={class:"ticket-widget"},Kt={key:0,class:"view-header"},Xt={class:"header-title"},Zt={class:"m-b-xs"},$t={key:1,class:"modal-actions m-b-md"},es={class:"actions-row"},ts={key:1,class:"view-toggle"},ss={key:2,class:"row quick-stats m-b-md"},is={class:"col-md-3 col-sm-6"},ns={class:"panel panel-filled"},os={class:"panel-body"},rs={class:"stat-content"},ls={class:"stat-value"},as={class:"col-md-3 col-sm-6"},cs={class:"panel panel-filled"},ds={class:"panel-body"},us={class:"stat-content"},ms={class:"stat-value"},ks={class:"col-md-3 col-sm-6"},fs={class:"panel panel-filled"},ps={class:"panel-body"},gs={class:"stat-content"},vs={class:"stat-value"},Ts={class:"col-md-3 col-sm-6"},ys={class:"panel panel-filled"},bs={class:"panel-body"},ws={class:"stat-content"},hs={class:"stat-value"},_s={class:"panel panel-filled"},Cs={class:"panel-body"};function xs(i,e,d,k,n,o){const r=T("ticket-type-select"),p=T("ticket-form"),M=T("ticket-list"),A=T("ticket-detail");return l(),a("div",Gt,[d.inModal?m("",!0):(l(),a("div",Kt,[e[10]||(e[10]=s("div",{class:"header-icon"},[s("i",{class:"pe pe-7s-help1"})],-1)),s("div",Xt,[s("h3",Zt,[e[8]||(e[8]=c(" Help Center ",-1)),n.store.currentView!=="list"?(l(),a("button",{key:0,class:"btn btn-default btn-sm pull-right",onClick:e[0]||(e[0]=g=>n.store.setView("list"))},[...e[6]||(e[6]=[s("i",{class:"fa fa-arrow-left"},null,-1),c(" Back ",-1)])])):(l(),a("button",{key:1,class:"btn btn-primary btn-sm pull-right",onClick:e[1]||(e[1]=(...g)=>o.showTypeSelector&&o.showTypeSelector(...g))},[...e[7]||(e[7]=[s("i",{class:"fa fa-plus"},null,-1),c(" New Ticket ",-1)])]))]),e[9]||(e[9]=s("small",{class:"slight"},"Submit and track your support requests",-1))]),e[11]||(e[11]=s("hr",null,null,-1))])),d.inModal?(l(),a("div",$t,[s("div",es,[n.store.currentView!=="list"?(l(),a("button",{key:0,class:"btn btn-default btn-sm",onClick:e[2]||(e[2]=g=>n.store.setView("list"))},[...e[12]||(e[12]=[s("i",{class:"fa fa-arrow-left"},null,-1),c(" Back ",-1)])])):n.store.canWorkTickets?(l(),a("div",ts,[s("div",{class:f(["toggle-track",{"admin-active":n.store.viewMode==="admin"}])},[e[15]||(e[15]=s("div",{class:"toggle-indicator"},null,-1)),s("button",{class:f(["toggle-btn",{active:n.store.viewMode==="user"}]),onClick:e[3]||(e[3]=g=>n.store.setViewMode("user"))},[...e[13]||(e[13]=[s("i",{class:"fa fa-user m-r-xs"},null,-1),s("span",{class:"toggle-label"},"My Tickets",-1)])],2),s("button",{class:f(["toggle-btn",{active:n.store.viewMode==="admin"}]),onClick:e[4]||(e[4]=g=>n.store.setViewMode("admin"))},[...e[14]||(e[14]=[s("i",{class:"fa fa-shield m-r-xs"},null,-1),s("span",{class:"toggle-label"},"Admin Queue",-1)])],2)],2)])):m("",!0),n.store.currentView==="list"&&n.store.viewMode==="user"?(l(),a("button",{key:2,class:"btn btn-primary btn-sm ml-auto",onClick:e[5]||(e[5]=(...g)=>o.showTypeSelector&&o.showTypeSelector(...g))},[...e[16]||(e[16]=[s("i",{class:"fa fa-plus"},null,-1),c(" New Ticket ",-1)])])):m("",!0)])])):m("",!0),n.store.currentView==="list"&&o.displayTickets.length>0?(l(),a("div",ss,[s("div",is,[s("div",ns,[s("div",os,[e[18]||(e[18]=s("div",{class:"stat-icon"},[s("i",{class:"fa fa-life-ring text-info"})],-1)),s("div",rs,[s("span",ls,u(o.displayTickets.length),1),e[17]||(e[17]=s("span",{class:"stat-label"},"Total",-1))])])])]),s("div",as,[s("div",cs,[s("div",ds,[e[20]||(e[20]=s("div",{class:"stat-icon"},[s("i",{class:"fa fa-envelope-open text-primary"})],-1)),s("div",us,[s("span",ms,u(o.openCount),1),e[19]||(e[19]=s("span",{class:"stat-label"},"Open",-1))])])])]),s("div",ks,[s("div",fs,[s("div",ps,[e[22]||(e[22]=s("div",{class:"stat-icon"},[s("i",{class:"fa fa-spinner text-warning"})],-1)),s("div",gs,[s("span",vs,u(o.assignedCount),1),e[21]||(e[21]=s("span",{class:"stat-label"},"In Progress",-1))])])])]),s("div",Ts,[s("div",ys,[s("div",bs,[e[24]||(e[24]=s("div",{class:"stat-icon"},[s("i",{class:"fa fa-check-circle text-success"})],-1)),s("div",ws,[s("span",hs,u(o.resolvedCount),1),e[23]||(e[23]=s("span",{class:"stat-label"},"Resolved",-1))])])])])])):m("",!0),s("div",_s,[s("div",Cs,[S(P,{name:"fade",mode:"out-in"},{default:R(()=>[n.store.currentView==="select-type"?(l(),w(r,{key:"select-type"})):n.store.currentView==="create"?(l(),w(p,{key:"create"})):n.store.currentView==="list"?(l(),w(M,{key:"list"})):n.store.currentView==="detail"?(l(),w(A,{key:"detail"})):m("",!0)]),_:1})])])])}const j=v(zt,[["render",xs],["__scopeId","data-v-f5964a2a"]]),Ss={components:{TicketWidget:j},data(){return{isOpen:!1}},mounted(){window.openTicketModal=this.open,window.openTicketModalWithTicket=this.openWithTicket,window.closeTicketModal=this.close,document.addEventListener("keydown",this.handleEscape),this.checkUrlForTicket()},beforeUnmount(){document.removeEventListener("keydown",this.handleEscape)},methods:{open(){this.isOpen=!0,document.body.classList.add("ticket-modal-open"),t.loadTickets().then(()=>{t.markAllSeen()}),t.loadTicketTypes()},openWithTicket(i){this.isOpen=!0,document.body.classList.add("ticket-modal-open"),t.loadTickets(),t.loadTicketTypes(),t.setView("detail",i)},close(){this.isOpen=!1,document.body.classList.remove("ticket-modal-open"),t.stopPolling(),t.markAllSeen(),this.clearUrlTicket()},handleEscape(i){i.key==="Escape"&&this.isOpen&&this.close()},checkUrlForTicket(){const e=new URLSearchParams(window.location.search).get("ticket");e&&this.openWithTicket(parseInt(e,10))},clearUrlTicket(){const i=new URL(window.location);i.searchParams.has("ticket")&&(i.searchParams.delete("ticket"),window.history.replaceState({},"",i))}}},Is={class:"ticket-modal"},js={class:"ticket-modal-header"},Ms={class:"ticket-modal-body"};function As(i,e,d,k,n,o){const r=T("ticket-widget");return l(),a("div",null,[n.isOpen?(l(),a("div",{key:0,class:"ticket-modal-overlay",onClick:e[1]||(e[1]=b((...p)=>o.close&&o.close(...p),["self"]))},[s("div",Is,[s("div",js,[e[3]||(e[3]=s("h4",null,[s("i",{class:"fa fa-life-ring m-r-sm"}),c(" Help Center ")],-1)),s("button",{class:"ticket-modal-close",onClick:e[0]||(e[0]=(...p)=>o.close&&o.close(...p))},[...e[2]||(e[2]=[s("i",{class:"fa fa-times"},null,-1)])])]),s("div",Ms,[S(r,{ref:"widget","in-modal":!0},null,512)])])])):m("",!0)])}const Ls=v(Ss,[["render",As],["__scopeId","data-v-0eb37bde"]]),Vs=document.getElementById("ticket-widget-container");Vs&&I(j).mount("#ticket-widget-container");const Rs=document.getElementById("ticket-modal-container");Rs&&(I(Ls).mount("#ticket-modal-container"),t.startUnreadPolling());
