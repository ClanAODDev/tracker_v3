var f=f||{};(function(a){f={initUnassigned:function(){var o=this;a(".organize-platoons-btn").on("click",function(){var t=a(this),n=a(".platoon-assignments-section").hasClass("organize-mode");n?(t.html('<i class="fa fa-arrows-alt"></i> Organize'),t.removeClass("btn-success").addClass("btn-accent"),a(".unassigned-organizer-members").slideUp(200),a(".platoon-assignments-section").removeClass("organize-mode")):(t.html('<i class="fa fa-check"></i> Done'),t.removeClass("btn-accent").addClass("btn-success"),a(".unassigned-organizer-members").slideDown(200),a(".platoon-assignments-section").addClass("organize-mode"),o.enablePlatoonDragDrop())}),a(".platoon").on("click",function(t){a(".platoon-assignments-section").hasClass("organize-mode")&&t.preventDefault()})},initScrollToOrganize:function(){a(document).on("click",".scroll-to-organize",function(o){var t=a("#platoons");t.length&&(o.preventDefault(),a("html, body").animate({scrollTop:t.offset().top-20},400,function(){var n=a(".organize-platoons-btn"),e=a(".platoon-assignments-section").hasClass("organize-mode");!e&&n.length&&n.trigger("click"),t.addClass("highlight-section"),setTimeout(function(){t.removeClass("highlight-section")},1500)}))})},enablePlatoonDragDrop:function(){a(".unassigned-platoon-member").data("ui-draggable")||(a(".unassigned-platoon-member").draggable({revert:!0,revertDuration:200,zIndex:1e3,cursor:"grabbing",helper:"clone",appendTo:"body"}),a(".platoon").droppable({hoverClass:"panel-c-success",drop:function(o,t){var n=a(this),e=window.Laravel.appPath,r=t.draggable.attr("data-member-id"),i=n.attr("data-platoon-id");a.ajax({type:"POST",url:e+"/members/"+r+"/assign-platoon",data:{platoon_id:i,_token:a("meta[name=csrf-token]").attr("content")},success:function(s){toastr.success("Member assigned to platoon!"),a(t.draggable).fadeOut(200,function(){a(this).remove(),a(".unassigned-platoon-member").length<1&&(a(".unassigned-organizer").slideUp(),a(".platoon-assignments-section").removeClass("organize-mode"))});var l=n.find(".platoon-stat-badge .fa-users").parent(),c=parseInt(l.text().trim())||0;l.html('<i class="fa fa-users"></i> '+(c+1))},error:function(){toastr.error("Failed to assign member to platoon")}})}}))},initApplicationsModal:function(){var o=this,t=a("#open-applications-modal");if(t.length){var n=t.data("url"),e=!1;t.on("click",function(i){i.preventDefault();var s=new URLSearchParams(window.location.search);s.set("applications","1"),window.history.replaceState(null,"","?"+s.toString()),a("#applicationsModal").modal("show")}),a("#applicationsModal").on("shown.bs.modal",function(){e||(o.loadApplications(n),e=!0)}),a("#applicationsModal").on("hidden.bs.modal",function(){var i=new URLSearchParams(window.location.search);i.delete("applications"),i.delete("application");var s=i.toString();window.history.replaceState(null,"",s?"?"+s:window.location.pathname)});var r=new URLSearchParams(window.location.search);(r.has("applications")||r.has("application"))&&a("#applicationsModal").modal("show")}},loadApplications:function(o){var t=a("#applications-loading"),n=a("#applications-content"),e=a("#applications-empty"),r=a("#applications-list"),i=a("#applications-detail");a.ajax({url:o,type:"GET",success:function(s){if(t.addClass("hidden"),!s.applications||!s.applications.length){e.removeClass("hidden");return}var l=s.applications,c=new URLSearchParams(window.location.search).get("application"),m=0;if(c){for(var u=0;u<l.length;u++)if(String(l[u].id)===String(c)){m=u;break}}l.forEach(function(d,p){r.append('<a href="#" class="list-group-item application-item'+(p===m?" active":"")+'" data-index="'+p+'"><strong>'+a("<span>").text(d.discord_username).html()+'</strong><span class="text-muted pull-right" style="font-size: 12px;">'+a("<span>").text(d.created_at).html()+"</span></a>");var g='<div class="panel panel-filled application-modal-detail'+(p!==m?" hidden":"")+'" data-index="'+p+'" style="border-radius: 8px;"><div class="panel-body"><div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid rgba(255,255,255,0.06);"><strong style="font-size: 16px;">'+a("<span>").text(d.discord_username).html()+'</strong><span class="text-muted" style="font-size: 12px;">'+a("<span>").text(d.created_at).html()+"</span></div>";d.responses.forEach(function(h){g+='<div style="margin-bottom: 14px;"><div class="text-muted" style="font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">'+a("<span>").text(h.label).html()+'</div><div style="margin-top: 2px;">'+a("<span>").text(h.value).html()+"</div></div>"}),g+="</div></div>",i.append(g)}),r.on("click",".application-item",function(d){d.preventDefault();var p=a(this).data("index");r.find(".application-item").removeClass("active"),a(this).addClass("active"),i.find(".application-modal-detail").addClass("hidden"),i.find('.application-modal-detail[data-index="'+p+'"]').removeClass("hidden")}),n.removeClass("hidden")},error:function(){t.html('<span class="text-danger"><i class="fa fa-exclamation-triangle"></i> Failed to load applications.</span>')}})},setup:function(){this.initAutocomplete(),this.initPromotionsChart(),this.initUnassigned(),this.initScrollToOrganize(),this.initApplicationsModal()},initPromotionsChart:function(){var o=document.getElementById("promotions-chart");if(!(!o||typeof Chart>"u")){var t=JSON.parse(o.dataset.values||"[]"),n=JSON.parse(o.dataset.labels||"[]");if(!(!t||!n||t.length===0)){var e=getComputedStyle(document.documentElement),r=[e.getPropertyValue("--color-muted").trim()||"#949ba2",e.getPropertyValue("--color-primary").trim()||"#0f83c9",e.getPropertyValue("--color-success").trim()||"#1bbf89",e.getPropertyValue("--color-accent").trim()||"#f7af3e",e.getPropertyValue("--color-info").trim()||"#56c0e0",e.getPropertyValue("--color-danger").trim()||"#db524b"],i=t.map(function(c,m){return r[m%r.length]}),s="rgba(255,255,255,0.04)",l=e.getPropertyValue("--color-text-light").trim()||"#949ba2";new Chart(o,{type:"bar",data:{labels:n,datasets:[{data:t,backgroundColor:i,borderWidth:0,barThickness:20}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{usePointStyle:!0,boxPadding:6,callbacks:{label:function(c){return c.parsed.x+" promotions"}}}},scales:{x:{beginAtZero:!0,grid:{color:s},ticks:{stepSize:1,color:l}},y:{grid:{display:!1},ticks:{color:l}}}}})}}},initAutocomplete:function(){a("#leader").bootcomplete({url:window.Laravel.appPath+"/search-member/",minLength:3,idField:!0,method:"POST",dataParams:{_token:a("meta[name=csrf-token]").attr("content")}})}}})(window.jQuery);function v(){var a=window.jQuery;if(!a||typeof a.fn.DataTable!="function"||typeof a.fn.bootcomplete!="function"){setTimeout(v,50);return}f.setup()}v();
