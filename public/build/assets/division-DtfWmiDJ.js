var d=d||{};(function(t){const p=t("meta[name=csrf-token]").attr("content");d={initUnassigned(){t(".organize-platoons-btn").on("click",n=>{const e=t(n.currentTarget);t(".platoon-assignments-section").hasClass("organize-mode")?(e.html('<i class="fa fa-arrows-alt"></i> Organize'),e.removeClass("btn-success").addClass("btn-accent"),t(".unassigned-organizer-members").slideUp(200),t(".platoon-assignments-section").removeClass("organize-mode")):(e.html('<i class="fa fa-check"></i> Done'),e.removeClass("btn-accent").addClass("btn-success"),t(".unassigned-organizer-members").slideDown(200),t(".platoon-assignments-section").addClass("organize-mode"),this.enablePlatoonDragDrop())}),t(".platoon").on("click",n=>{t(".platoon-assignments-section").hasClass("organize-mode")&&n.preventDefault()})},initScrollToOrganize(){t(document).on("click",".scroll-to-organize",n=>{const e=t("#platoons");e.length&&(n.preventDefault(),t("html, body").animate({scrollTop:e.offset().top-20},400,function(){const a=t(".organize-platoons-btn");!t(".platoon-assignments-section").hasClass("organize-mode")&&a.length&&a.trigger("click"),e.addClass("highlight-section"),setTimeout(()=>{e.removeClass("highlight-section")},1500)}))})},enablePlatoonDragDrop(){t(".unassigned-platoon-member").data("ui-draggable")||(t(".unassigned-platoon-member").draggable({revert:!0,revertDuration:200,zIndex:1e3,cursor:"grabbing",helper:"clone",appendTo:"body"}),t(".platoon").droppable({hoverClass:"panel-c-success",drop:function(n,e){const a=t(this),o=window.Laravel.appPath,i=e.draggable.attr("data-member-id"),l=a.attr("data-platoon-id"),c=t(e.draggable);t.ajax({type:"POST",url:`${o}/members/${i}/assign-platoon`,data:{platoon_id:l,_token:p},success:()=>{toastr.success("Member assigned to platoon!"),c.fadeOut(200,function(){t(this).remove(),t(".unassigned-platoon-member").length<1&&(t(".unassigned-organizer").slideUp(),t(".platoon-assignments-section").removeClass("organize-mode"))});const s=a.find(".platoon-stat-badge .fa-users").parent(),r=parseInt(s.text().trim())||0;s.html(`<i class="fa fa-users"></i> ${r+1}`)},error:()=>{toastr.error("Failed to assign member to platoon")}})}}))},initApplicationsModal(){const n=t("#open-applications-modal");if(!n.length)return;n.on("click",a=>{a.preventDefault();const o=new URLSearchParams(window.location.search);o.set("applications","1"),window.history.replaceState(null,"",`?${o.toString()}`),t("#applicationsModal").modal("show")}),t("#applicationsModal").on("hidden.bs.modal",()=>{const a=new URLSearchParams(window.location.search);a.delete("applications"),a.delete("application");const o=a.toString();window.history.replaceState(null,"",o?`?${o}`:window.location.pathname)});const e=new URLSearchParams(window.location.search);(e.has("applications")||e.has("application"))&&t("#applicationsModal").modal("show")},setup(){this.initAutocomplete(),this.initPromotionsChart(),this.initUnassigned(),this.initScrollToOrganize(),this.initApplicationsModal()},initPromotionsChart(){const n=document.getElementById("promotions-chart");if(!n||typeof Chart>"u")return;const e=JSON.parse(n.dataset.values||"[]"),a=JSON.parse(n.dataset.labels||"[]");if(!e||!a||e.length===0)return;const o=getComputedStyle(document.documentElement),i=[o.getPropertyValue("--color-muted").trim()||"#949ba2",o.getPropertyValue("--color-primary").trim()||"#0f83c9",o.getPropertyValue("--color-success").trim()||"#1bbf89",o.getPropertyValue("--color-accent").trim()||"#f7af3e",o.getPropertyValue("--color-info").trim()||"#56c0e0",o.getPropertyValue("--color-danger").trim()||"#db524b"],l=e.map((r,m)=>i[m%i.length]),c="rgba(255,255,255,0.04)",s=o.getPropertyValue("--color-text-light").trim()||"#949ba2";new Chart(n,{type:"bar",data:{labels:a,datasets:[{data:e,backgroundColor:l,borderWidth:0,barThickness:20}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{usePointStyle:!0,boxPadding:6,callbacks:{label:r=>`${r.parsed.x} promotions`}}},scales:{x:{beginAtZero:!0,grid:{color:c},ticks:{stepSize:1,color:s}},y:{grid:{display:!1},ticks:{color:s}}}}})},initAutocomplete(){t("#leader").bootcomplete({url:`${window.Laravel.appPath}/search-member/`,minLength:3,idField:!0,method:"POST",dataParams:{_token:p}})}}})(window.jQuery);function g(){const t=window.jQuery;if(!t||typeof t.fn.DataTable!="function"||typeof t.fn.bootcomplete!="function"){setTimeout(g,50);return}d.setup()}g();
