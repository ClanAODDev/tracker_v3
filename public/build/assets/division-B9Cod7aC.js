var l=l||{};(function(a){l={initUnassigned:function(){var e=this;a(".organize-platoons-btn").on("click",function(){var t=a(this),o=a(".platoon-assignments-section").hasClass("organize-mode");o?(t.html('<i class="fa fa-arrows-alt"></i> Organize'),t.removeClass("btn-success").addClass("btn-accent"),a(".unassigned-organizer-members").slideUp(200),a(".platoon-assignments-section").removeClass("organize-mode")):(t.html('<i class="fa fa-check"></i> Done'),t.removeClass("btn-accent").addClass("btn-success"),a(".unassigned-organizer-members").slideDown(200),a(".platoon-assignments-section").addClass("organize-mode"),e.enablePlatoonDragDrop())}),a(".platoon").on("click",function(t){a(".platoon-assignments-section").hasClass("organize-mode")&&t.preventDefault()})},initScrollToOrganize:function(){a(document).on("click",".scroll-to-organize",function(e){var t=a("#platoons");t.length&&(e.preventDefault(),a("html, body").animate({scrollTop:t.offset().top-20},400,function(){var o=a(".organize-platoons-btn"),n=a(".platoon-assignments-section").hasClass("organize-mode");!n&&o.length&&o.trigger("click"),t.addClass("highlight-section"),setTimeout(function(){t.removeClass("highlight-section")},1500)}))})},enablePlatoonDragDrop:function(){a(".unassigned-platoon-member").data("ui-draggable")||(a(".unassigned-platoon-member").draggable({revert:!0,revertDuration:200,zIndex:1e3,cursor:"grabbing",helper:"clone",appendTo:"body"}),a(".platoon").droppable({hoverClass:"panel-c-success",drop:function(e,t){var o=a(this),n=window.Laravel.appPath,r=t.draggable.attr("data-member-id"),i=o.attr("data-platoon-id");a.ajax({type:"POST",url:n+"/members/"+r+"/assign-platoon",data:{platoon_id:i,_token:a("meta[name=csrf-token]").attr("content")},success:function(s){toastr.success("Member assigned to platoon!"),a(t.draggable).fadeOut(200,function(){a(this).remove(),a(".unassigned-platoon-member").length<1&&(a(".unassigned-organizer").slideUp(),a(".platoon-assignments-section").removeClass("organize-mode"))});var d=o.find(".platoon-stat-badge .fa-users").parent(),c=parseInt(d.text().trim())||0;d.html('<i class="fa fa-users"></i> '+(c+1))},error:function(){toastr.error("Failed to assign member to platoon")}})}}))},setup:function(){this.initAutocomplete(),this.initSetup(),this.initUnassigned(),this.initScrollToOrganize(),this.initPopulationChart()},initPopulationChart:function(){var e=document.getElementById("population-chart");if(e){var t=e.getContext("2d"),o=JSON.parse(e.dataset.labels||"[]"),n=JSON.parse(e.dataset.population||"[]"),r=JSON.parse(e.dataset.voice||"[]");if(o.length!==0){Math.max(...n);var i=Math.min(...n);new Chart(t,{type:"line",data:{labels:o,datasets:[{label:"Members",data:n,borderColor:"#5bc0de",backgroundColor:"rgba(91, 192, 222, 0.1)",borderWidth:2,fill:!0,tension:.3,pointRadius:3,pointHoverRadius:6,pointBackgroundColor:"#5bc0de",pointBorderColor:"#fff",pointBorderWidth:2},{label:"Voice Active",data:r,borderColor:"#1bbf89",backgroundColor:"rgba(27, 191, 137, 0.1)",borderWidth:2,fill:!0,tension:.3,pointRadius:2,pointHoverRadius:5,pointBackgroundColor:"#1bbf89",pointBorderColor:"#fff",pointBorderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"index"},plugins:{legend:{display:!0,position:"top",align:"end",labels:{boxWidth:12,padding:15,color:"rgba(255, 255, 255, 0.7)",font:{size:11}}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"#fff",bodyColor:"#fff",padding:12,displayColors:!0,callbacks:{label:function(s){return s.dataset.label+": "+s.parsed.y}}}},scales:{x:{grid:{color:"rgba(255, 255, 255, 0.05)"},ticks:{color:"rgba(255, 255, 255, 0.5)",font:{size:10},maxRotation:45,minRotation:0}},y:{beginAtZero:!1,suggestedMin:i-Math.round(i*.1),grid:{color:"rgba(255, 255, 255, 0.05)"},ticks:{color:"rgba(255, 255, 255, 0.5)",font:{size:10}}}}}})}}},initSetup:function(){var e=a(".promotions-chart");e.length&&new Chart(e,{type:"doughnut",data:{datasets:[{data:e.data("values"),borderWidth:0,backgroundColor:["#949ba2","#0f83c9","#1bbf89","#f7af3e","#56c0e0","#db524b"]}],labels:e.data("labels")},options:{legend:{position:"bottom",labels:{boxWidth:5,fontColor:"#949ba2"},label:{fullWidth:!0}}}})},initAutocomplete:function(){a("#leader").bootcomplete({url:window.Laravel.appPath+"/search-member/",minLength:3,idField:!0,method:"POST",dataParams:{_token:a("meta[name=csrf-token]").attr("content")}})}}})(window.jQuery);l.setup();
