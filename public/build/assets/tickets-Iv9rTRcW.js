import{r as V,_ as g,c as r,o as l,b as t,a as f,d as c,t as d,F as _,g as h,f as T,n as m,w as C,v as x,j as y,e as S,p as M,l as b,T as E,m as I}from"./_plugin-vue_export-helper-BlWgqVok.js";import"./_commonjsHelpers-Cpj98o6Y.js";const w="ticket_last_seen",s=V({base_url:window.Laravel.appPath,currentView:"list",selectedTicketId:null,pollInterval:null,unreadPollInterval:null,soundEnabled:!0,unreadCount:0,loading:{tickets:!1,ticketTypes:!1,ticket:!1,submitting:!1,commenting:!1},errors:{tickets:null,ticketTypes:null,ticket:null,submission:null,comment:null},tickets:[],ticketTypes:[],selectedType:null,currentTicket:null,newTicket:{ticket_type_id:null,description:""},newComment:""});s.loadTickets=()=>(s.loading.tickets=!0,s.errors.tickets=null,axios.get(`${s.base_url}/api/tickets`).then(n=>{s.tickets=n.data.tickets||[],s.loading.tickets=!1}).catch(n=>{s.loading.tickets=!1,s.errors.tickets="Failed to load tickets. Please try again.",console.error("Tickets load error:",n)}));s.loadTicketTypes=()=>(s.loading.ticketTypes=!0,s.errors.ticketTypes=null,axios.get(`${s.base_url}/api/tickets/types`).then(n=>{s.ticketTypes=n.data.types||[],s.loading.ticketTypes=!1}).catch(n=>{s.loading.ticketTypes=!1,s.errors.ticketTypes="Failed to load ticket types. Please try again.",console.error("Ticket types load error:",n)}));s.loadTicket=n=>(s.loading.ticket=!0,s.errors.ticket=null,axios.get(`${s.base_url}/api/tickets/${n}`).then(e=>{s.currentTicket=e.data.ticket,s.loading.ticket=!1}).catch(e=>{s.loading.ticket=!1,s.errors.ticket="Failed to load ticket. Please try again.",console.error("Ticket load error:",e)}));s.submitTicket=()=>s.loading.submitting?Promise.reject("Already submitting"):!s.newTicket.ticket_type_id||!s.newTicket.description||s.newTicket.description.length<25?(s.errors.submission="Please fill in all required fields (description must be at least 25 characters).",Promise.reject("Validation failed")):(s.loading.submitting=!0,s.errors.submission=null,axios.post(`${s.base_url}/api/tickets`,{ticket_type_id:s.newTicket.ticket_type_id,description:s.newTicket.description}).then(n=>{s.loading.submitting=!1,s.tickets.unshift(n.data.ticket),s.currentTicket=n.data.ticket,s.resetForm(),s.setView("detail",n.data.ticket.id)}).catch(n=>{throw s.loading.submitting=!1,s.errors.submission=n.response?.data?.message||"Failed to create ticket. Please try again.",n}));s.submitComment=()=>s.loading.commenting||!s.currentTicket?Promise.reject("Cannot submit comment"):!s.newComment||s.newComment.length<5?(s.errors.comment="Comment must be at least 5 characters.",Promise.reject("Validation failed")):(s.loading.commenting=!0,s.errors.comment=null,axios.post(`${s.base_url}/api/tickets/${s.currentTicket.id}/comments`,{body:s.newComment}).then(n=>{s.loading.commenting=!1;const e=s.currentTicket.comments||[];e.push(n.data.comment),s.currentTicket.comments=[...e],s.newComment=""}).catch(n=>{throw s.loading.commenting=!1,s.errors.comment=n.response?.data?.message||"Failed to add comment. Please try again.",n}));s.setView=(n,e=null)=>{s.stopPolling(),s.currentView=n,n==="detail"&&e?(s.selectedTicketId=e,s.loadTicket(e),s.startPolling()):n==="create"&&e?s.selectType(e):n==="list"&&(s.currentTicket=null,s.selectedTicketId=null)};s.startPolling=()=>{s.stopPolling(),s.pollInterval=setInterval(()=>{s.selectedTicketId&&!s.loading.ticket&&s.refreshTicket()},3e4)};s.stopPolling=()=>{s.pollInterval&&(clearInterval(s.pollInterval),s.pollInterval=null)};s.refreshTicket=()=>{if(!s.selectedTicketId)return;const n=s.currentTicket?.comments?.length||0;axios.get(`${s.base_url}/api/tickets/${s.selectedTicketId}`).then(e=>{s.currentTicket&&e.data.ticket&&((e.data.ticket.comments?.length||0)>n&&s.playNotificationSound(),s.currentTicket.comments=e.data.ticket.comments,s.currentTicket.state=e.data.ticket.state,s.currentTicket.owner=e.data.ticket.owner)}).catch(()=>{})};s.playNotificationSound=()=>{if(s.soundEnabled)try{const n=new(window.AudioContext||window.webkitAudioContext),e=n.createOscillator(),u=n.createGain();e.connect(u),u.connect(n.destination),e.frequency.setValueAtTime(800,n.currentTime),e.frequency.setValueAtTime(600,n.currentTime+.1),u.gain.setValueAtTime(.3,n.currentTime),u.gain.exponentialRampToValueAtTime(.01,n.currentTime+.3),e.start(n.currentTime),e.stop(n.currentTime+.3)}catch{console.log("Could not play notification sound")}};s.toggleSound=()=>{s.soundEnabled=!s.soundEnabled};s.selectType=n=>{s.selectedType=n,s.newTicket.ticket_type_id=n.id,s.newTicket.description=""};s.resetForm=()=>{s.newTicket.ticket_type_id=null,s.newTicket.description="",s.selectedType=null,s.errors.submission=null};s.getStateColor=n=>({new:"info",assigned:"warning",resolved:"success",rejected:"danger"})[n]||"secondary";s.getStateBadgeClass=n=>`badge badge-${s.getStateColor(n)}`;s.formatDate=n=>n?new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"";s.formatRelativeDate=n=>{if(!n)return"";const e=new Date(n),p=new Date-e,i=Math.floor(p/6e4),a=Math.floor(p/36e5),o=Math.floor(p/864e5);return i<1?"just now":i<60?`${i}m ago`:a<24?`${a}h ago`:o<7?`${o}d ago`:s.formatDate(n)};s.getLastSeen=()=>{try{const n=localStorage.getItem(w);return n?JSON.parse(n):{}}catch{return{}}};s.setLastSeen=n=>{const e=s.getLastSeen();e[n]=new Date().toISOString();try{localStorage.setItem(w,JSON.stringify(e))}catch{}};s.markAllSeen=()=>{const n=s.getLastSeen();s.tickets.forEach(e=>{n[e.id]=new Date().toISOString()});try{localStorage.setItem(w,JSON.stringify(n))}catch{}s.unreadCount=0,s.updateBadge()};s.calculateUnreadCount=()=>{const n=s.getLastSeen();let e=0;s.tickets.forEach(u=>{if(u.state==="resolved"||u.state==="rejected")return;const p=n[u.id];if(!p)e++;else{const i=new Date(p);new Date(u.updated_at)>i&&e++}}),s.unreadCount=e,s.updateBadge()};s.updateBadge=()=>{document.querySelectorAll(".help-badge").forEach(e=>{s.unreadCount>0?(e.textContent=s.unreadCount>9?"9+":s.unreadCount,e.style.display="flex"):e.style.display="none"})};s.startUnreadPolling=()=>{s.checkUnread(),s.unreadPollInterval=setInterval(()=>{s.checkUnread()},6e4)};s.stopUnreadPolling=()=>{s.unreadPollInterval&&(clearInterval(s.unreadPollInterval),s.unreadPollInterval=null)};s.checkUnread=()=>{axios.get(`${s.base_url}/api/tickets`).then(n=>{s.tickets=n.data.tickets||[],s.calculateUnreadCount()}).catch(()=>{})};const $={data(){return{store:s}},methods:{selectType(n){s.setView("create",n)},getIconForType(n){return{"forum-change":"fa fa-edit","awards-medals":"fa fa-trophy","member-rename":"fa fa-id-card","teamspeak-change":"fa fa-headphones",misc:"fa fa-question-circle"}[n]||"fa fa-tag"}}},A={class:"ticket-type-select"},j={key:0,class:"text-center p-lg"},N={key:1,class:"alert alert-danger"},R={key:2,class:"type-list"},F=["onClick"],q={class:"panel-body"},O={class:"type-icon"},B={class:"type-content"},U={class:"type-name"},H={class:"type-description"},Y={key:3,class:"text-center p-lg"};function J(n,e,u,p,i,a){return l(),r("div",A,[e[6]||(e[6]=t("div",{class:"text-center m-b-lg"},[t("h4",{class:"text-white"},"What do you need help with?"),t("p",{class:"text-muted"},"Select the category that best describes your request")],-1)),i.store.loading.ticketTypes?(l(),r("div",j,[...e[1]||(e[1]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"sr-only"},"Loading...")],-1),t("p",{class:"m-t-md text-muted"},"Loading options...",-1)])])):i.store.errors.ticketTypes?(l(),r("div",N,[e[3]||(e[3]=t("i",{class:"fa fa-exclamation-circle m-r-sm"},null,-1)),c(" "+d(i.store.errors.ticketTypes)+" ",1),t("button",{class:"btn btn-sm btn-outline-danger pull-right",onClick:e[0]||(e[0]=o=>i.store.loadTicketTypes())},[...e[2]||(e[2]=[t("i",{class:"fa fa-refresh"},null,-1),c(" Retry ",-1)])])])):(l(),r("div",R,[(l(!0),r(_,null,h(i.store.ticketTypes,o=>(l(),r("a",{key:o.id,href:"#",class:"panel panel-filled type-card",onClick:T(k=>a.selectType(o),["prevent"])},[t("div",q,[t("div",O,[t("i",{class:m(a.getIconForType(o.slug))},null,2)]),t("div",B,[t("h5",U,d(o.name),1),t("p",H,d(o.description),1)]),e[4]||(e[4]=t("div",{class:"type-arrow"},[t("i",{class:"fa fa-chevron-right"})],-1))])],8,F))),128))])),!i.store.loading.ticketTypes&&i.store.ticketTypes.length===0?(l(),r("div",Y,[...e[5]||(e[5]=[t("i",{class:"fa fa-folder-open fa-3x text-muted m-b-md"},null,-1),t("h5",{class:"text-white"},"No Options Available",-1),t("p",{class:"text-muted"},"There are no ticket types available for your role.",-1)])])):f("",!0)])}const W=g($,[["render",J],["__scopeId","data-v-f9975e2a"]]),z={data(){return{store:s}},methods:{submitTicket(){s.submitTicket().catch(()=>{})},cancel(){s.resetForm(),s.setView("select-type")},getIconForType(n){return{"forum-change":"fa fa-edit","awards-medals":"fa fa-trophy","member-rename":"fa fa-id-card","teamspeak-change":"fa fa-headphones",misc:"fa fa-question-circle"}[n]||"fa fa-tag"}}},G={class:"ticket-form"},K={class:"form-header"},Q={class:"type-icon"},X={class:"type-info"},Z={class:"type-name"},ee={key:0,class:"boilerplate-card"},te={class:"boilerplate-content"},se={key:1,class:"alert alert-danger"},ne={class:"form-group"},ie=["placeholder","disabled"],oe={class:"counter-current"},le={class:"form-actions"},re=["disabled"],ae=["disabled"],ce={key:0},de={key:1};function ue(n,e,u,p,i,a){return l(),r("div",G,[t("div",K,[t("div",Q,[t("i",{class:m(a.getIconForType(i.store.selectedType?.slug))},null,2)]),t("div",X,[e[3]||(e[3]=t("span",{class:"type-label"},"New Request",-1)),t("h4",Z,d(i.store.selectedType?.name),1)])]),i.store.selectedType?.boilerplate?(l(),r("div",ee,[e[4]||(e[4]=t("div",{class:"boilerplate-header"},[t("i",{class:"fa fa-lightbulb-o m-r-sm"}),c(" Please include the following information ")],-1)),t("div",te,[t("pre",null,d(i.store.selectedType.boilerplate),1)])])):f("",!0),i.store.errors.submission?(l(),r("div",se,[e[5]||(e[5]=t("i",{class:"fa fa-exclamation-triangle m-r-sm"},null,-1)),c(" "+d(i.store.errors.submission),1)])):f("",!0),t("form",{onSubmit:e[2]||(e[2]=T((...o)=>a.submitTicket&&a.submitTicket(...o),["prevent"]))},[t("div",ne,[e[8]||(e[8]=t("label",{for:"description",class:"form-label"},[t("i",{class:"fa fa-pencil-square-o m-r-sm"}),c(" Description ")],-1)),C(t("textarea",{id:"description","onUpdate:modelValue":e[0]||(e[0]=o=>i.store.newTicket.description=o),class:"form-control",rows:"10",placeholder:i.store.selectedType?.boilerplate||"Describe your issue or request in detail...",disabled:i.store.loading.submitting,required:"",minlength:"25"},null,8,ie),[[x,i.store.newTicket.description]]),t("div",{class:m(["char-counter",{"counter-valid":i.store.newTicket.description.length>=25}])},[t("span",oe,d(i.store.newTicket.description.length),1),e[6]||(e[6]=t("span",{class:"counter-divider"},"/",-1)),e[7]||(e[7]=t("span",{class:"counter-min"},"25 minimum",-1))],2)]),t("div",le,[t("button",{type:"button",class:"btn btn-default",onClick:e[1]||(e[1]=(...o)=>a.cancel&&a.cancel(...o)),disabled:i.store.loading.submitting},[...e[9]||(e[9]=[t("i",{class:"fa fa-times m-r-xs"},null,-1),c(" Cancel ",-1)])],8,re),t("button",{type:"submit",class:"btn btn-primary",disabled:i.store.loading.submitting||i.store.newTicket.description.length<25},[i.store.loading.submitting?(l(),r("span",ce,[...e[10]||(e[10]=[t("span",{class:"themed-spinner spinner-sm"},null,-1),c(" Creating Ticket... ",-1)])])):(l(),r("span",de,[...e[11]||(e[11]=[t("i",{class:"fa fa-paper-plane m-r-sm"},null,-1),c(" Submit Request ",-1)])]))],8,ae)])],32)])}const me=g(z,[["render",ue],["__scopeId","data-v-e4263edb"]]),pe={data(){return{store:s}},methods:{viewTicket(n){s.setView("detail",n.id)},truncateDescription(n){return n?n.length>100?n.substring(0,100)+"...":n:""},formatStatus(n){return{new:"Open",assigned:"In Progress",resolved:"Resolved",rejected:"Closed"}[n]||n},getStatusIcon(n){return{new:"far fa-circle",assigned:"fa fa-spinner",resolved:"fa fa-check-circle",rejected:"fa fa-times-circle"}[n]||"fa fa-circle"},getStateColor(n){return{new:"info",assigned:"warning",resolved:"success",rejected:"danger"}[n]||"white"}}},fe={class:"ticket-list"},ke={key:0,class:"text-center p-lg"},ge={key:1,class:"alert alert-danger"},ve={key:2,class:"text-center p-lg"},ye={key:3},be={class:"ticket-cards"},_e=["onClick"],Te={class:"panel-body"},he={class:"ticket-main"},we={class:"ticket-header-row"},Ce={class:"ticket-id"},xe={class:"ticket-type-badge"},Se={class:"ticket-preview"},Ie={class:"ticket-meta"},Le={key:0,class:"meta-item"},De={class:"meta-item meta-time"};function Pe(n,e,u,p,i,a){return l(),r("div",fe,[i.store.loading.tickets?(l(),r("div",ke,[...e[2]||(e[2]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"sr-only"},"Loading...")],-1),t("p",{class:"m-t-md text-muted"},"Loading your tickets...",-1)])])):i.store.errors.tickets?(l(),r("div",ge,[e[4]||(e[4]=t("i",{class:"fa fa-exclamation-circle m-r-sm"},null,-1)),c(" "+d(i.store.errors.tickets)+" ",1),t("button",{class:"btn btn-sm btn-outline-danger pull-right",onClick:e[0]||(e[0]=o=>i.store.loadTickets())},[...e[3]||(e[3]=[t("i",{class:"fa fa-refresh"},null,-1),c(" Retry ",-1)])])])):i.store.tickets.length===0?(l(),r("div",ve,[e[6]||(e[6]=t("div",{class:"empty-icon"},[t("i",{class:"fa fa-inbox"})],-1)),e[7]||(e[7]=t("h4",{class:"text-white"},"No Tickets Yet",-1)),e[8]||(e[8]=t("p",{class:"text-muted m-b-lg"},"You haven't submitted any support requests yet.",-1)),t("button",{class:"btn btn-primary",onClick:e[1]||(e[1]=o=>n.$parent.showTypeSelector())},[...e[5]||(e[5]=[t("i",{class:"fa fa-plus m-r-xs"},null,-1),c(" Create Your First Ticket ",-1)])])])):(l(),r("div",ye,[e[12]||(e[12]=t("h5",{class:"text-white m-b-md"},"Your Tickets",-1)),t("div",be,[(l(!0),r(_,null,h(i.store.tickets,o=>(l(),r("a",{key:o.id,href:"#",class:m(["panel panel-filled ticket-card","panel-c-"+a.getStateColor(o.state)]),onClick:T(k=>a.viewTicket(o),["prevent"])},[t("div",Te,[t("div",he,[t("div",we,[t("span",Ce,"#"+d(o.id),1),t("span",xe,d(o.type.name),1)]),t("p",Se,d(a.truncateDescription(o.description)),1),t("div",Ie,[t("span",{class:m(["status-badge","badge-"+o.state])},[t("i",{class:m(a.getStatusIcon(o.state))},null,2),c(" "+d(a.formatStatus(o.state)),1)],2),o.owner?(l(),r("span",Le,[e[9]||(e[9]=t("i",{class:"fa fa-user-circle text-muted m-r-xs"},null,-1)),c(" "+d(o.owner.name),1)])):f("",!0),t("span",De,[e[10]||(e[10]=t("i",{class:"fa fa-clock-o text-muted m-r-xs"},null,-1)),c(" "+d(i.store.formatRelativeDate(o.created_at)),1)])])]),e[11]||(e[11]=t("div",{class:"ticket-arrow"},[t("i",{class:"fa fa-chevron-right"})],-1))])],10,_e))),128))])]))])}const Ve=g(pe,[["render",Pe],["__scopeId","data-v-1a0fb5a9"]]),Me=["owned the ticket","assigned the ticket to","resolved the ticket","reopened the ticket","rejected the ticket"],Ee={data(){return{store:s}},computed:{isResolved(){return s.currentTicket?.state==="resolved"||s.currentTicket?.state==="rejected"},sortedComments(){return s.currentTicket?.comments?[...s.currentTicket.comments].sort((n,e)=>new Date(n.created_at)-new Date(e.created_at)):[]},userCommentCount(){return s.currentTicket?.comments?s.currentTicket.comments.filter(n=>!this.isSystemMessage(n)).length:0}},methods:{reload(){s.selectedTicketId&&s.loadTicket(s.selectedTicketId)},submitComment(){s.submitComment().catch(()=>{})},formatStatus(n){return{new:"Open",assigned:"In Progress",resolved:"Resolved",rejected:"Closed"}[n]||n},getStatusIcon(n){return{new:"far fa-circle",assigned:"fa fa-spinner",resolved:"fa fa-check-circle",rejected:"fa fa-times-circle"}[n]||"fa fa-circle"},isSystemMessage(n){const e=n.body.toLowerCase();return Me.some(u=>e.includes(u))},getSystemIcon(n){const e=n.toLowerCase();return e.includes("resolved")?"fa fa-check-circle text-success":e.includes("rejected")?"fa fa-times-circle text-danger":e.includes("reopened")?"fa fa-undo text-warning":e.includes("owned")||e.includes("assigned")?"fa fa-user-plus text-info":"fa fa-info-circle text-muted"},formatSystemMessage(n){return n.toLowerCase()==="owned the ticket"?"took ownership of this ticket":n.toLowerCase()==="resolved the ticket"?"marked this ticket as resolved":n.toLowerCase()==="rejected the ticket"?"closed this ticket":n.toLowerCase()==="reopened the ticket"?"reopened this ticket":n.toLowerCase().includes("assigned the ticket to")?n.replace(/^.*?assigned the ticket to /i,"assigned this ticket to "):n},autolink(n){if(!n)return"";const e=n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),u=/(https?:\/\/[^\s<]+)/g;return e.replace(u,'<a href="$1" target="_blank" rel="noopener noreferrer">$1</a>')}}},$e={class:"ticket-detail"},Ae={key:0,class:"text-center p-lg"},je={key:1,class:"alert alert-danger"},Ne={key:2},Re={class:"header-main"},Fe={class:"header-top"},qe={class:"ticket-number"},Oe={class:"ticket-type"},Be={class:"header-meta"},Ue={key:0,class:"meta-block"},He={class:"meta-value"},Ye={key:1,class:"meta-block"},Je={class:"meta-block"},We={class:"meta-value"},ze={class:"ticket-sections"},Ge={class:"section-card"},Ke={class:"section-content"},Qe=["innerHTML"],Xe={class:"section-card"},Ze={class:"section-header"},et={class:"comment-count"},tt=["title"],st={class:"section-content"},nt={key:0,class:"text-center p-md"},it={key:1,class:"comments-timeline"},ot={key:0,class:"system-event"},lt={class:"event-content"},rt={class:"event-text"},at={class:"event-time"},ct={class:"comment-bubble"},dt={class:"comment-header"},ut={class:"comment-author"},mt={key:0,class:"admin-badge"},pt={class:"comment-time"},ft=["innerHTML"],kt={key:2,class:"comment-form"},gt={key:0,class:"alert alert-danger m-b-md"},vt={class:"form-group"},yt=["disabled"],bt={class:"comment-actions"},_t=["disabled"],Tt={key:0},ht={key:1},wt={key:3,class:"closed-notice"};function Ct(n,e,u,p,i,a){return l(),r("div",$e,[i.store.loading.ticket?(l(),r("div",Ae,[...e[4]||(e[4]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"sr-only"},"Loading...")],-1),t("p",{class:"m-t-md text-muted"},"Loading ticket...",-1)])])):i.store.errors.ticket?(l(),r("div",je,[e[6]||(e[6]=t("i",{class:"fa fa-exclamation-circle m-r-sm"},null,-1)),c(" "+d(i.store.errors.ticket)+" ",1),t("button",{class:"btn btn-sm btn-outline-danger pull-right",onClick:e[0]||(e[0]=(...o)=>a.reload&&a.reload(...o))},[...e[5]||(e[5]=[t("i",{class:"fa fa-refresh"},null,-1),c(" Retry ",-1)])])])):i.store.currentTicket?(l(),r("div",Ne,[t("div",{class:m(["ticket-header","header-"+i.store.currentTicket.state])},[t("div",Re,[t("div",Fe,[t("span",qe,"#"+d(i.store.currentTicket.id),1),t("span",{class:m(["status-pill","pill-"+i.store.currentTicket.state])},[t("i",{class:m(a.getStatusIcon(i.store.currentTicket.state))},null,2),c(" "+d(a.formatStatus(i.store.currentTicket.state)),1)],2)]),t("div",Oe,d(i.store.currentTicket.type.name),1)]),t("div",Be,[i.store.currentTicket.owner?(l(),r("div",Ue,[e[8]||(e[8]=t("div",{class:"meta-label"},"Assigned To",-1)),t("div",He,[e[7]||(e[7]=t("i",{class:"fa fa-user-circle m-r-xs"},null,-1)),c(" "+d(i.store.currentTicket.owner.name),1)])])):(l(),r("div",Ye,[...e[9]||(e[9]=[t("div",{class:"meta-label"},"Status",-1),t("div",{class:"meta-value text-muted"},[t("i",{class:"fa fa-hourglass-half m-r-xs"}),c(" Awaiting Assignment ")],-1)])])),t("div",Je,[e[10]||(e[10]=t("div",{class:"meta-label"},"Created",-1)),t("div",We,d(i.store.formatDate(i.store.currentTicket.created_at)),1)])])],2),t("div",ze,[t("div",Ge,[e[11]||(e[11]=t("div",{class:"section-header"},[t("i",{class:"fa fa-file-text-o m-r-sm"}),c(" Description ")],-1)),t("div",Ke,[t("p",{class:"description-text",innerHTML:a.autolink(i.store.currentTicket.description)},null,8,Qe)])]),t("div",Xe,[t("div",Ze,[e[12]||(e[12]=t("i",{class:"fa fa-comments-o m-r-sm"},null,-1)),e[13]||(e[13]=c(" Discussion ",-1)),t("span",et,d(a.userCommentCount),1),t("button",{type:"button",class:m(["sound-toggle",{"sound-off":!i.store.soundEnabled}]),onClick:e[1]||(e[1]=o=>i.store.toggleSound()),title:i.store.soundEnabled?"Sound on - click to mute":"Sound off - click to unmute"},[t("i",{class:m(i.store.soundEnabled?"fa fa-volume-up":"fa fa-volume-off")},null,2)],10,tt)]),t("div",st,[!i.store.currentTicket.comments||i.store.currentTicket.comments.length===0?(l(),r("div",nt,[...e[14]||(e[14]=[t("i",{class:"fa fa-comment-o fa-2x text-muted m-b-sm"},null,-1),t("p",{class:"text-muted m-b-none"},"No comments yet",-1)])])):(l(),r("div",it,[(l(!0),r(_,null,h(a.sortedComments,o=>(l(),r(_,{key:o.id},[a.isSystemMessage(o)?(l(),r("div",ot,[e[15]||(e[15]=t("div",{class:"event-line"},null,-1)),t("div",lt,[t("i",{class:m(a.getSystemIcon(o.body))},null,2),t("span",rt,[t("strong",null,d(o.user.name),1),c(" "+d(a.formatSystemMessage(o.body)),1)]),t("span",at,d(i.store.formatRelativeDate(o.created_at)),1)])])):(l(),r("div",{key:1,class:m(["comment-item",{"comment-admin":o.user.is_admin}])},[e[16]||(e[16]=t("div",{class:"comment-avatar"},[t("i",{class:"fa fa-user"})],-1)),t("div",ct,[t("div",dt,[t("span",ut,[c(d(o.user.name)+" ",1),o.user.is_admin?(l(),r("span",mt,"Admin")):f("",!0)]),t("span",pt,d(i.store.formatRelativeDate(o.created_at)),1)]),t("div",{class:"comment-body",innerHTML:a.autolink(o.body)},null,8,ft)])],2))],64))),128))])),a.isResolved?(l(),r("div",wt,[e[21]||(e[21]=t("i",{class:"fa fa-lock m-r-sm"},null,-1)),c(" This ticket is "+d(i.store.currentTicket.state)+" and closed for further comments. ",1)])):(l(),r("div",kt,[i.store.errors.comment?(l(),r("div",gt,[e[17]||(e[17]=t("i",{class:"fa fa-exclamation-circle m-r-xs"},null,-1)),c(" "+d(i.store.errors.comment),1)])):f("",!0),t("div",vt,[C(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=o=>i.store.newComment=o),class:"form-control",rows:"3",placeholder:"Write a reply...",disabled:i.store.loading.commenting},null,8,yt),[[x,i.store.newComment]])]),t("div",bt,[e[20]||(e[20]=t("small",{class:"text-muted"},"Minimum 5 characters",-1)),t("button",{type:"button",class:"btn btn-primary",disabled:i.store.loading.commenting||i.store.newComment.length<5,onClick:e[3]||(e[3]=(...o)=>a.submitComment&&a.submitComment(...o))},[i.store.loading.commenting?(l(),r("span",Tt,[...e[18]||(e[18]=[t("span",{class:"themed-spinner spinner-sm"},null,-1),c(" Sending... ",-1)])])):(l(),r("span",ht,[...e[19]||(e[19]=[t("i",{class:"fa fa-paper-plane m-r-xs"},null,-1),c(" Send Reply ",-1)])]))],8,_t)])]))])])])])):f("",!0)])}const xt=g(Ee,[["render",Ct],["__scopeId","data-v-82bed888"]]),St={components:{TicketTypeSelect:W,TicketForm:me,TicketList:Ve,TicketDetail:xt},props:{inModal:{type:Boolean,default:!1}},data(){return{store:s}},computed:{openCount(){return s.tickets.filter(n=>n.state==="new").length},assignedCount(){return s.tickets.filter(n=>n.state==="assigned").length},resolvedCount(){return s.tickets.filter(n=>n.state==="resolved"||n.state==="rejected").length}},mounted(){this.inModal||(s.loadTickets(),s.loadTicketTypes())},methods:{showTypeSelector(){s.setView("select-type")}}},It={class:"ticket-widget"},Lt={key:0,class:"view-header"},Dt={class:"header-title"},Pt={class:"m-b-xs"},Vt={key:1,class:"modal-actions m-b-md"},Mt={key:2,class:"row quick-stats m-b-md"},Et={class:"col-md-3 col-sm-6"},$t={class:"panel panel-filled"},At={class:"panel-body"},jt={class:"stat-content"},Nt={class:"stat-value"},Rt={class:"col-md-3 col-sm-6"},Ft={class:"panel panel-filled"},qt={class:"panel-body"},Ot={class:"stat-content"},Bt={class:"stat-value"},Ut={class:"col-md-3 col-sm-6"},Ht={class:"panel panel-filled"},Yt={class:"panel-body"},Jt={class:"stat-content"},Wt={class:"stat-value"},zt={class:"col-md-3 col-sm-6"},Gt={class:"panel panel-filled"},Kt={class:"panel-body"},Qt={class:"stat-content"},Xt={class:"stat-value"},Zt={class:"panel panel-filled"},es={class:"panel-body"};function ts(n,e,u,p,i,a){const o=y("ticket-type-select"),k=y("ticket-form"),D=y("ticket-list"),P=y("ticket-detail");return l(),r("div",It,[u.inModal?f("",!0):(l(),r("div",Lt,[e[8]||(e[8]=t("div",{class:"header-icon"},[t("i",{class:"pe pe-7s-help1"})],-1)),t("div",Dt,[t("h3",Pt,[e[6]||(e[6]=c(" Help Center ",-1)),i.store.currentView!=="list"?(l(),r("button",{key:0,class:"btn btn-default btn-sm pull-right",onClick:e[0]||(e[0]=v=>i.store.setView("list"))},[...e[4]||(e[4]=[t("i",{class:"fa fa-arrow-left"},null,-1),c(" Back ",-1)])])):(l(),r("button",{key:1,class:"btn btn-primary btn-sm pull-right",onClick:e[1]||(e[1]=(...v)=>a.showTypeSelector&&a.showTypeSelector(...v))},[...e[5]||(e[5]=[t("i",{class:"fa fa-plus"},null,-1),c(" New Ticket ",-1)])]))]),e[7]||(e[7]=t("small",{class:"slight"},"Submit and track your support requests",-1))]),e[9]||(e[9]=t("hr",null,null,-1))])),u.inModal?(l(),r("div",Vt,[i.store.currentView!=="list"?(l(),r("button",{key:0,class:"btn btn-default btn-sm",onClick:e[2]||(e[2]=v=>i.store.setView("list"))},[...e[10]||(e[10]=[t("i",{class:"fa fa-arrow-left"},null,-1),c(" Back ",-1)])])):(l(),r("button",{key:1,class:"btn btn-primary btn-sm",onClick:e[3]||(e[3]=(...v)=>a.showTypeSelector&&a.showTypeSelector(...v))},[...e[11]||(e[11]=[t("i",{class:"fa fa-plus"},null,-1),c(" New Ticket ",-1)])]))])):f("",!0),i.store.currentView==="list"&&i.store.tickets.length>0?(l(),r("div",Mt,[t("div",Et,[t("div",$t,[t("div",At,[e[13]||(e[13]=t("div",{class:"stat-icon"},[t("i",{class:"fa fa-life-ring text-info"})],-1)),t("div",jt,[t("span",Nt,d(i.store.tickets.length),1),e[12]||(e[12]=t("span",{class:"stat-label"},"Total",-1))])])])]),t("div",Rt,[t("div",Ft,[t("div",qt,[e[15]||(e[15]=t("div",{class:"stat-icon"},[t("i",{class:"fa fa-envelope-open text-primary"})],-1)),t("div",Ot,[t("span",Bt,d(a.openCount),1),e[14]||(e[14]=t("span",{class:"stat-label"},"Open",-1))])])])]),t("div",Ut,[t("div",Ht,[t("div",Yt,[e[17]||(e[17]=t("div",{class:"stat-icon"},[t("i",{class:"fa fa-spinner text-warning"})],-1)),t("div",Jt,[t("span",Wt,d(a.assignedCount),1),e[16]||(e[16]=t("span",{class:"stat-label"},"In Progress",-1))])])])]),t("div",zt,[t("div",Gt,[t("div",Kt,[e[19]||(e[19]=t("div",{class:"stat-icon"},[t("i",{class:"fa fa-check-circle text-success"})],-1)),t("div",Qt,[t("span",Xt,d(a.resolvedCount),1),e[18]||(e[18]=t("span",{class:"stat-label"},"Resolved",-1))])])])])])):f("",!0),t("div",Zt,[t("div",es,[S(E,{name:"fade",mode:"out-in"},{default:M(()=>[i.store.currentView==="select-type"?(l(),b(o,{key:"select-type"})):i.store.currentView==="create"?(l(),b(k,{key:"create"})):i.store.currentView==="list"?(l(),b(D,{key:"list"})):i.store.currentView==="detail"?(l(),b(P,{key:"detail"})):f("",!0)]),_:1})])])])}const L=g(St,[["render",ts],["__scopeId","data-v-308c8eea"]]),ss={components:{TicketWidget:L},data(){return{isOpen:!1}},mounted(){window.openTicketModal=this.open,window.closeTicketModal=this.close,document.addEventListener("keydown",this.handleEscape)},beforeUnmount(){document.removeEventListener("keydown",this.handleEscape)},methods:{open(){this.isOpen=!0,document.body.classList.add("ticket-modal-open"),s.loadTickets().then(()=>{s.markAllSeen()}),s.loadTicketTypes()},close(){this.isOpen=!1,document.body.classList.remove("ticket-modal-open"),s.stopPolling(),s.markAllSeen()},handleEscape(n){n.key==="Escape"&&this.isOpen&&this.close()}}},ns={class:"ticket-modal"},is={class:"ticket-modal-header"},os={class:"ticket-modal-body"};function ls(n,e,u,p,i,a){const o=y("ticket-widget");return l(),r("div",null,[i.isOpen?(l(),r("div",{key:0,class:"ticket-modal-overlay",onClick:e[1]||(e[1]=T((...k)=>a.close&&a.close(...k),["self"]))},[t("div",ns,[t("div",is,[e[3]||(e[3]=t("h4",null,[t("i",{class:"fa fa-life-ring m-r-sm"}),c(" Help Center ")],-1)),t("button",{class:"ticket-modal-close",onClick:e[0]||(e[0]=(...k)=>a.close&&a.close(...k))},[...e[2]||(e[2]=[t("i",{class:"fa fa-times"},null,-1)])])]),t("div",os,[S(o,{ref:"widget","in-modal":!0},null,512)])])])):f("",!0)])}const rs=g(ss,[["render",ls],["__scopeId","data-v-25ab8f7a"]]),as=document.getElementById("ticket-widget-container");as&&I(L).mount("#ticket-widget-container");const cs=document.getElementById("ticket-modal-container");cs&&(I(rs).mount("#ticket-modal-container"),s.startUnreadPolling());
